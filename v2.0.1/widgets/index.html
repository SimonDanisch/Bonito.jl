<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Widgets · JSServe</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">JSServe</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">JSServe Introduction</a></li><li><a class="tocitem" href="../api/">Api</a></li><li><a class="tocitem" href="../assets/">Assets</a></li><li><a class="tocitem" href="../extending/">Extending JSServe</a></li><li class="is-active"><a class="tocitem" href>Widgets</a><ul class="internal"><li><a class="tocitem" href="#Editor"><span>Editor</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Widgets</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Widgets</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SimonDanisch/JSServe.jl/blob/master/docs/src/widgets.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Widgets"><a class="docs-heading-anchor" href="#Widgets">Widgets</a><a id="Widgets-1"></a><a class="docs-heading-anchor-permalink" href="#Widgets" title="Permalink"></a></h1><h2 id="Editor"><a class="docs-heading-anchor" href="#Editor">Editor</a><a id="Editor-1"></a><a class="docs-heading-anchor-permalink" href="#Editor" title="Permalink"></a></h2><p>This editor works in pure Javascript, so feel free to try out editing the Javascript and clicking <code>eval</code> to see how the output changes. In <code>JSServe/examples/editor.jl</code>, you will find a version that works with Julia code, but that requires a running Julia server of course.</p><pre><code class="language-julia hljs">using JSServe, Observables
src = &quot;&quot;&quot;
(() =&gt; {
    const canvas = document.createElement(&quot;canvas&quot;);
    const context = canvas.getContext(&#39;2d&#39;);
    const width = 500
    const height = 400
    canvas.width = width;
    canvas.height = height;
    const gradient = context.createRadialGradient(200, 200, 0, 200, 200, 200);
    gradient.addColorStop(&quot;0&quot;, &quot;magenta&quot;);
    gradient.addColorStop(&quot;.25&quot;, &quot;blue&quot;);
    gradient.addColorStop(&quot;.50&quot;, &quot;green&quot;);
    gradient.addColorStop(&quot;.75&quot;, &quot;yellow&quot;);
    gradient.addColorStop(&quot;1.0&quot;, &quot;red&quot;);
    context.fillStyle = gradient;
    context.fillRect(0, 0, width, height);
    return canvas;
})();
&quot;&quot;&quot;
App() do session::Session
    editor = CodeEditor(&quot;javascript&quot;; initial_source=src, width=800, height=300)
    eval_button = Button(&quot;eval&quot;)
    output = DOM.div(DOM.span())
    JSServe.onjs(session, eval_button.value, js&quot;&quot;&quot;function (click){
        const js_src = $(editor.onchange).value;
        const result = new Function(&quot;return &quot; + (js_src))()
        let dom;
        if (typeof result === &#39;object&#39; &amp;&amp; result.nodeName) {
            dom = result
        } else {
            const span = document.createElement(&quot;span&quot;)
            span.innerText = result;
            dom = span
        }
        JSServe.update_or_replace($(output), dom, false);
        return
    }
    &quot;&quot;&quot;)
    notify(eval_button.value)
    return DOM.div(editor, eval_button, output)
end</code></pre><div data-jscall-id="32">
  <div id="d1a1682f-56f6-4024-a439-e6d93de5a988" data-jscall-id="jsserver-application-dom">
    <span data-jscall-id="15">
      <script data-jscall-id="17" src="data:application/javascript;base64,Ly8gZGVuby1mbXQtaWdub3JlLWZpbGUKLy8gZGVuby1saW50LWlnbm9yZS1maWxlCi8vIFRoaXMgY29kZSB3YXMgYnVuZGxlZCB1c2luZyBgZGVubyBidW5kbGVgIGFuZCBpdCdzIG5vdCByZWNvbW1lbmRlZCB0byBlZGl0IGl0IG1hbnVhbGx5Cgp2YXIgUCA9IE9iamVjdC5jcmVhdGU7CnZhciBkID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgVCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBGID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM7CnZhciBJID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLCBLID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIG8gPSAodCwgZSk9PmQodCwgIm5hbWUiLCB7CiAgICAgICAgdmFsdWU6IGUsCiAgICAgICAgY29uZmlndXJhYmxlOiAhMAogICAgfSk7CnZhciBXID0gKHQsIGUpPT4oKT0+KGUgfHwgdCgoZSA9IHsKICAgICAgICAgICAgZXhwb3J0czoge30KICAgICAgICB9KS5leHBvcnRzLCBlKSwgZS5leHBvcnRzKTsKdmFyICQgPSAodCwgZSwgbiwgcik9PnsKICAgIGlmIChlICYmIHR5cGVvZiBlID09ICJvYmplY3QiIHx8IHR5cGVvZiBlID09ICJmdW5jdGlvbiIpIGZvciAobGV0IGkgb2YgRihlKSkhSy5jYWxsKHQsIGkpICYmIGkgIT09IG4gJiYgZCh0LCBpLCB7CiAgICAgICAgZ2V0OiAoKT0+ZVtpXSwKICAgICAgICBlbnVtZXJhYmxlOiAhKHIgPSBUKGUsIGkpKSB8fCByLmVudW1lcmFibGUKICAgIH0pOwogICAgcmV0dXJuIHQ7Cn07CnZhciB5ID0gKHQsIGUsIG4pPT4obiA9IHQgIT0gbnVsbCA/IFAoSSh0KSkgOiB7fSwgJChlIHx8ICF0IHx8ICF0Ll9fZXNNb2R1bGUgPyBkKG4sICJkZWZhdWx0IiwgewogICAgICAgIHZhbHVlOiB0LAogICAgICAgIGVudW1lcmFibGU6ICEwCiAgICB9KSA6IG4sIHQpKTsKdmFyIG0gPSBXKChKLCBoKT0+ewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIGMgPSB0eXBlb2YgUmVmbGVjdCA9PSAib2JqZWN0IiA/IFJlZmxlY3QgOiBudWxsLCBnID0gYyAmJiB0eXBlb2YgYy5hcHBseSA9PSAiZnVuY3Rpb24iID8gYy5hcHBseSA6IG8oZnVuY3Rpb24oZSwgbiwgcikgewogICAgICAgIHJldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHkuY2FsbChlLCBuLCByKTsKICAgIH0sICJSZWZsZWN0QXBwbHkiKSwgdjsKICAgIGMgJiYgdHlwZW9mIGMub3duS2V5cyA9PSAiZnVuY3Rpb24iID8gdiA9IGMub3duS2V5cyA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyB2ID0gbyhmdW5jdGlvbihlKSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGUpLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpKTsKICAgIH0sICJSZWZsZWN0T3duS2V5cyIpIDogdiA9IG8oZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhlKTsKICAgIH0sICJSZWZsZWN0T3duS2V5cyIpOwogICAgZnVuY3Rpb24gUyh0KSB7CiAgICAgICAgY29uc29sZSAmJiBjb25zb2xlLndhcm4gJiYgY29uc29sZS53YXJuKHQpOwogICAgfQogICAgbyhTLCAiUHJvY2Vzc0VtaXRXYXJuaW5nIik7CiAgICB2YXIgdyA9IE51bWJlci5pc05hTiB8fCBvKGZ1bmN0aW9uKGUpIHsKICAgICAgICByZXR1cm4gZSAhPT0gZTsKICAgIH0sICJOdW1iZXJJc05hTiIpOwogICAgZnVuY3Rpb24gZigpIHsKICAgICAgICBmLmluaXQuY2FsbCh0aGlzKTsKICAgIH0KICAgIG8oZiwgIkV2ZW50RW1pdHRlciIpOwogICAgaC5leHBvcnRzID0gZjsKICAgIGguZXhwb3J0cy5vbmNlID0gcTsKICAgIGYuRXZlbnRFbWl0dGVyID0gZjsKICAgIGYucHJvdG90eXBlLl9ldmVudHMgPSB2b2lkIDA7CiAgICBmLnByb3RvdHlwZS5fZXZlbnRzQ291bnQgPSAwOwogICAgZi5wcm90b3R5cGUuX21heExpc3RlbmVycyA9IHZvaWQgMDsKICAgIHZhciBfID0gMTA7CiAgICBmdW5jdGlvbiBwKHQpIHsKICAgICAgICBpZiAodHlwZW9mIHQgIT0gImZ1bmN0aW9uIikgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJsaXN0ZW5lciIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEZ1bmN0aW9uLiBSZWNlaXZlZCB0eXBlICcgKyB0eXBlb2YgdCk7CiAgICB9CiAgICBvKHAsICJjaGVja0xpc3RlbmVyIik7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZiwgImRlZmF1bHRNYXhMaXN0ZW5lcnMiLCB7CiAgICAgICAgZW51bWVyYWJsZTogITAsCiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIF87CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0ICE9ICJudW1iZXIiIHx8IHQgPCAwIHx8IHcodCkpIHRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgdmFsdWUgb2YgImRlZmF1bHRNYXhMaXN0ZW5lcnMiIGlzIG91dCBvZiByYW5nZS4gSXQgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuIFJlY2VpdmVkICcgKyB0ICsgIi4iKTsKICAgICAgICAgICAgXyA9IHQ7CiAgICAgICAgfQogICAgfSk7CiAgICBmLmluaXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAodGhpcy5fZXZlbnRzID09PSB2b2lkIDAgfHwgdGhpcy5fZXZlbnRzID09PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuX2V2ZW50cykgJiYgKHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCksIHRoaXMuX2V2ZW50c0NvdW50ID0gMCksIHRoaXMuX21heExpc3RlbmVycyA9IHRoaXMuX21heExpc3RlbmVycyB8fCB2b2lkIDA7CiAgICB9OwogICAgZi5wcm90b3R5cGUuc2V0TWF4TGlzdGVuZXJzID0gbyhmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBlICE9ICJudW1iZXIiIHx8IGUgPCAwIHx8IHcoZSkpIHRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgdmFsdWUgb2YgIm4iIGlzIG91dCBvZiByYW5nZS4gSXQgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuIFJlY2VpdmVkICcgKyBlICsgIi4iKTsKICAgICAgICByZXR1cm4gdGhpcy5fbWF4TGlzdGVuZXJzID0gZSwgdGhpczsKICAgIH0sICJzZXRNYXhMaXN0ZW5lcnMiKTsKICAgIGZ1bmN0aW9uIGIodCkgewogICAgICAgIHJldHVybiB0Ll9tYXhMaXN0ZW5lcnMgPT09IHZvaWQgMCA/IGYuZGVmYXVsdE1heExpc3RlbmVycyA6IHQuX21heExpc3RlbmVyczsKICAgIH0KICAgIG8oYiwgIl9nZXRNYXhMaXN0ZW5lcnMiKTsKICAgIGYucHJvdG90eXBlLmdldE1heExpc3RlbmVycyA9IG8oZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGIodGhpcyk7CiAgICB9LCAiZ2V0TWF4TGlzdGVuZXJzIik7CiAgICBmLnByb3RvdHlwZS5lbWl0ID0gbyhmdW5jdGlvbihlKSB7CiAgICAgICAgZm9yKHZhciBuID0gW10sIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKW4ucHVzaChhcmd1bWVudHNbcl0pOwogICAgICAgIHZhciBpID0gZSA9PT0gImVycm9yIiwgdSA9IHRoaXMuX2V2ZW50czsKICAgICAgICBpZiAodSAhPT0gdm9pZCAwKSBpID0gaSAmJiB1LmVycm9yID09PSB2b2lkIDA7CiAgICAgICAgZWxzZSBpZiAoIWkpIHJldHVybiAhMTsKICAgICAgICBpZiAoaSkgewogICAgICAgICAgICB2YXIgczsKICAgICAgICAgICAgaWYgKG4ubGVuZ3RoID4gMCAmJiAocyA9IG5bMF0pLCBzIGluc3RhbmNlb2YgRXJyb3IpIHRocm93IHM7CiAgICAgICAgICAgIHZhciBhID0gbmV3IEVycm9yKCJVbmhhbmRsZWQgZXJyb3IuIiArIChzID8gIiAoIiArIHMubWVzc2FnZSArICIpIiA6ICIiKSk7CiAgICAgICAgICAgIHRocm93IGEuY29udGV4dCA9IHMsIGE7CiAgICAgICAgfQogICAgICAgIHZhciBsID0gdVtlXTsKICAgICAgICBpZiAobCA9PT0gdm9pZCAwKSByZXR1cm4gITE7CiAgICAgICAgaWYgKHR5cGVvZiBsID09ICJmdW5jdGlvbiIpIGcobCwgdGhpcywgbik7CiAgICAgICAgZWxzZSBmb3IodmFyIEwgPSBsLmxlbmd0aCwgQSA9IGoobCwgTCksIHIgPSAwOyByIDwgTDsgKytyKWcoQVtyXSwgdGhpcywgbik7CiAgICAgICAgcmV0dXJuICEwOwogICAgfSwgImVtaXQiKTsKICAgIGZ1bmN0aW9uIEUodCwgZSwgbiwgcikgewogICAgICAgIHZhciBpLCB1LCBzOwogICAgICAgIGlmIChwKG4pLCB1ID0gdC5fZXZlbnRzLCB1ID09PSB2b2lkIDAgPyAodSA9IHQuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCksIHQuX2V2ZW50c0NvdW50ID0gMCkgOiAodS5uZXdMaXN0ZW5lciAhPT0gdm9pZCAwICYmICh0LmVtaXQoIm5ld0xpc3RlbmVyIiwgZSwgbi5saXN0ZW5lciA/IG4ubGlzdGVuZXIgOiBuKSwgdSA9IHQuX2V2ZW50cyksIHMgPSB1W2VdKSwgcyA9PT0gdm9pZCAwKSBzID0gdVtlXSA9IG4sICsrdC5fZXZlbnRzQ291bnQ7CiAgICAgICAgZWxzZSBpZiAodHlwZW9mIHMgPT0gImZ1bmN0aW9uIiA/IHMgPSB1W2VdID0gciA/IFsKICAgICAgICAgICAgbiwKICAgICAgICAgICAgcwogICAgICAgIF0gOiBbCiAgICAgICAgICAgIHMsCiAgICAgICAgICAgIG4KICAgICAgICBdIDogciA/IHMudW5zaGlmdChuKSA6IHMucHVzaChuKSwgaSA9IGIodCksIGkgPiAwICYmIHMubGVuZ3RoID4gaSAmJiAhcy53YXJuZWQpIHsKICAgICAgICAgICAgcy53YXJuZWQgPSAhMDsKICAgICAgICAgICAgdmFyIGEgPSBuZXcgRXJyb3IoIlBvc3NpYmxlIEV2ZW50RW1pdHRlciBtZW1vcnkgbGVhayBkZXRlY3RlZC4gIiArIHMubGVuZ3RoICsgIiAiICsgU3RyaW5nKGUpICsgIiBsaXN0ZW5lcnMgYWRkZWQuIFVzZSBlbWl0dGVyLnNldE1heExpc3RlbmVycygpIHRvIGluY3JlYXNlIGxpbWl0Iik7CiAgICAgICAgICAgIGEubmFtZSA9ICJNYXhMaXN0ZW5lcnNFeGNlZWRlZFdhcm5pbmciLCBhLmVtaXR0ZXIgPSB0LCBhLnR5cGUgPSBlLCBhLmNvdW50ID0gcy5sZW5ndGgsIFMoYSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfQogICAgbyhFLCAiX2FkZExpc3RlbmVyIik7CiAgICBmLnByb3RvdHlwZS5hZGRMaXN0ZW5lciA9IG8oZnVuY3Rpb24oZSwgbikgewogICAgICAgIHJldHVybiBFKHRoaXMsIGUsIG4sICExKTsKICAgIH0sICJhZGRMaXN0ZW5lciIpOwogICAgZi5wcm90b3R5cGUub24gPSBmLnByb3RvdHlwZS5hZGRMaXN0ZW5lcjsKICAgIGYucHJvdG90eXBlLnByZXBlbmRMaXN0ZW5lciA9IG8oZnVuY3Rpb24oZSwgbikgewogICAgICAgIHJldHVybiBFKHRoaXMsIGUsIG4sICEwKTsKICAgIH0sICJwcmVwZW5kTGlzdGVuZXIiKTsKICAgIGZ1bmN0aW9uIFUoKSB7CiAgICAgICAgaWYgKCF0aGlzLmZpcmVkKSByZXR1cm4gdGhpcy50YXJnZXQucmVtb3ZlTGlzdGVuZXIodGhpcy50eXBlLCB0aGlzLndyYXBGbiksIHRoaXMuZmlyZWQgPSAhMCwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMCA/IHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCkgOiB0aGlzLmxpc3RlbmVyLmFwcGx5KHRoaXMudGFyZ2V0LCBhcmd1bWVudHMpOwogICAgfQogICAgbyhVLCAib25jZVdyYXBwZXIiKTsKICAgIGZ1bmN0aW9uIE8odCwgZSwgbikgewogICAgICAgIHZhciByID0gewogICAgICAgICAgICBmaXJlZDogITEsCiAgICAgICAgICAgIHdyYXBGbjogdm9pZCAwLAogICAgICAgICAgICB0YXJnZXQ6IHQsCiAgICAgICAgICAgIHR5cGU6IGUsCiAgICAgICAgICAgIGxpc3RlbmVyOiBuCiAgICAgICAgfSwgaSA9IFUuYmluZChyKTsKICAgICAgICByZXR1cm4gaS5saXN0ZW5lciA9IG4sIHIud3JhcEZuID0gaSwgaTsKICAgIH0KICAgIG8oTywgIl9vbmNlV3JhcCIpOwogICAgZi5wcm90b3R5cGUub25jZSA9IG8oZnVuY3Rpb24oZSwgbikgewogICAgICAgIHJldHVybiBwKG4pLCB0aGlzLm9uKGUsIE8odGhpcywgZSwgbikpLCB0aGlzOwogICAgfSwgIm9uY2UiKTsKICAgIGYucHJvdG90eXBlLnByZXBlbmRPbmNlTGlzdGVuZXIgPSBvKGZ1bmN0aW9uKGUsIG4pIHsKICAgICAgICByZXR1cm4gcChuKSwgdGhpcy5wcmVwZW5kTGlzdGVuZXIoZSwgTyh0aGlzLCBlLCBuKSksIHRoaXM7CiAgICB9LCAicHJlcGVuZE9uY2VMaXN0ZW5lciIpOwogICAgZi5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBvKGZ1bmN0aW9uKGUsIG4pIHsKICAgICAgICB2YXIgciwgaSwgdSwgcywgYTsKICAgICAgICBpZiAocChuKSwgaSA9IHRoaXMuX2V2ZW50cywgaSA9PT0gdm9pZCAwKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAociA9IGlbZV0sIHIgPT09IHZvaWQgMCkgcmV0dXJuIHRoaXM7CiAgICAgICAgaWYgKHIgPT09IG4gfHwgci5saXN0ZW5lciA9PT0gbikgLS10aGlzLl9ldmVudHNDb3VudCA9PT0gMCA/IHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCkgOiAoZGVsZXRlIGlbZV0sIGkucmVtb3ZlTGlzdGVuZXIgJiYgdGhpcy5lbWl0KCJyZW1vdmVMaXN0ZW5lciIsIGUsIHIubGlzdGVuZXIgfHwgbikpOwogICAgICAgIGVsc2UgaWYgKHR5cGVvZiByICE9ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgZm9yKHUgPSAtMSwgcyA9IHIubGVuZ3RoIC0gMTsgcyA+PSAwOyBzLS0paWYgKHJbc10gPT09IG4gfHwgcltzXS5saXN0ZW5lciA9PT0gbikgewogICAgICAgICAgICAgICAgYSA9IHJbc10ubGlzdGVuZXIsIHUgPSBzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHUgPCAwKSByZXR1cm4gdGhpczsKICAgICAgICAgICAgdSA9PT0gMCA/IHIuc2hpZnQoKSA6IGsociwgdSksIHIubGVuZ3RoID09PSAxICYmIChpW2VdID0gclswXSksIGkucmVtb3ZlTGlzdGVuZXIgIT09IHZvaWQgMCAmJiB0aGlzLmVtaXQoInJlbW92ZUxpc3RlbmVyIiwgZSwgYSB8fCBuKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LCAicmVtb3ZlTGlzdGVuZXIiKTsKICAgIGYucHJvdG90eXBlLm9mZiA9IGYucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyOwogICAgZi5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gbyhmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIG4sIHIsIGk7CiAgICAgICAgaWYgKHIgPSB0aGlzLl9ldmVudHMsIHIgPT09IHZvaWQgMCkgcmV0dXJuIHRoaXM7CiAgICAgICAgaWYgKHIucmVtb3ZlTGlzdGVuZXIgPT09IHZvaWQgMCkgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDAgPyAodGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKSwgdGhpcy5fZXZlbnRzQ291bnQgPSAwKSA6IHJbZV0gIT09IHZvaWQgMCAmJiAoLS10aGlzLl9ldmVudHNDb3VudCA9PT0gMCA/IHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCkgOiBkZWxldGUgcltlXSksIHRoaXM7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgdmFyIHUgPSBPYmplY3Qua2V5cyhyKSwgczsKICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgdS5sZW5ndGg7ICsraSlzID0gdVtpXSwgcyAhPT0gInJlbW92ZUxpc3RlbmVyIiAmJiB0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCJyZW1vdmVMaXN0ZW5lciIpLCB0aGlzLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpLCB0aGlzLl9ldmVudHNDb3VudCA9IDAsIHRoaXM7CiAgICAgICAgfQogICAgICAgIGlmIChuID0gcltlXSwgdHlwZW9mIG4gPT0gImZ1bmN0aW9uIikgdGhpcy5yZW1vdmVMaXN0ZW5lcihlLCBuKTsKICAgICAgICBlbHNlIGlmIChuICE9PSB2b2lkIDApIGZvcihpID0gbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSl0aGlzLnJlbW92ZUxpc3RlbmVyKGUsIG5baV0pOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwgInJlbW92ZUFsbExpc3RlbmVycyIpOwogICAgZnVuY3Rpb24geCh0LCBlLCBuKSB7CiAgICAgICAgdmFyIHIgPSB0Ll9ldmVudHM7CiAgICAgICAgaWYgKHIgPT09IHZvaWQgMCkgcmV0dXJuIFtdOwogICAgICAgIHZhciBpID0gcltlXTsKICAgICAgICByZXR1cm4gaSA9PT0gdm9pZCAwID8gW10gOiB0eXBlb2YgaSA9PSAiZnVuY3Rpb24iID8gbiA/IFsKICAgICAgICAgICAgaS5saXN0ZW5lciB8fCBpCiAgICAgICAgXSA6IFsKICAgICAgICAgICAgaQogICAgICAgIF0gOiBuID8gSChpKSA6IGooaSwgaS5sZW5ndGgpOwogICAgfQogICAgbyh4LCAiX2xpc3RlbmVycyIpOwogICAgZi5wcm90b3R5cGUubGlzdGVuZXJzID0gbyhmdW5jdGlvbihlKSB7CiAgICAgICAgcmV0dXJuIHgodGhpcywgZSwgITApOwogICAgfSwgImxpc3RlbmVycyIpOwogICAgZi5wcm90b3R5cGUucmF3TGlzdGVuZXJzID0gbyhmdW5jdGlvbihlKSB7CiAgICAgICAgcmV0dXJuIHgodGhpcywgZSwgITEpOwogICAgfSwgInJhd0xpc3RlbmVycyIpOwogICAgZi5saXN0ZW5lckNvdW50ID0gZnVuY3Rpb24odCwgZSkgewogICAgICAgIHJldHVybiB0eXBlb2YgdC5saXN0ZW5lckNvdW50ID09ICJmdW5jdGlvbiIgPyB0Lmxpc3RlbmVyQ291bnQoZSkgOiBDLmNhbGwodCwgZSk7CiAgICB9OwogICAgZi5wcm90b3R5cGUubGlzdGVuZXJDb3VudCA9IEM7CiAgICBmdW5jdGlvbiBDKHQpIHsKICAgICAgICB2YXIgZSA9IHRoaXMuX2V2ZW50czsKICAgICAgICBpZiAoZSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHZhciBuID0gZVt0XTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBuID09ICJmdW5jdGlvbiIpIHJldHVybiAxOwogICAgICAgICAgICBpZiAobiAhPT0gdm9pZCAwKSByZXR1cm4gbi5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgfQogICAgbyhDLCAibGlzdGVuZXJDb3VudCIpOwogICAgZi5wcm90b3R5cGUuZXZlbnROYW1lcyA9IG8oZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50c0NvdW50ID4gMCA/IHYodGhpcy5fZXZlbnRzKSA6IFtdOwogICAgfSwgImV2ZW50TmFtZXMiKTsKICAgIGZ1bmN0aW9uIGoodCwgZSkgewogICAgICAgIGZvcih2YXIgbiA9IG5ldyBBcnJheShlKSwgciA9IDA7IHIgPCBlOyArK3IpbltyXSA9IHRbcl07CiAgICAgICAgcmV0dXJuIG47CiAgICB9CiAgICBvKGosICJhcnJheUNsb25lIik7CiAgICBmdW5jdGlvbiBrKHQsIGUpIHsKICAgICAgICBmb3IoOyBlICsgMSA8IHQubGVuZ3RoOyBlKyspdFtlXSA9IHRbZSArIDFdOwogICAgICAgIHQucG9wKCk7CiAgICB9CiAgICBvKGssICJzcGxpY2VPbmUiKTsKICAgIGZ1bmN0aW9uIEgodCkgewogICAgICAgIGZvcih2YXIgZSA9IG5ldyBBcnJheSh0Lmxlbmd0aCksIG4gPSAwOyBuIDwgZS5sZW5ndGg7ICsrbillW25dID0gdFtuXS5saXN0ZW5lciB8fCB0W25dOwogICAgICAgIHJldHVybiBlOwogICAgfQogICAgbyhILCAidW53cmFwTGlzdGVuZXJzIik7CiAgICBmdW5jdGlvbiBxKHQsIGUpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24obiwgcikgewogICAgICAgICAgICBmdW5jdGlvbiBpKHMpIHsKICAgICAgICAgICAgICAgIHQucmVtb3ZlTGlzdGVuZXIoZSwgdSksIHIocyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbyhpLCAiZXJyb3JMaXN0ZW5lciIpOwogICAgICAgICAgICBmdW5jdGlvbiB1KCkgewogICAgICAgICAgICAgICAgdHlwZW9mIHQucmVtb3ZlTGlzdGVuZXIgPT0gImZ1bmN0aW9uIiAmJiB0LnJlbW92ZUxpc3RlbmVyKCJlcnJvciIsIGkpLCBuKFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbyh1LCAicmVzb2x2ZXIiKSwgUih0LCBlLCB1LCB7CiAgICAgICAgICAgICAgICBvbmNlOiAhMAogICAgICAgICAgICB9KSwgZSAhPT0gImVycm9yIiAmJiB6KHQsIGksIHsKICAgICAgICAgICAgICAgIG9uY2U6ICEwCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQogICAgbyhxLCAib25jZSIpOwogICAgZnVuY3Rpb24geih0LCBlLCBuKSB7CiAgICAgICAgdHlwZW9mIHQub24gPT0gImZ1bmN0aW9uIiAmJiBSKHQsICJlcnJvciIsIGUsIG4pOwogICAgfQogICAgbyh6LCAiYWRkRXJyb3JIYW5kbGVySWZFdmVudEVtaXR0ZXIiKTsKICAgIGZ1bmN0aW9uIFIodCwgZSwgbiwgcikgewogICAgICAgIGlmICh0eXBlb2YgdC5vbiA9PSAiZnVuY3Rpb24iKSByLm9uY2UgPyB0Lm9uY2UoZSwgbikgOiB0Lm9uKGUsIG4pOwogICAgICAgIGVsc2UgaWYgKHR5cGVvZiB0LmFkZEV2ZW50TGlzdGVuZXIgPT0gImZ1bmN0aW9uIikgdC5hZGRFdmVudExpc3RlbmVyKGUsIG8oZnVuY3Rpb24gaSh1KSB7CiAgICAgICAgICAgIHIub25jZSAmJiB0LnJlbW92ZUV2ZW50TGlzdGVuZXIoZSwgaSksIG4odSk7CiAgICAgICAgfSwgIndyYXBMaXN0ZW5lciIpKTsKICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSAiZW1pdHRlciIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIEV2ZW50RW1pdHRlci4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIHQpOwogICAgfQogICAgbyhSLCAiZXZlbnRUYXJnZXRBZ25vc3RpY0FkZExpc3RlbmVyIik7Cn0pOwp2YXIgTiA9IHkobSgpKSwgTSA9IHkobSgpKSwgeyBFdmVudEVtaXR0ZXI6IFEgLCBpbml0OiBWICwgbGlzdGVuZXJDb3VudDogWCAsIG9uY2U6IFkgIH0gPSBNLCB7IGRlZmF1bHQ6IEIgLCAuLi5EIH0gPSBNLCBaID0gTi5kZWZhdWx0ID8/IEIgPz8gRDsKY29uc3QgZXZlbnRzID0gbmV3IFEoKTsKZXZlbnRzLnNldE1heExpc3RlbmVycygxIDw8IDEwKTsKY29uc3QgZGVubyA9IHR5cGVvZiBEZW5vICE9PSAidW5kZWZpbmVkIjsKY29uc3QgX19kZWZhdWx0ID0gewogICAgdGl0bGU6IGRlbm8gPyAiZGVubyIgOiAiYnJvd3NlciIsCiAgICBicm93c2VyOiB0cnVlLAogICAgZW52OiBkZW5vID8gbmV3IFByb3h5KHt9LCB7CiAgICAgICAgZ2V0IChfdGFyZ2V0LCBwcm9wKSB7CiAgICAgICAgICAgIHJldHVybiBEZW5vLmVudi5nZXQoU3RyaW5nKHByb3ApKTsKICAgICAgICB9LAogICAgICAgIG93bktleXM6ICgpPT5SZWZsZWN0Lm93bktleXMoRGVuby5lbnYudG9PYmplY3QoKSksCiAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiAoX3RhcmdldCwgbmFtZSk9PnsKICAgICAgICAgICAgY29uc3QgZSA9IERlbm8uZW52LnRvT2JqZWN0KCk7CiAgICAgICAgICAgIGlmIChuYW1lIGluIERlbm8uZW52LnRvT2JqZWN0KCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG8gPSB7CiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgby52YWx1ZSA9IGVbbmFtZV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbzsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0IChfdGFyZ2V0LCBwcm9wLCB2YWx1ZSkgewogICAgICAgICAgICBEZW5vLmVudi5zZXQoU3RyaW5nKHByb3ApLCBTdHJpbmcodmFsdWUpKTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgIH0pIDoge30sCiAgICBhcmd2OiBkZW5vID8gRGVuby5hcmdzID8/IFtdIDogW10sCiAgICBwaWQ6IGRlbm8gPyBEZW5vLnBpZCA/PyAwIDogMCwKICAgIHZlcnNpb246ICJ2MTYuMTguMCIsCiAgICB2ZXJzaW9uczogewogICAgICAgIG5vZGU6ICcxNi4xOC4wJywKICAgICAgICB2ODogJzkuNC4xNDYuMjYtbm9kZS4yMicsCiAgICAgICAgdXY6ICcxLjQzLjAnLAogICAgICAgIHpsaWI6ICcxLjIuMTEnLAogICAgICAgIGJyb3RsaTogJzEuMC45JywKICAgICAgICBhcmVzOiAnMS4xOC4xJywKICAgICAgICBtb2R1bGVzOiAnOTMnLAogICAgICAgIG5naHR0cDI6ICcxLjQ3LjAnLAogICAgICAgIG5hcGk6ICc4JywKICAgICAgICBsbGh0dHA6ICc2LjAuMTAnLAogICAgICAgIG9wZW5zc2w6ICcxLjEuMXErcXVpYycsCiAgICAgICAgY2xkcjogJzQxLjAnLAogICAgICAgIGljdTogJzcxLjEnLAogICAgICAgIHR6OiAnMjAyMmInLAogICAgICAgIHVuaWNvZGU6ICcxNC4wJywKICAgICAgICBuZ3RjcDI6ICcwLjguMScsCiAgICAgICAgbmdodHRwMzogJzAuNy4wJywKICAgICAgICAuLi5kZW5vID8gRGVuby52ZXJzaW9uID8/IHt9IDoge30KICAgIH0sCiAgICBvbjogKC4uLmFyZ3MpPT5ldmVudHMub24oLi4uYXJncyksCiAgICBhZGRMaXN0ZW5lcjogKC4uLmFyZ3MpPT5ldmVudHMuYWRkTGlzdGVuZXIoLi4uYXJncyksCiAgICBvbmNlOiAoLi4uYXJncyk9PmV2ZW50cy5vbmNlKC4uLmFyZ3MpLAogICAgb2ZmOiAoLi4uYXJncyk9PmV2ZW50cy5vZmYoLi4uYXJncyksCiAgICByZW1vdmVMaXN0ZW5lcjogKC4uLmFyZ3MpPT5ldmVudHMucmVtb3ZlTGlzdGVuZXIoLi4uYXJncyksCiAgICByZW1vdmVBbGxMaXN0ZW5lcnM6ICguLi5hcmdzKT0+ZXZlbnRzLnJlbW92ZUFsbExpc3RlbmVycyguLi5hcmdzKSwKICAgIGVtaXQ6ICguLi5hcmdzKT0+ZXZlbnRzLmVtaXQoLi4uYXJncyksCiAgICBwcmVwZW5kTGlzdGVuZXI6ICguLi5hcmdzKT0+ZXZlbnRzLnByZXBlbmRMaXN0ZW5lciguLi5hcmdzKSwKICAgIHByZXBlbmRPbmNlTGlzdGVuZXI6ICguLi5hcmdzKT0+ZXZlbnRzLnByZXBlbmRPbmNlTGlzdGVuZXIoLi4uYXJncyksCiAgICBsaXN0ZW5lcnM6ICgpPT5bXSwKICAgIGVtaXRXYXJuaW5nOiAoKT0+ewogICAgICAgIHRocm93IG5ldyBFcnJvcigicHJvY2Vzcy5lbWl0V2FybmluZyBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICB9LAogICAgYmluZGluZzogKCk9PnsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICB9LAogICAgY3dkOiAoKT0+ZGVubyA/IERlbm8uY3dkPy4oKSA/PyAiLyIgOiAiLyIsCiAgICBjaGRpcjogKHBhdGgpPT57CiAgICAgICAgaWYgKGRlbm8pIHsKICAgICAgICAgICAgRGVuby5jaGRpcihwYXRoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCIpOwogICAgICAgIH0KICAgIH0sCiAgICB1bWFzazogKCk9PmRlbm8gPyBEZW5vLnVtYXNrID8/IDAgOiAwLAogICAgbmV4dFRpY2s6IChmdW5jLCAuLi5hcmdzKT0+cXVldWVNaWNyb3Rhc2soKCk9PmZ1bmMoLi4uYXJncykpCn07CnZhciB2ID0gNDI5NDk2NzI5NTsKZnVuY3Rpb24gSChpLCBlLCB0KSB7CiAgICB2YXIgciA9IHQgLyA0Mjk0OTY3Mjk2LCBzID0gdDsKICAgIGkuc2V0VWludDMyKGUsIHIpLCBpLnNldFVpbnQzMihlICsgNCwgcyk7Cn0KZnVuY3Rpb24gQShpLCBlLCB0KSB7CiAgICB2YXIgciA9IE1hdGguZmxvb3IodCAvIDQyOTQ5NjcyOTYpLCBzID0gdDsKICAgIGkuc2V0VWludDMyKGUsIHIpLCBpLnNldFVpbnQzMihlICsgNCwgcyk7Cn0KZnVuY3Rpb24gRDEoaSwgZSkgewogICAgdmFyIHQgPSBpLmdldEludDMyKGUpLCByID0gaS5nZXRVaW50MzIoZSArIDQpOwogICAgcmV0dXJuIHQgKiA0Mjk0OTY3Mjk2ICsgcjsKfQpmdW5jdGlvbiBiKGksIGUpIHsKICAgIHZhciB0ID0gaS5nZXRVaW50MzIoZSksIHIgPSBpLmdldFVpbnQzMihlICsgNCk7CiAgICByZXR1cm4gdCAqIDQyOTQ5NjcyOTYgKyByOwp9CnZhciBrLCBPLCBSLCBNMSA9ICh0eXBlb2YgX19kZWZhdWx0ID4gInUiIHx8ICgoayA9IF9fZGVmYXVsdD8uZW52KSA9PT0gbnVsbCB8fCBrID09PSB2b2lkIDAgPyB2b2lkIDAgOiBrLlRFWFRfRU5DT0RJTkcpICE9PSAibmV2ZXIiKSAmJiB0eXBlb2YgVGV4dEVuY29kZXIgPCAidSIgJiYgdHlwZW9mIFRleHREZWNvZGVyIDwgInUiOwpmdW5jdGlvbiBGMShpKSB7CiAgICBmb3IodmFyIGUgPSBpLmxlbmd0aCwgdCA9IDAsIHIgPSAwOyByIDwgZTspewogICAgICAgIHZhciBzID0gaS5jaGFyQ29kZUF0KHIrKyk7CiAgICAgICAgaWYgKChzICYgNDI5NDk2NzE2OCkgPT09IDApIHsKICAgICAgICAgICAgdCsrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IGVsc2UgaWYgKChzICYgNDI5NDk2NTI0OCkgPT09IDApIHQgKz0gMjsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKHMgPj0gNTUyOTYgJiYgcyA8PSA1NjMxOSAmJiByIDwgZSkgewogICAgICAgICAgICAgICAgdmFyIG4gPSBpLmNoYXJDb2RlQXQocik7CiAgICAgICAgICAgICAgICAobiAmIDY0NTEyKSA9PT0gNTYzMjAgJiYgKCsrciwgcyA9ICgocyAmIDEwMjMpIDw8IDEwKSArIChuICYgMTAyMykgKyA2NTUzNik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKHMgJiA0Mjk0OTAxNzYwKSA9PT0gMCA/IHQgKz0gMyA6IHQgKz0gNDsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdDsKfQpmdW5jdGlvbiBYMShpLCBlLCB0KSB7CiAgICBmb3IodmFyIHIgPSBpLmxlbmd0aCwgcyA9IHQsIG4gPSAwOyBuIDwgcjspewogICAgICAgIHZhciBvID0gaS5jaGFyQ29kZUF0KG4rKyk7CiAgICAgICAgaWYgKChvICYgNDI5NDk2NzE2OCkgPT09IDApIHsKICAgICAgICAgICAgZVtzKytdID0gbzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfSBlbHNlIGlmICgobyAmIDQyOTQ5NjUyNDgpID09PSAwKSBlW3MrK10gPSBvID4+IDYgJiAzMSB8IDE5MjsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKG8gPj0gNTUyOTYgJiYgbyA8PSA1NjMxOSAmJiBuIDwgcikgewogICAgICAgICAgICAgICAgdmFyIGYgPSBpLmNoYXJDb2RlQXQobik7CiAgICAgICAgICAgICAgICAoZiAmIDY0NTEyKSA9PT0gNTYzMjAgJiYgKCsrbiwgbyA9ICgobyAmIDEwMjMpIDw8IDEwKSArIChmICYgMTAyMykgKyA2NTUzNik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKG8gJiA0Mjk0OTAxNzYwKSA9PT0gMCA/IChlW3MrK10gPSBvID4+IDEyICYgMTUgfCAyMjQsIGVbcysrXSA9IG8gPj4gNiAmIDYzIHwgMTI4KSA6IChlW3MrK10gPSBvID4+IDE4ICYgNyB8IDI0MCwgZVtzKytdID0gbyA+PiAxMiAmIDYzIHwgMTI4LCBlW3MrK10gPSBvID4+IDYgJiA2MyB8IDEyOCk7CiAgICAgICAgfQogICAgICAgIGVbcysrXSA9IG8gJiA2MyB8IDEyODsKICAgIH0KfQp2YXIgVDEgPSBNMSA/IG5ldyBUZXh0RW5jb2RlciA6IHZvaWQgMCwgVzEgPSBNMSA/IHR5cGVvZiBfX2RlZmF1bHQgPCAidSIgJiYgKChPID0gX19kZWZhdWx0Py5lbnYpID09PSBudWxsIHx8IE8gPT09IHZvaWQgMCA/IHZvaWQgMCA6IE8uVEVYVF9FTkNPRElORykgIT09ICJmb3JjZSIgPyAyMDAgOiAwIDogdjsKZnVuY3Rpb24gb2UoaSwgZSwgdCkgewogICAgZS5zZXQoVDEuZW5jb2RlKGkpLCB0KTsKfQpmdW5jdGlvbiBhZShpLCBlLCB0KSB7CiAgICBUMS5lbmNvZGVJbnRvKGksIGUuc3ViYXJyYXkodCkpOwp9CnZhciBHID0gVDE/LmVuY29kZUludG8gPyBhZSA6IG9lLCBmZSA9IDQwOTY7CmZ1bmN0aW9uIEMoaSwgZSwgdCkgewogICAgZm9yKHZhciByID0gZSwgcyA9IHIgKyB0LCBuID0gW10sIG8gPSAiIjsgciA8IHM7KXsKICAgICAgICB2YXIgZiA9IGlbcisrXTsKICAgICAgICBpZiAoKGYgJiAxMjgpID09PSAwKSBuLnB1c2goZik7CiAgICAgICAgZWxzZSBpZiAoKGYgJiAyMjQpID09PSAxOTIpIHsKICAgICAgICAgICAgdmFyIGMgPSBpW3IrK10gJiA2MzsKICAgICAgICAgICAgbi5wdXNoKChmICYgMzEpIDw8IDYgfCBjKTsKICAgICAgICB9IGVsc2UgaWYgKChmICYgMjQwKSA9PT0gMjI0KSB7CiAgICAgICAgICAgIHZhciBjID0gaVtyKytdICYgNjMsIGEgPSBpW3IrK10gJiA2MzsKICAgICAgICAgICAgbi5wdXNoKChmICYgMzEpIDw8IDEyIHwgYyA8PCA2IHwgYSk7CiAgICAgICAgfSBlbHNlIGlmICgoZiAmIDI0OCkgPT09IDI0MCkgewogICAgICAgICAgICB2YXIgYyA9IGlbcisrXSAmIDYzLCBhID0gaVtyKytdICYgNjMsIGggPSBpW3IrK10gJiA2MywgZCA9IChmICYgNykgPDwgMTggfCBjIDw8IDEyIHwgYSA8PCA2IHwgaDsKICAgICAgICAgICAgZCA+IDY1NTM1ICYmIChkIC09IDY1NTM2LCBuLnB1c2goZCA+Pj4gMTAgJiAxMDIzIHwgNTUyOTYpLCBkID0gNTYzMjAgfCBkICYgMTAyMyksIG4ucHVzaChkKTsKICAgICAgICB9IGVsc2Ugbi5wdXNoKGYpOwogICAgICAgIG4ubGVuZ3RoID49IGZlICYmIChvICs9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCBuKSwgbi5sZW5ndGggPSAwKTsKICAgIH0KICAgIHJldHVybiBuLmxlbmd0aCA+IDAgJiYgKG8gKz0gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsIG4pKSwgbzsKfQp2YXIgY2UgPSBNMSA/IG5ldyBUZXh0RGVjb2RlciA6IG51bGwsIEsxID0gTTEgPyB0eXBlb2YgX19kZWZhdWx0IDwgInUiICYmICgoUiA9IF9fZGVmYXVsdD8uZW52KSA9PT0gbnVsbCB8fCBSID09PSB2b2lkIDAgPyB2b2lkIDAgOiBSLlRFWFRfREVDT0RFUikgIT09ICJmb3JjZSIgPyAyMDAgOiAwIDogdjsKZnVuY3Rpb24gWTEoaSwgZSwgdCkgewogICAgdmFyIHIgPSBpLnN1YmFycmF5KGUsIGUgKyB0KTsKICAgIHJldHVybiBjZS5kZWNvZGUocik7Cn0KdmFyIGcgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGkoZSwgdCkgewogICAgICAgIHRoaXMudHlwZSA9IGUsIHRoaXMuZGF0YSA9IHQ7CiAgICB9CiAgICByZXR1cm4gaTsKfSgpOwp2YXIgaGUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBpID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgIHJldHVybiBpID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8ICh7CiAgICAgICAgICAgIF9fcHJvdG9fXzogW10KICAgICAgICB9KSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uKHIsIHMpIHsKICAgICAgICAgICAgci5fX3Byb3RvX18gPSBzOwogICAgICAgIH0gfHwgZnVuY3Rpb24ociwgcykgewogICAgICAgICAgICBmb3IodmFyIG4gaW4gcylPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgbikgJiYgKHJbbl0gPSBzW25dKTsKICAgICAgICB9LCBpKGUsIHQpOwogICAgfTsKICAgIHJldHVybiBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgaWYgKHR5cGVvZiB0ICE9ICJmdW5jdGlvbiIgJiYgdCAhPT0gbnVsbCkgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSAiICsgU3RyaW5nKHQpICsgIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsIik7CiAgICAgICAgaShlLCB0KTsKICAgICAgICBmdW5jdGlvbiByKCkgewogICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gZTsKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUgPSB0ID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZSh0KSA6IChyLnByb3RvdHlwZSA9IHQucHJvdG90eXBlLCBuZXcgcik7CiAgICB9Owp9KCksIHggPSBmdW5jdGlvbihpKSB7CiAgICBoZShlLCBpKTsKICAgIGZ1bmN0aW9uIGUodCkgewogICAgICAgIHZhciByID0gaS5jYWxsKHRoaXMsIHQpIHx8IHRoaXMsIHMgPSBPYmplY3QuY3JlYXRlKGUucHJvdG90eXBlKTsKICAgICAgICByZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mKHIsIHMpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkociwgIm5hbWUiLCB7CiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAsCiAgICAgICAgICAgIGVudW1lcmFibGU6ICExLAogICAgICAgICAgICB2YWx1ZTogZS5uYW1lCiAgICAgICAgfSksIHI7CiAgICB9CiAgICByZXR1cm4gZTsKfShFcnJvcik7CnZhciBKID0gLTEsIHVlID0gNDI5NDk2NzI5NiAtIDEsIGxlID0gMTcxNzk4NjkxODQgLSAxOwpmdW5jdGlvbiBxKGkpIHsKICAgIHZhciBlID0gaS5zZWMsIHQgPSBpLm5zZWM7CiAgICBpZiAoZSA+PSAwICYmIHQgPj0gMCAmJiBlIDw9IGxlKSBpZiAodCA9PT0gMCAmJiBlIDw9IHVlKSB7CiAgICAgICAgdmFyIHIgPSBuZXcgVWludDhBcnJheSg0KSwgcyA9IG5ldyBEYXRhVmlldyhyLmJ1ZmZlcik7CiAgICAgICAgcmV0dXJuIHMuc2V0VWludDMyKDAsIGUpLCByOwogICAgfSBlbHNlIHsKICAgICAgICB2YXIgbiA9IGUgLyA0Mjk0OTY3Mjk2LCBvID0gZSAmIDQyOTQ5NjcyOTUsIHIgPSBuZXcgVWludDhBcnJheSg4KSwgcyA9IG5ldyBEYXRhVmlldyhyLmJ1ZmZlcik7CiAgICAgICAgcmV0dXJuIHMuc2V0VWludDMyKDAsIHQgPDwgMiB8IG4gJiAzKSwgcy5zZXRVaW50MzIoNCwgbyksIHI7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICB2YXIgciA9IG5ldyBVaW50OEFycmF5KDEyKSwgcyA9IG5ldyBEYXRhVmlldyhyLmJ1ZmZlcik7CiAgICAgICAgcmV0dXJuIHMuc2V0VWludDMyKDAsIHQpLCBBKHMsIDQsIGUpLCByOwogICAgfQp9CmZ1bmN0aW9uIFoxKGkpIHsKICAgIHZhciBlID0gaS5nZXRUaW1lKCksIHQgPSBNYXRoLmZsb29yKGUgLyAxZTMpLCByID0gKGUgLSB0ICogMWUzKSAqIDFlNiwgcyA9IE1hdGguZmxvb3IociAvIDFlOSk7CiAgICByZXR1cm4gewogICAgICAgIHNlYzogdCArIHMsCiAgICAgICAgbnNlYzogciAtIHMgKiAxZTkKICAgIH07Cn0KZnVuY3Rpb24gUTEoaSkgewogICAgaWYgKGkgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgdmFyIGUgPSBaMShpKTsKICAgICAgICByZXR1cm4gcShlKTsKICAgIH0gZWxzZSByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiAkMShpKSB7CiAgICB2YXIgZSA9IG5ldyBEYXRhVmlldyhpLmJ1ZmZlciwgaS5ieXRlT2Zmc2V0LCBpLmJ5dGVMZW5ndGgpOwogICAgc3dpdGNoKGkuYnl0ZUxlbmd0aCl7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGUuZ2V0VWludDMyKDApLCByID0gMDsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgc2VjOiB0LAogICAgICAgICAgICAgICAgICAgIG5zZWM6IHIKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHZhciBzID0gZS5nZXRVaW50MzIoMCksIG4gPSBlLmdldFVpbnQzMig0KSwgdCA9IChzICYgMykgKiA0Mjk0OTY3Mjk2ICsgbiwgciA9IHMgPj4+IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHNlYzogdCwKICAgICAgICAgICAgICAgICAgICBuc2VjOiByCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdmFyIHQgPSBEMShlLCA0KSwgciA9IGUuZ2V0VWludDMyKDApOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBzZWM6IHQsCiAgICAgICAgICAgICAgICAgICAgbnNlYzogcgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyB4KCJVbnJlY29nbml6ZWQgZGF0YSBzaXplIGZvciB0aW1lc3RhbXAgKGV4cGVjdGVkIDQsIDgsIG9yIDEyKTogIi5jb25jYXQoaS5sZW5ndGgpKTsKICAgIH0KfQpmdW5jdGlvbiBqKGkpIHsKICAgIHZhciBlID0gJDEoaSk7CiAgICByZXR1cm4gbmV3IERhdGUoZS5zZWMgKiAxZTMgKyBlLm5zZWMgLyAxZTYpOwp9CnZhciBlZSA9IHsKICAgIHR5cGU6IEosCiAgICBlbmNvZGU6IFExLAogICAgZGVjb2RlOiBqCn07CnZhciBJMSA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gaSgpIHsKICAgICAgICB0aGlzLmJ1aWx0SW5FbmNvZGVycyA9IFtdLCB0aGlzLmJ1aWx0SW5EZWNvZGVycyA9IFtdLCB0aGlzLmVuY29kZXJzID0gW10sIHRoaXMuZGVjb2RlcnMgPSBbXSwgdGhpcy5yZWdpc3RlcihlZSk7CiAgICB9CiAgICByZXR1cm4gaS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIHQgPSBlLnR5cGUsIHIgPSBlLmVuY29kZSwgcyA9IGUuZGVjb2RlOwogICAgICAgIGlmICh0ID49IDApIHRoaXMuZW5jb2RlcnNbdF0gPSByLCB0aGlzLmRlY29kZXJzW3RdID0gczsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIG4gPSAxICsgdDsKICAgICAgICAgICAgdGhpcy5idWlsdEluRW5jb2RlcnNbbl0gPSByLCB0aGlzLmJ1aWx0SW5EZWNvZGVyc1tuXSA9IHM7CiAgICAgICAgfQogICAgfSwgaS5wcm90b3R5cGUudHJ5VG9FbmNvZGUgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgZm9yKHZhciByID0gMDsgciA8IHRoaXMuYnVpbHRJbkVuY29kZXJzLmxlbmd0aDsgcisrKXsKICAgICAgICAgICAgdmFyIHMgPSB0aGlzLmJ1aWx0SW5FbmNvZGVyc1tyXTsKICAgICAgICAgICAgaWYgKHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgdmFyIG4gPSBzKGUsIHQpOwogICAgICAgICAgICAgICAgaWYgKG4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHZhciBvID0gLTEgLSByOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZyhvLCBuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IodmFyIHIgPSAwOyByIDwgdGhpcy5lbmNvZGVycy5sZW5ndGg7IHIrKyl7CiAgICAgICAgICAgIHZhciBzID0gdGhpcy5lbmNvZGVyc1tyXTsKICAgICAgICAgICAgaWYgKHMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgdmFyIG4gPSBzKGUsIHQpOwogICAgICAgICAgICAgICAgaWYgKG4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHZhciBvID0gcjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGcobywgbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBnID8gZSA6IG51bGw7CiAgICB9LCBpLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbihlLCB0LCByKSB7CiAgICAgICAgdmFyIHMgPSB0IDwgMCA/IHRoaXMuYnVpbHRJbkRlY29kZXJzWy0xIC0gdF0gOiB0aGlzLmRlY29kZXJzW3RdOwogICAgICAgIHJldHVybiBzID8gcyhlLCB0LCByKSA6IG5ldyBnKHQsIGUpOwogICAgfSwgaS5kZWZhdWx0Q29kZWMgPSBuZXcgaSwgaTsKfSgpOwpmdW5jdGlvbiBFKGkpIHsKICAgIHJldHVybiBpIGluc3RhbmNlb2YgVWludDhBcnJheSA/IGkgOiBBcnJheUJ1ZmZlci5pc1ZpZXcoaSkgPyBuZXcgVWludDhBcnJheShpLmJ1ZmZlciwgaS5ieXRlT2Zmc2V0LCBpLmJ5dGVMZW5ndGgpIDogaSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyID8gbmV3IFVpbnQ4QXJyYXkoaSkgOiBVaW50OEFycmF5LmZyb20oaSk7Cn0KZnVuY3Rpb24gdGUoaSkgewogICAgaWYgKGkgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgcmV0dXJuIG5ldyBEYXRhVmlldyhpKTsKICAgIHZhciBlID0gRShpKTsKICAgIHJldHVybiBuZXcgRGF0YVZpZXcoZS5idWZmZXIsIGUuYnl0ZU9mZnNldCwgZS5ieXRlTGVuZ3RoKTsKfQp2YXIgZGUgPSAxMDAsIHBlID0gMjA0OCwgUDEgPSBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGkoZSwgdCwgciwgcywgbiwgbywgZiwgYykgewogICAgICAgIGUgPT09IHZvaWQgMCAmJiAoZSA9IEkxLmRlZmF1bHRDb2RlYyksIHQgPT09IHZvaWQgMCAmJiAodCA9IHZvaWQgMCksIHIgPT09IHZvaWQgMCAmJiAociA9IGRlKSwgcyA9PT0gdm9pZCAwICYmIChzID0gcGUpLCBuID09PSB2b2lkIDAgJiYgKG4gPSAhMSksIG8gPT09IHZvaWQgMCAmJiAobyA9ICExKSwgZiA9PT0gdm9pZCAwICYmIChmID0gITEpLCBjID09PSB2b2lkIDAgJiYgKGMgPSAhMSksIHRoaXMuZXh0ZW5zaW9uQ29kZWMgPSBlLCB0aGlzLmNvbnRleHQgPSB0LCB0aGlzLm1heERlcHRoID0gciwgdGhpcy5pbml0aWFsQnVmZmVyU2l6ZSA9IHMsIHRoaXMuc29ydEtleXMgPSBuLCB0aGlzLmZvcmNlRmxvYXQzMiA9IG8sIHRoaXMuaWdub3JlVW5kZWZpbmVkID0gZiwgdGhpcy5mb3JjZUludGVnZXJUb0Zsb2F0ID0gYywgdGhpcy5wb3MgPSAwLCB0aGlzLnZpZXcgPSBuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKHRoaXMuaW5pdGlhbEJ1ZmZlclNpemUpKSwgdGhpcy5ieXRlcyA9IG5ldyBVaW50OEFycmF5KHRoaXMudmlldy5idWZmZXIpOwogICAgfQogICAgcmV0dXJuIGkucHJvdG90eXBlLnJlaW5pdGlhbGl6ZVN0YXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5wb3MgPSAwOwogICAgfSwgaS5wcm90b3R5cGUuZW5jb2RlU2hhcmVkUmVmID0gZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiB0aGlzLnJlaW5pdGlhbGl6ZVN0YXRlKCksIHRoaXMuZG9FbmNvZGUoZSwgMSksIHRoaXMuYnl0ZXMuc3ViYXJyYXkoMCwgdGhpcy5wb3MpOwogICAgfSwgaS5wcm90b3R5cGUuZW5jb2RlID0gZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiB0aGlzLnJlaW5pdGlhbGl6ZVN0YXRlKCksIHRoaXMuZG9FbmNvZGUoZSwgMSksIHRoaXMuYnl0ZXMuc2xpY2UoMCwgdGhpcy5wb3MpOwogICAgfSwgaS5wcm90b3R5cGUuZG9FbmNvZGUgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgaWYgKHQgPiB0aGlzLm1heERlcHRoKSB0aHJvdyBuZXcgRXJyb3IoIlRvbyBkZWVwIG9iamVjdHMgaW4gZGVwdGggIi5jb25jYXQodCkpOwogICAgICAgIGUgPT0gbnVsbCA/IHRoaXMuZW5jb2RlTmlsKCkgOiB0eXBlb2YgZSA9PSAiYm9vbGVhbiIgPyB0aGlzLmVuY29kZUJvb2xlYW4oZSkgOiB0eXBlb2YgZSA9PSAibnVtYmVyIiA/IHRoaXMuZW5jb2RlTnVtYmVyKGUpIDogdHlwZW9mIGUgPT0gInN0cmluZyIgPyB0aGlzLmVuY29kZVN0cmluZyhlKSA6IHRoaXMuZW5jb2RlT2JqZWN0KGUsIHQpOwogICAgfSwgaS5wcm90b3R5cGUuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIHQgPSB0aGlzLnBvcyArIGU7CiAgICAgICAgdGhpcy52aWV3LmJ5dGVMZW5ndGggPCB0ICYmIHRoaXMucmVzaXplQnVmZmVyKHQgKiAyKTsKICAgIH0sIGkucHJvdG90eXBlLnJlc2l6ZUJ1ZmZlciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgdCA9IG5ldyBBcnJheUJ1ZmZlcihlKSwgciA9IG5ldyBVaW50OEFycmF5KHQpLCBzID0gbmV3IERhdGFWaWV3KHQpOwogICAgICAgIHIuc2V0KHRoaXMuYnl0ZXMpLCB0aGlzLnZpZXcgPSBzLCB0aGlzLmJ5dGVzID0gcjsKICAgIH0sIGkucHJvdG90eXBlLmVuY29kZU5pbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMud3JpdGVVOCgxOTIpOwogICAgfSwgaS5wcm90b3R5cGUuZW5jb2RlQm9vbGVhbiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICBlID09PSAhMSA/IHRoaXMud3JpdGVVOCgxOTQpIDogdGhpcy53cml0ZVU4KDE5NSk7CiAgICB9LCBpLnByb3RvdHlwZS5lbmNvZGVOdW1iZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgTnVtYmVyLmlzU2FmZUludGVnZXIoZSkgJiYgIXRoaXMuZm9yY2VJbnRlZ2VyVG9GbG9hdCA/IGUgPj0gMCA/IGUgPCAxMjggPyB0aGlzLndyaXRlVTgoZSkgOiBlIDwgMjU2ID8gKHRoaXMud3JpdGVVOCgyMDQpLCB0aGlzLndyaXRlVTgoZSkpIDogZSA8IDY1NTM2ID8gKHRoaXMud3JpdGVVOCgyMDUpLCB0aGlzLndyaXRlVTE2KGUpKSA6IGUgPCA0Mjk0OTY3Mjk2ID8gKHRoaXMud3JpdGVVOCgyMDYpLCB0aGlzLndyaXRlVTMyKGUpKSA6ICh0aGlzLndyaXRlVTgoMjA3KSwgdGhpcy53cml0ZVU2NChlKSkgOiBlID49IC0zMiA/IHRoaXMud3JpdGVVOCgyMjQgfCBlICsgMzIpIDogZSA+PSAtMTI4ID8gKHRoaXMud3JpdGVVOCgyMDgpLCB0aGlzLndyaXRlSTgoZSkpIDogZSA+PSAtMzI3NjggPyAodGhpcy53cml0ZVU4KDIwOSksIHRoaXMud3JpdGVJMTYoZSkpIDogZSA+PSAtMjE0NzQ4MzY0OCA/ICh0aGlzLndyaXRlVTgoMjEwKSwgdGhpcy53cml0ZUkzMihlKSkgOiAodGhpcy53cml0ZVU4KDIxMSksIHRoaXMud3JpdGVJNjQoZSkpIDogdGhpcy5mb3JjZUZsb2F0MzIgPyAodGhpcy53cml0ZVU4KDIwMiksIHRoaXMud3JpdGVGMzIoZSkpIDogKHRoaXMud3JpdGVVOCgyMDMpLCB0aGlzLndyaXRlRjY0KGUpKTsKICAgIH0sIGkucHJvdG90eXBlLndyaXRlU3RyaW5nSGVhZGVyID0gZnVuY3Rpb24oZSkgewogICAgICAgIGlmIChlIDwgMzIpIHRoaXMud3JpdGVVOCgxNjAgKyBlKTsKICAgICAgICBlbHNlIGlmIChlIDwgMjU2KSB0aGlzLndyaXRlVTgoMjE3KSwgdGhpcy53cml0ZVU4KGUpOwogICAgICAgIGVsc2UgaWYgKGUgPCA2NTUzNikgdGhpcy53cml0ZVU4KDIxOCksIHRoaXMud3JpdGVVMTYoZSk7CiAgICAgICAgZWxzZSBpZiAoZSA8IDQyOTQ5NjcyOTYpIHRoaXMud3JpdGVVOCgyMTkpLCB0aGlzLndyaXRlVTMyKGUpOwogICAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKCJUb28gbG9uZyBzdHJpbmc6ICIuY29uY2F0KGUsICIgYnl0ZXMgaW4gVVRGLTgiKSk7CiAgICB9LCBpLnByb3RvdHlwZS5lbmNvZGVTdHJpbmcgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIHQgPSA1LCByID0gZS5sZW5ndGg7CiAgICAgICAgaWYgKHIgPiBXMSkgewogICAgICAgICAgICB2YXIgcyA9IEYxKGUpOwogICAgICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKHQgKyBzKSwgdGhpcy53cml0ZVN0cmluZ0hlYWRlcihzKSwgRyhlLCB0aGlzLmJ5dGVzLCB0aGlzLnBvcyksIHRoaXMucG9zICs9IHM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHMgPSBGMShlKTsKICAgICAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSh0ICsgcyksIHRoaXMud3JpdGVTdHJpbmdIZWFkZXIocyksIFgxKGUsIHRoaXMuYnl0ZXMsIHRoaXMucG9zKSwgdGhpcy5wb3MgKz0gczsKICAgICAgICB9CiAgICB9LCBpLnByb3RvdHlwZS5lbmNvZGVPYmplY3QgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLmV4dGVuc2lvbkNvZGVjLnRyeVRvRW5jb2RlKGUsIHRoaXMuY29udGV4dCk7CiAgICAgICAgaWYgKHIgIT0gbnVsbCkgdGhpcy5lbmNvZGVFeHRlbnNpb24ocik7CiAgICAgICAgZWxzZSBpZiAoQXJyYXkuaXNBcnJheShlKSkgdGhpcy5lbmNvZGVBcnJheShlLCB0KTsKICAgICAgICBlbHNlIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcoZSkpIHRoaXMuZW5jb2RlQmluYXJ5KGUpOwogICAgICAgIGVsc2UgaWYgKHR5cGVvZiBlID09ICJvYmplY3QiKSB0aGlzLmVuY29kZU1hcChlLCB0KTsKICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIG9iamVjdDogIi5jb25jYXQoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseShlKSkpOwogICAgfSwgaS5wcm90b3R5cGUuZW5jb2RlQmluYXJ5ID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciB0ID0gZS5ieXRlTGVuZ3RoOwogICAgICAgIGlmICh0IDwgMjU2KSB0aGlzLndyaXRlVTgoMTk2KSwgdGhpcy53cml0ZVU4KHQpOwogICAgICAgIGVsc2UgaWYgKHQgPCA2NTUzNikgdGhpcy53cml0ZVU4KDE5NyksIHRoaXMud3JpdGVVMTYodCk7CiAgICAgICAgZWxzZSBpZiAodCA8IDQyOTQ5NjcyOTYpIHRoaXMud3JpdGVVOCgxOTgpLCB0aGlzLndyaXRlVTMyKHQpOwogICAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKCJUb28gbGFyZ2UgYmluYXJ5OiAiLmNvbmNhdCh0KSk7CiAgICAgICAgdmFyIHIgPSBFKGUpOwogICAgICAgIHRoaXMud3JpdGVVOGEocik7CiAgICB9LCBpLnByb3RvdHlwZS5lbmNvZGVBcnJheSA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICB2YXIgciA9IGUubGVuZ3RoOwogICAgICAgIGlmIChyIDwgMTYpIHRoaXMud3JpdGVVOCgxNDQgKyByKTsKICAgICAgICBlbHNlIGlmIChyIDwgNjU1MzYpIHRoaXMud3JpdGVVOCgyMjApLCB0aGlzLndyaXRlVTE2KHIpOwogICAgICAgIGVsc2UgaWYgKHIgPCA0Mjk0OTY3Mjk2KSB0aGlzLndyaXRlVTgoMjIxKSwgdGhpcy53cml0ZVUzMihyKTsKICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiVG9vIGxhcmdlIGFycmF5OiAiLmNvbmNhdChyKSk7CiAgICAgICAgZm9yKHZhciBzID0gMCwgbiA9IGU7IHMgPCBuLmxlbmd0aDsgcysrKXsKICAgICAgICAgICAgdmFyIG8gPSBuW3NdOwogICAgICAgICAgICB0aGlzLmRvRW5jb2RlKG8sIHQgKyAxKTsKICAgICAgICB9CiAgICB9LCBpLnByb3RvdHlwZS5jb3VudFdpdGhvdXRVbmRlZmluZWQgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgZm9yKHZhciByID0gMCwgcyA9IDAsIG4gPSB0OyBzIDwgbi5sZW5ndGg7IHMrKyl7CiAgICAgICAgICAgIHZhciBvID0gbltzXTsKICAgICAgICAgICAgZVtvXSAhPT0gdm9pZCAwICYmIHIrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHI7CiAgICB9LCBpLnByb3RvdHlwZS5lbmNvZGVNYXAgPSBmdW5jdGlvbihlLCB0KSB7CiAgICAgICAgdmFyIHIgPSBPYmplY3Qua2V5cyhlKTsKICAgICAgICB0aGlzLnNvcnRLZXlzICYmIHIuc29ydCgpOwogICAgICAgIHZhciBzID0gdGhpcy5pZ25vcmVVbmRlZmluZWQgPyB0aGlzLmNvdW50V2l0aG91dFVuZGVmaW5lZChlLCByKSA6IHIubGVuZ3RoOwogICAgICAgIGlmIChzIDwgMTYpIHRoaXMud3JpdGVVOCgxMjggKyBzKTsKICAgICAgICBlbHNlIGlmIChzIDwgNjU1MzYpIHRoaXMud3JpdGVVOCgyMjIpLCB0aGlzLndyaXRlVTE2KHMpOwogICAgICAgIGVsc2UgaWYgKHMgPCA0Mjk0OTY3Mjk2KSB0aGlzLndyaXRlVTgoMjIzKSwgdGhpcy53cml0ZVUzMihzKTsKICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiVG9vIGxhcmdlIG1hcCBvYmplY3Q6ICIuY29uY2F0KHMpKTsKICAgICAgICBmb3IodmFyIG4gPSAwLCBvID0gcjsgbiA8IG8ubGVuZ3RoOyBuKyspewogICAgICAgICAgICB2YXIgZiA9IG9bbl0sIGMgPSBlW2ZdOwogICAgICAgICAgICB0aGlzLmlnbm9yZVVuZGVmaW5lZCAmJiBjID09PSB2b2lkIDAgfHwgKHRoaXMuZW5jb2RlU3RyaW5nKGYpLCB0aGlzLmRvRW5jb2RlKGMsIHQgKyAxKSk7CiAgICAgICAgfQogICAgfSwgaS5wcm90b3R5cGUuZW5jb2RlRXh0ZW5zaW9uID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciB0ID0gZS5kYXRhLmxlbmd0aDsKICAgICAgICBpZiAodCA9PT0gMSkgdGhpcy53cml0ZVU4KDIxMik7CiAgICAgICAgZWxzZSBpZiAodCA9PT0gMikgdGhpcy53cml0ZVU4KDIxMyk7CiAgICAgICAgZWxzZSBpZiAodCA9PT0gNCkgdGhpcy53cml0ZVU4KDIxNCk7CiAgICAgICAgZWxzZSBpZiAodCA9PT0gOCkgdGhpcy53cml0ZVU4KDIxNSk7CiAgICAgICAgZWxzZSBpZiAodCA9PT0gMTYpIHRoaXMud3JpdGVVOCgyMTYpOwogICAgICAgIGVsc2UgaWYgKHQgPCAyNTYpIHRoaXMud3JpdGVVOCgxOTkpLCB0aGlzLndyaXRlVTgodCk7CiAgICAgICAgZWxzZSBpZiAodCA8IDY1NTM2KSB0aGlzLndyaXRlVTgoMjAwKSwgdGhpcy53cml0ZVUxNih0KTsKICAgICAgICBlbHNlIGlmICh0IDwgNDI5NDk2NzI5NikgdGhpcy53cml0ZVU4KDIwMSksIHRoaXMud3JpdGVVMzIodCk7CiAgICAgICAgZWxzZSB0aHJvdyBuZXcgRXJyb3IoIlRvbyBsYXJnZSBleHRlbnNpb24gb2JqZWN0OiAiLmNvbmNhdCh0KSk7CiAgICAgICAgdGhpcy53cml0ZUk4KGUudHlwZSksIHRoaXMud3JpdGVVOGEoZS5kYXRhKTsKICAgIH0sIGkucHJvdG90eXBlLndyaXRlVTggPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSgxKSwgdGhpcy52aWV3LnNldFVpbnQ4KHRoaXMucG9zLCBlKSwgdGhpcy5wb3MrKzsKICAgIH0sIGkucHJvdG90eXBlLndyaXRlVThhID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciB0ID0gZS5sZW5ndGg7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSh0KSwgdGhpcy5ieXRlcy5zZXQoZSwgdGhpcy5wb3MpLCB0aGlzLnBvcyArPSB0OwogICAgfSwgaS5wcm90b3R5cGUud3JpdGVJOCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDEpLCB0aGlzLnZpZXcuc2V0SW50OCh0aGlzLnBvcywgZSksIHRoaXMucG9zKys7CiAgICB9LCBpLnByb3RvdHlwZS53cml0ZVUxNiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDIpLCB0aGlzLnZpZXcuc2V0VWludDE2KHRoaXMucG9zLCBlKSwgdGhpcy5wb3MgKz0gMjsKICAgIH0sIGkucHJvdG90eXBlLndyaXRlSTE2ID0gZnVuY3Rpb24oZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoMiksIHRoaXMudmlldy5zZXRJbnQxNih0aGlzLnBvcywgZSksIHRoaXMucG9zICs9IDI7CiAgICB9LCBpLnByb3RvdHlwZS53cml0ZVUzMiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDQpLCB0aGlzLnZpZXcuc2V0VWludDMyKHRoaXMucG9zLCBlKSwgdGhpcy5wb3MgKz0gNDsKICAgIH0sIGkucHJvdG90eXBlLndyaXRlSTMyID0gZnVuY3Rpb24oZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoNCksIHRoaXMudmlldy5zZXRJbnQzMih0aGlzLnBvcywgZSksIHRoaXMucG9zICs9IDQ7CiAgICB9LCBpLnByb3RvdHlwZS53cml0ZUYzMiA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDQpLCB0aGlzLnZpZXcuc2V0RmxvYXQzMih0aGlzLnBvcywgZSksIHRoaXMucG9zICs9IDQ7CiAgICB9LCBpLnByb3RvdHlwZS53cml0ZUY2NCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDgpLCB0aGlzLnZpZXcuc2V0RmxvYXQ2NCh0aGlzLnBvcywgZSksIHRoaXMucG9zICs9IDg7CiAgICB9LCBpLnByb3RvdHlwZS53cml0ZVU2NCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDgpLCBIKHRoaXMudmlldywgdGhpcy5wb3MsIGUpLCB0aGlzLnBvcyArPSA4OwogICAgfSwgaS5wcm90b3R5cGUud3JpdGVJNjQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSg4KSwgQSh0aGlzLnZpZXcsIHRoaXMucG9zLCBlKSwgdGhpcy5wb3MgKz0gODsKICAgIH0sIGk7Cn0oKTsKdmFyIHhlID0ge307CmZ1bmN0aW9uIHZlKGksIGUpIHsKICAgIGUgPT09IHZvaWQgMCAmJiAoZSA9IHhlKTsKICAgIHZhciB0ID0gbmV3IFAxKGUuZXh0ZW5zaW9uQ29kZWMsIGUuY29udGV4dCwgZS5tYXhEZXB0aCwgZS5pbml0aWFsQnVmZmVyU2l6ZSwgZS5zb3J0S2V5cywgZS5mb3JjZUZsb2F0MzIsIGUuaWdub3JlVW5kZWZpbmVkLCBlLmZvcmNlSW50ZWdlclRvRmxvYXQpOwogICAgcmV0dXJuIHQuZW5jb2RlU2hhcmVkUmVmKGkpOwp9CmZ1bmN0aW9uIHooaSkgewogICAgcmV0dXJuICIiLmNvbmNhdChpIDwgMCA/ICItIiA6ICIiLCAiMHgiKS5jb25jYXQoTWF0aC5hYnMoaSkudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIikpOwp9CnZhciB3ZSA9IDE2LCB5ZSA9IDE2LCByZSA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gaShlLCB0KSB7CiAgICAgICAgZSA9PT0gdm9pZCAwICYmIChlID0gd2UpLCB0ID09PSB2b2lkIDAgJiYgKHQgPSB5ZSksIHRoaXMubWF4S2V5TGVuZ3RoID0gZSwgdGhpcy5tYXhMZW5ndGhQZXJLZXkgPSB0LCB0aGlzLmhpdCA9IDAsIHRoaXMubWlzcyA9IDAsIHRoaXMuY2FjaGVzID0gW107CiAgICAgICAgZm9yKHZhciByID0gMDsgciA8IHRoaXMubWF4S2V5TGVuZ3RoOyByKyspdGhpcy5jYWNoZXMucHVzaChbXSk7CiAgICB9CiAgICByZXR1cm4gaS5wcm90b3R5cGUuY2FuQmVDYWNoZWQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgcmV0dXJuIGUgPiAwICYmIGUgPD0gdGhpcy5tYXhLZXlMZW5ndGg7CiAgICB9LCBpLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24oZSwgdCwgcikgewogICAgICAgIHZhciBzID0gdGhpcy5jYWNoZXNbciAtIDFdOwogICAgICAgIGU6IGZvcih2YXIgbiA9IDAsIG8gPSBzOyBuIDwgby5sZW5ndGg7IG4rKyl7CiAgICAgICAgICAgIGZvcih2YXIgZiA9IG9bbl0sIGMgPSBmLmJ5dGVzLCBhID0gMDsgYSA8IHI7IGErKylpZiAoY1thXSAhPT0gZVt0ICsgYV0pIGNvbnRpbnVlIGU7CiAgICAgICAgICAgIHJldHVybiBmLnN0cjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9LCBpLnByb3RvdHlwZS5zdG9yZSA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICB2YXIgciA9IHRoaXMuY2FjaGVzW2UubGVuZ3RoIC0gMV0sIHMgPSB7CiAgICAgICAgICAgIGJ5dGVzOiBlLAogICAgICAgICAgICBzdHI6IHQKICAgICAgICB9OwogICAgICAgIHIubGVuZ3RoID49IHRoaXMubWF4TGVuZ3RoUGVyS2V5ID8gcltNYXRoLnJhbmRvbSgpICogci5sZW5ndGggfCAwXSA9IHMgOiByLnB1c2gocyk7CiAgICB9LCBpLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbihlLCB0LCByKSB7CiAgICAgICAgdmFyIHMgPSB0aGlzLmZpbmQoZSwgdCwgcik7CiAgICAgICAgaWYgKHMgIT0gbnVsbCkgcmV0dXJuIHRoaXMuaGl0KyssIHM7CiAgICAgICAgdGhpcy5taXNzKys7CiAgICAgICAgdmFyIG4gPSBDKGUsIHQsIHIpLCBvID0gVWludDhBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChlLCB0LCB0ICsgcik7CiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmUobywgbiksIG47CiAgICB9LCBpOwp9KCk7CnZhciBtZSA9IGZ1bmN0aW9uKGksIGUsIHQsIHIpIHsKICAgIGZ1bmN0aW9uIHMobikgewogICAgICAgIHJldHVybiBuIGluc3RhbmNlb2YgdCA/IG4gOiBuZXcgdChmdW5jdGlvbihvKSB7CiAgICAgICAgICAgIG8obik7CiAgICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gbmV3ICh0IHx8ICh0ID0gUHJvbWlzZSkpKGZ1bmN0aW9uKG4sIG8pIHsKICAgICAgICBmdW5jdGlvbiBmKGgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGEoci5uZXh0KGgpKTsKICAgICAgICAgICAgfSBjYXRjaCAoZCkgewogICAgICAgICAgICAgICAgbyhkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjKGgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGEoci50aHJvdyhoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGQpIHsKICAgICAgICAgICAgICAgIG8oZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYShoKSB7CiAgICAgICAgICAgIGguZG9uZSA/IG4oaC52YWx1ZSkgOiBzKGgudmFsdWUpLnRoZW4oZiwgYyk7CiAgICAgICAgfQogICAgICAgIGEoKHIgPSByLmFwcGx5KGksIGUgfHwgW10pKS5uZXh0KCkpOwogICAgfSk7Cn0sIFYxID0gZnVuY3Rpb24oaSwgZSkgewogICAgdmFyIHQgPSB7CiAgICAgICAgbGFiZWw6IDAsCiAgICAgICAgc2VudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChuWzBdICYgMSkgdGhyb3cgblsxXTsKICAgICAgICAgICAgcmV0dXJuIG5bMV07CiAgICAgICAgfSwKICAgICAgICB0cnlzOiBbXSwKICAgICAgICBvcHM6IFtdCiAgICB9LCByLCBzLCBuLCBvOwogICAgcmV0dXJuIG8gPSB7CiAgICAgICAgbmV4dDogZigwKSwKICAgICAgICB0aHJvdzogZigxKSwKICAgICAgICByZXR1cm46IGYoMikKICAgIH0sIHR5cGVvZiBTeW1ib2wgPT0gImZ1bmN0aW9uIiAmJiAob1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9KSwgbzsKICAgIGZ1bmN0aW9uIGYoYSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbihoKSB7CiAgICAgICAgICAgIHJldHVybiBjKFsKICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICBoCiAgICAgICAgICAgIF0pOwogICAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBjKGEpIHsKICAgICAgICBpZiAocikgdGhyb3cgbmV3IFR5cGVFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLiIpOwogICAgICAgIGZvcig7IHQ7KXRyeSB7CiAgICAgICAgICAgIGlmIChyID0gMSwgcyAmJiAobiA9IGFbMF0gJiAyID8gcy5yZXR1cm4gOiBhWzBdID8gcy50aHJvdyB8fCAoKG4gPSBzLnJldHVybikgJiYgbi5jYWxsKHMpLCAwKSA6IHMubmV4dCkgJiYgIShuID0gbi5jYWxsKHMsIGFbMV0pKS5kb25lKSByZXR1cm4gbjsKICAgICAgICAgICAgc3dpdGNoKHMgPSAwLCBuICYmIChhID0gWwogICAgICAgICAgICAgICAgYVswXSAmIDIsCiAgICAgICAgICAgICAgICBuLnZhbHVlCiAgICAgICAgICAgIF0pLCBhWzBdKXsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICBuID0gYTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5sYWJlbCsrLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhWzFdLAogICAgICAgICAgICAgICAgICAgICAgICBkb25lOiAhMQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgdC5sYWJlbCsrLCBzID0gYVsxXSwgYSA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgMAogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgYSA9IHQub3BzLnBvcCgpLCB0LnRyeXMucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGlmIChuID0gdC50cnlzLCAhKG4gPSBuLmxlbmd0aCA+IDAgJiYgbltuLmxlbmd0aCAtIDFdKSAmJiAoYVswXSA9PT0gNiB8fCBhWzBdID09PSAyKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChhWzBdID09PSAzICYmICghbiB8fCBhWzFdID4gblswXSAmJiBhWzFdIDwgblszXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdC5sYWJlbCA9IGFbMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoYVswXSA9PT0gNiAmJiB0LmxhYmVsIDwgblsxXSkgewogICAgICAgICAgICAgICAgICAgICAgICB0LmxhYmVsID0gblsxXSwgbiA9IGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobiAmJiB0LmxhYmVsIDwgblsyXSkgewogICAgICAgICAgICAgICAgICAgICAgICB0LmxhYmVsID0gblsyXSwgdC5vcHMucHVzaChhKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG5bMl0gJiYgdC5vcHMucG9wKCksIHQudHJ5cy5wb3AoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhID0gZS5jYWxsKGksIHQpOwogICAgICAgIH0gY2F0Y2ggKGgpIHsKICAgICAgICAgICAgYSA9IFsKICAgICAgICAgICAgICAgIDYsCiAgICAgICAgICAgICAgICBoCiAgICAgICAgICAgIF0sIHMgPSAwOwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgciA9IG4gPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoYVswXSAmIDUpIHRocm93IGFbMV07CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IGFbMF0gPyBhWzFdIDogdm9pZCAwLAogICAgICAgICAgICBkb25lOiAhMAogICAgICAgIH07CiAgICB9Cn0sIGllID0gZnVuY3Rpb24oaSkgewogICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7CiAgICB2YXIgZSA9IGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCB0OwogICAgcmV0dXJuIGUgPyBlLmNhbGwoaSkgOiAoaSA9IHR5cGVvZiBfX3ZhbHVlcyA9PSAiZnVuY3Rpb24iID8gX192YWx1ZXMoaSkgOiBpW1N5bWJvbC5pdGVyYXRvcl0oKSwgdCA9IHt9LCByKCJuZXh0IiksIHIoInRocm93IiksIHIoInJldHVybiIpLCB0W1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwgdCk7CiAgICBmdW5jdGlvbiByKG4pIHsKICAgICAgICB0W25dID0gaVtuXSAmJiBmdW5jdGlvbihvKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihmLCBjKSB7CiAgICAgICAgICAgICAgICBvID0gaVtuXShvKSwgcyhmLCBjLCBvLmRvbmUsIG8udmFsdWUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gcyhuLCBvLCBmLCBjKSB7CiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKGMpLnRoZW4oZnVuY3Rpb24oYSkgewogICAgICAgICAgICBuKHsKICAgICAgICAgICAgICAgIHZhbHVlOiBhLAogICAgICAgICAgICAgICAgZG9uZTogZgogICAgICAgICAgICB9KTsKICAgICAgICB9LCBvKTsKICAgIH0KfSwgVSA9IGZ1bmN0aW9uKGkpIHsKICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgVSA/ICh0aGlzLnYgPSBpLCB0aGlzKSA6IG5ldyBVKGkpOwp9LCBnZSA9IGZ1bmN0aW9uKGksIGUsIHQpIHsKICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwogICAgdmFyIHIgPSB0LmFwcGx5KGksIGUgfHwgW10pLCBzLCBuID0gW107CiAgICByZXR1cm4gcyA9IHt9LCBvKCJuZXh0IiksIG8oInRocm93IiksIG8oInJldHVybiIpLCBzW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwgczsKICAgIGZ1bmN0aW9uIG8odSkgewogICAgICAgIHJbdV0gJiYgKHNbdV0gPSBmdW5jdGlvbihsKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihwLCBtKSB7CiAgICAgICAgICAgICAgICBuLnB1c2goWwogICAgICAgICAgICAgICAgICAgIHUsCiAgICAgICAgICAgICAgICAgICAgbCwKICAgICAgICAgICAgICAgICAgICBwLAogICAgICAgICAgICAgICAgICAgIG0KICAgICAgICAgICAgICAgIF0pID4gMSB8fCBmKHUsIGwpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIGYodSwgbCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGMoclt1XShsKSk7CiAgICAgICAgfSBjYXRjaCAocCkgewogICAgICAgICAgICBkKG5bMF1bM10sIHApOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGModSkgewogICAgICAgIHUudmFsdWUgaW5zdGFuY2VvZiBVID8gUHJvbWlzZS5yZXNvbHZlKHUudmFsdWUudikudGhlbihhLCBoKSA6IGQoblswXVsyXSwgdSk7CiAgICB9CiAgICBmdW5jdGlvbiBhKHUpIHsKICAgICAgICBmKCJuZXh0IiwgdSk7CiAgICB9CiAgICBmdW5jdGlvbiBoKHUpIHsKICAgICAgICBmKCJ0aHJvdyIsIHUpOwogICAgfQogICAgZnVuY3Rpb24gZCh1LCBsKSB7CiAgICAgICAgdShsKSwgbi5zaGlmdCgpLCBuLmxlbmd0aCAmJiBmKG5bMF1bMF0sIG5bMF1bMV0pOwogICAgfQp9LCBFZSA9IGZ1bmN0aW9uKGkpIHsKICAgIHZhciBlID0gdHlwZW9mIGk7CiAgICByZXR1cm4gZSA9PT0gInN0cmluZyIgfHwgZSA9PT0gIm51bWJlciI7Cn0sIF8gPSAtMSwgTjEgPSBuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKDApKSwgVWUgPSBuZXcgVWludDhBcnJheShOMS5idWZmZXIpLCBMID0gZnVuY3Rpb24oKSB7CiAgICB0cnkgewogICAgICAgIE4xLmdldEludDgoMCk7CiAgICB9IGNhdGNoIChpKSB7CiAgICAgICAgcmV0dXJuIGkuY29uc3RydWN0b3I7CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoIm5ldmVyIHJlYWNoZWQiKTsKfSgpLCBuZSA9IG5ldyBMKCJJbnN1ZmZpY2llbnQgZGF0YSIpLCBTZSA9IG5ldyByZSwgdyA9IGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gaShlLCB0LCByLCBzLCBuLCBvLCBmLCBjKSB7CiAgICAgICAgZSA9PT0gdm9pZCAwICYmIChlID0gSTEuZGVmYXVsdENvZGVjKSwgdCA9PT0gdm9pZCAwICYmICh0ID0gdm9pZCAwKSwgciA9PT0gdm9pZCAwICYmIChyID0gdiksIHMgPT09IHZvaWQgMCAmJiAocyA9IHYpLCBuID09PSB2b2lkIDAgJiYgKG4gPSB2KSwgbyA9PT0gdm9pZCAwICYmIChvID0gdiksIGYgPT09IHZvaWQgMCAmJiAoZiA9IHYpLCBjID09PSB2b2lkIDAgJiYgKGMgPSBTZSksIHRoaXMuZXh0ZW5zaW9uQ29kZWMgPSBlLCB0aGlzLmNvbnRleHQgPSB0LCB0aGlzLm1heFN0ckxlbmd0aCA9IHIsIHRoaXMubWF4QmluTGVuZ3RoID0gcywgdGhpcy5tYXhBcnJheUxlbmd0aCA9IG4sIHRoaXMubWF4TWFwTGVuZ3RoID0gbywgdGhpcy5tYXhFeHRMZW5ndGggPSBmLCB0aGlzLmtleURlY29kZXIgPSBjLCB0aGlzLnRvdGFsUG9zID0gMCwgdGhpcy5wb3MgPSAwLCB0aGlzLnZpZXcgPSBOMSwgdGhpcy5ieXRlcyA9IFVlLCB0aGlzLmhlYWRCeXRlID0gXywgdGhpcy5zdGFjayA9IFtdOwogICAgfQogICAgcmV0dXJuIGkucHJvdG90eXBlLnJlaW5pdGlhbGl6ZVN0YXRlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy50b3RhbFBvcyA9IDAsIHRoaXMuaGVhZEJ5dGUgPSBfLCB0aGlzLnN0YWNrLmxlbmd0aCA9IDA7CiAgICB9LCBpLnByb3RvdHlwZS5zZXRCdWZmZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdGhpcy5ieXRlcyA9IEUoZSksIHRoaXMudmlldyA9IHRlKHRoaXMuYnl0ZXMpLCB0aGlzLnBvcyA9IDA7CiAgICB9LCBpLnByb3RvdHlwZS5hcHBlbmRCdWZmZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKHRoaXMuaGVhZEJ5dGUgPT09IF8gJiYgIXRoaXMuaGFzUmVtYWluaW5nKDEpKSB0aGlzLnNldEJ1ZmZlcihlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmJ5dGVzLnN1YmFycmF5KHRoaXMucG9zKSwgciA9IEUoZSksIHMgPSBuZXcgVWludDhBcnJheSh0Lmxlbmd0aCArIHIubGVuZ3RoKTsKICAgICAgICAgICAgcy5zZXQodCksIHMuc2V0KHIsIHQubGVuZ3RoKSwgdGhpcy5zZXRCdWZmZXIocyk7CiAgICAgICAgfQogICAgfSwgaS5wcm90b3R5cGUuaGFzUmVtYWluaW5nID0gZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiB0aGlzLnZpZXcuYnl0ZUxlbmd0aCAtIHRoaXMucG9zID49IGU7CiAgICB9LCBpLnByb3RvdHlwZS5jcmVhdGVFeHRyYUJ5dGVFcnJvciA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgdCA9IHRoaXMsIHIgPSB0LnZpZXcsIHMgPSB0LnBvczsKICAgICAgICByZXR1cm4gbmV3IFJhbmdlRXJyb3IoIkV4dHJhICIuY29uY2F0KHIuYnl0ZUxlbmd0aCAtIHMsICIgb2YgIikuY29uY2F0KHIuYnl0ZUxlbmd0aCwgIiBieXRlKHMpIGZvdW5kIGF0IGJ1ZmZlclsiKS5jb25jYXQoZSwgIl0iKSk7CiAgICB9LCBpLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdGhpcy5yZWluaXRpYWxpemVTdGF0ZSgpLCB0aGlzLnNldEJ1ZmZlcihlKTsKICAgICAgICB2YXIgdCA9IHRoaXMuZG9EZWNvZGVTeW5jKCk7CiAgICAgICAgaWYgKHRoaXMuaGFzUmVtYWluaW5nKDEpKSB0aHJvdyB0aGlzLmNyZWF0ZUV4dHJhQnl0ZUVycm9yKHRoaXMucG9zKTsKICAgICAgICByZXR1cm4gdDsKICAgIH0sIGkucHJvdG90eXBlLmRlY29kZU11bHRpID0gZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiBWMSh0aGlzLCBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgIHN3aXRjaCh0LmxhYmVsKXsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlaW5pdGlhbGl6ZVN0YXRlKCksIHRoaXMuc2V0QnVmZmVyKGUpLCB0LmxhYmVsID0gMTsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5oYXNSZW1haW5pbmcoMSkgPyBbCiAgICAgICAgICAgICAgICAgICAgICAgIDQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9EZWNvZGVTeW5jKCkKICAgICAgICAgICAgICAgICAgICBdIDogWwogICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAzCiAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5zZW50KCksIFsKICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgMQogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgMgogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sIGkucHJvdG90eXBlLmRlY29kZUFzeW5jID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciB0LCByLCBzLCBuOwogICAgICAgIHJldHVybiBtZSh0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBvLCBmLCBjLCBhLCBoLCBkLCB1LCBsOwogICAgICAgICAgICByZXR1cm4gVjEodGhpcywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgc3dpdGNoKHAubGFiZWwpewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgbyA9ICExLCBwLmxhYmVsID0gMTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHAudHJ5cy5wdXNoKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA2LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgNywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEyCiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB0ID0gaWUoZSksIHAubGFiZWwgPSAyOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0Lm5leHQoKQogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIgPSBwLnNlbnQoKSwgISFyLmRvbmUpIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgNQogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9IHIudmFsdWUsIG8pIHRocm93IHRoaXMuY3JlYXRlRXh0cmFCeXRlRXJyb3IodGhpcy50b3RhbFBvcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kQnVmZmVyKGMpOwogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiA9IHRoaXMuZG9EZWNvZGVTeW5jKCksIG8gPSAhMDsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEobSBpbnN0YW5jZW9mIEwpKSB0aHJvdyBtOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG90YWxQb3MgKz0gdGhpcy5wb3MsIHAubGFiZWwgPSA0OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEyCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSA9IHAuc2VudCgpLCBzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGEKICAgICAgICAgICAgICAgICAgICAgICAgfSwgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEyCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC50cnlzLnB1c2goWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgNywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTEKICAgICAgICAgICAgICAgICAgICAgICAgXSksIHIgJiYgIXIuZG9uZSAmJiAobiA9IHQucmV0dXJuKSA/IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmNhbGwodCkKICAgICAgICAgICAgICAgICAgICAgICAgXSA6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA5CiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgICAgICBwLnNlbnQoKSwgcC5sYWJlbCA9IDk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDExCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHMpIHRocm93IHMuZXJyb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA3CiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDcKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFzUmVtYWluaW5nKDEpKSB0aHJvdyB0aGlzLmNyZWF0ZUV4dHJhQnl0ZUVycm9yKHRoaXMudG90YWxQb3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgaCA9IHRoaXMsIGQgPSBoLmhlYWRCeXRlLCB1ID0gaC5wb3MsIGwgPSBoLnRvdGFsUG9zLCBuZXcgUmFuZ2VFcnJvcigiSW5zdWZmaWNpZW50IGRhdGEgaW4gcGFyc2luZyAiLmNvbmNhdCh6KGQpLCAiIGF0ICIpLmNvbmNhdChsLCAiICgiKS5jb25jYXQodSwgIiBpbiB0aGUgY3VycmVudCBidWZmZXIpIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0sIGkucHJvdG90eXBlLmRlY29kZUFycmF5U3RyZWFtID0gZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiB0aGlzLmRlY29kZU11bHRpQXN5bmMoZSwgITApOwogICAgfSwgaS5wcm90b3R5cGUuZGVjb2RlU3RyZWFtID0gZnVuY3Rpb24oZSkgewogICAgICAgIHJldHVybiB0aGlzLmRlY29kZU11bHRpQXN5bmMoZSwgITEpOwogICAgfSwgaS5wcm90b3R5cGUuZGVjb2RlTXVsdGlBc3luYyA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICByZXR1cm4gZ2UodGhpcywgYXJndW1lbnRzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHMsIG4sIG8sIGYsIGMsIGEsIGgsIGQsIHU7CiAgICAgICAgICAgIHJldHVybiBWMSh0aGlzLCBmdW5jdGlvbihsKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2gobC5sYWJlbCl7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICBzID0gdCwgbiA9IC0xLCBsLmxhYmVsID0gMTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGwudHJ5cy5wdXNoKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTkKICAgICAgICAgICAgICAgICAgICAgICAgXSksIG8gPSBpZShlKSwgbC5sYWJlbCA9IDI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFUoby5uZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiA9IGwuc2VudCgpLCAhIWYuZG9uZSkgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMgogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9IGYudmFsdWUsIHQgJiYgbiA9PT0gMCkgdGhyb3cgdGhpcy5jcmVhdGVFeHRyYUJ5dGVFcnJvcih0aGlzLnRvdGFsUG9zKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRCdWZmZXIoYyksIHMgJiYgKG4gPSB0aGlzLnJlYWRBcnJheVNpemUoKSwgcyA9ICExLCB0aGlzLmNvbXBsZXRlKCkpLCBsLmxhYmVsID0gNDsKICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGwudHJ5cy5wdXNoKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTAKICAgICAgICAgICAgICAgICAgICAgICAgXSksIGwubGFiZWwgPSA1OwogICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVKHRoaXMuZG9EZWNvZGVTeW5jKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuc2VudCgpCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbC5zZW50KCksIC0tbiA9PT0gMCA/IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA4CiAgICAgICAgICAgICAgICAgICAgICAgIF0gOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgNQogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEgPSBsLnNlbnQoKSwgIShhIGluc3RhbmNlb2YgTCkpIHRocm93IGE7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTAKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdGFsUG9zICs9IHRoaXMucG9zLCBsLmxhYmVsID0gMTE7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxOQogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoID0gbC5zZW50KCksIGQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogaAogICAgICAgICAgICAgICAgICAgICAgICB9LCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTkKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbC50cnlzLnB1c2goWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxNywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE4CiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCBmICYmICFmLmRvbmUgJiYgKHUgPSBvLnJldHVybikgPyBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVSh1LmNhbGwobykpCiAgICAgICAgICAgICAgICAgICAgICAgIF0gOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTYKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgICAgICBsLnNlbnQoKSwgbC5sYWJlbCA9IDE2OwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMTgKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCkgdGhyb3cgZC5lcnJvcjsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDcKICAgICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgNwogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSwgaS5wcm90b3R5cGUuZG9EZWNvZGVTeW5jID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZTogZm9yKDs7KXsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLnJlYWRIZWFkQnl0ZSgpLCB0ID0gdm9pZCAwOwogICAgICAgICAgICBpZiAoZSA+PSAyMjQpIHQgPSBlIC0gMjU2OwogICAgICAgICAgICBlbHNlIGlmIChlIDwgMTkyKSBpZiAoZSA8IDEyOCkgdCA9IGU7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPCAxNDQpIHsKICAgICAgICAgICAgICAgIHZhciByID0gZSAtIDEyODsKICAgICAgICAgICAgICAgIGlmIChyICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoTWFwU3RhdGUociksIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBlOwogICAgICAgICAgICAgICAgfSBlbHNlIHQgPSB7fTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlIDwgMTYwKSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IGUgLSAxNDQ7CiAgICAgICAgICAgICAgICBpZiAociAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucHVzaEFycmF5U3RhdGUociksIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBlOwogICAgICAgICAgICAgICAgfSBlbHNlIHQgPSBbXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBzID0gZSAtIDE2MDsKICAgICAgICAgICAgICAgIHQgPSB0aGlzLmRlY29kZVV0ZjhTdHJpbmcocywgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoZSA9PT0gMTkyKSB0ID0gbnVsbDsKICAgICAgICAgICAgZWxzZSBpZiAoZSA9PT0gMTk0KSB0ID0gITE7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPT09IDE5NSkgdCA9ICEwOwogICAgICAgICAgICBlbHNlIGlmIChlID09PSAyMDIpIHQgPSB0aGlzLnJlYWRGMzIoKTsKICAgICAgICAgICAgZWxzZSBpZiAoZSA9PT0gMjAzKSB0ID0gdGhpcy5yZWFkRjY0KCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPT09IDIwNCkgdCA9IHRoaXMucmVhZFU4KCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPT09IDIwNSkgdCA9IHRoaXMucmVhZFUxNigpOwogICAgICAgICAgICBlbHNlIGlmIChlID09PSAyMDYpIHQgPSB0aGlzLnJlYWRVMzIoKTsKICAgICAgICAgICAgZWxzZSBpZiAoZSA9PT0gMjA3KSB0ID0gdGhpcy5yZWFkVTY0KCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPT09IDIwOCkgdCA9IHRoaXMucmVhZEk4KCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPT09IDIwOSkgdCA9IHRoaXMucmVhZEkxNigpOwogICAgICAgICAgICBlbHNlIGlmIChlID09PSAyMTApIHQgPSB0aGlzLnJlYWRJMzIoKTsKICAgICAgICAgICAgZWxzZSBpZiAoZSA9PT0gMjExKSB0ID0gdGhpcy5yZWFkSTY0KCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPT09IDIxNykgewogICAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLmxvb2tVOCgpOwogICAgICAgICAgICAgICAgdCA9IHRoaXMuZGVjb2RlVXRmOFN0cmluZyhzLCAxKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlID09PSAyMTgpIHsKICAgICAgICAgICAgICAgIHZhciBzID0gdGhpcy5sb29rVTE2KCk7CiAgICAgICAgICAgICAgICB0ID0gdGhpcy5kZWNvZGVVdGY4U3RyaW5nKHMsIDIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGUgPT09IDIxOSkgewogICAgICAgICAgICAgICAgdmFyIHMgPSB0aGlzLmxvb2tVMzIoKTsKICAgICAgICAgICAgICAgIHQgPSB0aGlzLmRlY29kZVV0ZjhTdHJpbmcocywgNCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZSA9PT0gMjIwKSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMucmVhZFUxNigpOwogICAgICAgICAgICAgICAgaWYgKHIgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2hBcnJheVN0YXRlKHIpLCB0aGlzLmNvbXBsZXRlKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUgZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB0ID0gW107CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZSA9PT0gMjIxKSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMucmVhZFUzMigpOwogICAgICAgICAgICAgICAgaWYgKHIgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2hBcnJheVN0YXRlKHIpLCB0aGlzLmNvbXBsZXRlKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUgZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB0ID0gW107CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZSA9PT0gMjIyKSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMucmVhZFUxNigpOwogICAgICAgICAgICAgICAgaWYgKHIgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2hNYXBTdGF0ZShyKSwgdGhpcy5jb21wbGV0ZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIGU7CiAgICAgICAgICAgICAgICB9IGVsc2UgdCA9IHt9OwogICAgICAgICAgICB9IGVsc2UgaWYgKGUgPT09IDIyMykgewogICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLnJlYWRVMzIoKTsKICAgICAgICAgICAgICAgIGlmIChyICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoTWFwU3RhdGUociksIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBlOwogICAgICAgICAgICAgICAgfSBlbHNlIHQgPSB7fTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlID09PSAxOTYpIHsKICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5sb29rVTgoKTsKICAgICAgICAgICAgICAgIHQgPSB0aGlzLmRlY29kZUJpbmFyeShyLCAxKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlID09PSAxOTcpIHsKICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5sb29rVTE2KCk7CiAgICAgICAgICAgICAgICB0ID0gdGhpcy5kZWNvZGVCaW5hcnkociwgMik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZSA9PT0gMTk4KSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMubG9va1UzMigpOwogICAgICAgICAgICAgICAgdCA9IHRoaXMuZGVjb2RlQmluYXJ5KHIsIDQpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGUgPT09IDIxMikgdCA9IHRoaXMuZGVjb2RlRXh0ZW5zaW9uKDEsIDApOwogICAgICAgICAgICBlbHNlIGlmIChlID09PSAyMTMpIHQgPSB0aGlzLmRlY29kZUV4dGVuc2lvbigyLCAwKTsKICAgICAgICAgICAgZWxzZSBpZiAoZSA9PT0gMjE0KSB0ID0gdGhpcy5kZWNvZGVFeHRlbnNpb24oNCwgMCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPT09IDIxNSkgdCA9IHRoaXMuZGVjb2RlRXh0ZW5zaW9uKDgsIDApOwogICAgICAgICAgICBlbHNlIGlmIChlID09PSAyMTYpIHQgPSB0aGlzLmRlY29kZUV4dGVuc2lvbigxNiwgMCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGUgPT09IDE5OSkgewogICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLmxvb2tVOCgpOwogICAgICAgICAgICAgICAgdCA9IHRoaXMuZGVjb2RlRXh0ZW5zaW9uKHIsIDEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGUgPT09IDIwMCkgewogICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLmxvb2tVMTYoKTsKICAgICAgICAgICAgICAgIHQgPSB0aGlzLmRlY29kZUV4dGVuc2lvbihyLCAyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlID09PSAyMDEpIHsKICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5sb29rVTMyKCk7CiAgICAgICAgICAgICAgICB0ID0gdGhpcy5kZWNvZGVFeHRlbnNpb24ociwgNCk7CiAgICAgICAgICAgIH0gZWxzZSB0aHJvdyBuZXcgeCgiVW5yZWNvZ25pemVkIHR5cGUgYnl0ZTogIi5jb25jYXQoeihlKSkpOwogICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7CiAgICAgICAgICAgIGZvcih2YXIgbiA9IHRoaXMuc3RhY2s7IG4ubGVuZ3RoID4gMDspewogICAgICAgICAgICAgICAgdmFyIG8gPSBuW24ubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBpZiAoby50eXBlID09PSAwKSBpZiAoby5hcnJheVtvLnBvc2l0aW9uXSA9IHQsIG8ucG9zaXRpb24rKywgby5wb3NpdGlvbiA9PT0gby5zaXplKSBuLnBvcCgpLCB0ID0gby5hcnJheTsKICAgICAgICAgICAgICAgIGVsc2UgY29udGludWUgZTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKG8udHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIGlmICghRWUodCkpIHRocm93IG5ldyB4KCJUaGUgdHlwZSBvZiBrZXkgbXVzdCBiZSBzdHJpbmcgb3IgbnVtYmVyIGJ1dCAiICsgdHlwZW9mIHQpOwogICAgICAgICAgICAgICAgICAgIGlmICh0ID09PSAiX19wcm90b19fIikgdGhyb3cgbmV3IHgoIlRoZSBrZXkgX19wcm90b19fIGlzIG5vdCBhbGxvd2VkIik7CiAgICAgICAgICAgICAgICAgICAgby5rZXkgPSB0LCBvLnR5cGUgPSAyOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIGU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG8ubWFwW28ua2V5XSA9IHQsIG8ucmVhZENvdW50KyssIG8ucmVhZENvdW50ID09PSBvLnNpemUpIG4ucG9wKCksIHQgPSBvLm1hcDsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIG8ua2V5ID0gbnVsbCwgby50eXBlID0gMTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH0KICAgIH0sIGkucHJvdG90eXBlLnJlYWRIZWFkQnl0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmhlYWRCeXRlID09PSBfICYmICh0aGlzLmhlYWRCeXRlID0gdGhpcy5yZWFkVTgoKSksIHRoaXMuaGVhZEJ5dGU7CiAgICB9LCBpLnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuaGVhZEJ5dGUgPSBfOwogICAgfSwgaS5wcm90b3R5cGUucmVhZEFycmF5U2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBlID0gdGhpcy5yZWFkSGVhZEJ5dGUoKTsKICAgICAgICBzd2l0Y2goZSl7CiAgICAgICAgICAgIGNhc2UgMjIwOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVhZFUxNigpOwogICAgICAgICAgICBjYXNlIDIyMToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlYWRVMzIoKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZSA8IDE2MCkgcmV0dXJuIGUgLSAxNDQ7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IHgoIlVucmVjb2duaXplZCBhcnJheSB0eXBlIGJ5dGU6ICIuY29uY2F0KHooZSkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LCBpLnByb3RvdHlwZS5wdXNoTWFwU3RhdGUgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKGUgPiB0aGlzLm1heE1hcExlbmd0aCkgdGhyb3cgbmV3IHgoIk1heCBsZW5ndGggZXhjZWVkZWQ6IG1hcCBsZW5ndGggKCIuY29uY2F0KGUsICIpID4gbWF4TWFwTGVuZ3RoTGVuZ3RoICgiKS5jb25jYXQodGhpcy5tYXhNYXBMZW5ndGgsICIpIikpOwogICAgICAgIHRoaXMuc3RhY2sucHVzaCh7CiAgICAgICAgICAgIHR5cGU6IDEsCiAgICAgICAgICAgIHNpemU6IGUsCiAgICAgICAgICAgIGtleTogbnVsbCwKICAgICAgICAgICAgcmVhZENvdW50OiAwLAogICAgICAgICAgICBtYXA6IHt9CiAgICAgICAgfSk7CiAgICB9LCBpLnByb3RvdHlwZS5wdXNoQXJyYXlTdGF0ZSA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAoZSA+IHRoaXMubWF4QXJyYXlMZW5ndGgpIHRocm93IG5ldyB4KCJNYXggbGVuZ3RoIGV4Y2VlZGVkOiBhcnJheSBsZW5ndGggKCIuY29uY2F0KGUsICIpID4gbWF4QXJyYXlMZW5ndGggKCIpLmNvbmNhdCh0aGlzLm1heEFycmF5TGVuZ3RoLCAiKSIpKTsKICAgICAgICB0aGlzLnN0YWNrLnB1c2goewogICAgICAgICAgICB0eXBlOiAwLAogICAgICAgICAgICBzaXplOiBlLAogICAgICAgICAgICBhcnJheTogbmV3IEFycmF5KGUpLAogICAgICAgICAgICBwb3NpdGlvbjogMAogICAgICAgIH0pOwogICAgfSwgaS5wcm90b3R5cGUuZGVjb2RlVXRmOFN0cmluZyA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICB2YXIgcjsKICAgICAgICBpZiAoZSA+IHRoaXMubWF4U3RyTGVuZ3RoKSB0aHJvdyBuZXcgeCgiTWF4IGxlbmd0aCBleGNlZWRlZDogVVRGLTggYnl0ZSBsZW5ndGggKCIuY29uY2F0KGUsICIpID4gbWF4U3RyTGVuZ3RoICgiKS5jb25jYXQodGhpcy5tYXhTdHJMZW5ndGgsICIpIikpOwogICAgICAgIGlmICh0aGlzLmJ5dGVzLmJ5dGVMZW5ndGggPCB0aGlzLnBvcyArIHQgKyBlKSB0aHJvdyBuZTsKICAgICAgICB2YXIgcyA9IHRoaXMucG9zICsgdCwgbjsKICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZUlzTWFwS2V5KCkgJiYgKChyID0gdGhpcy5rZXlEZWNvZGVyKSA9PT0gbnVsbCB8fCByID09PSB2b2lkIDAgPyB2b2lkIDAgOiByLmNhbkJlQ2FjaGVkKGUpKSA/IG4gPSB0aGlzLmtleURlY29kZXIuZGVjb2RlKHRoaXMuYnl0ZXMsIHMsIGUpIDogZSA+IEsxID8gbiA9IFkxKHRoaXMuYnl0ZXMsIHMsIGUpIDogbiA9IEModGhpcy5ieXRlcywgcywgZSksIHRoaXMucG9zICs9IHQgKyBlLCBuOwogICAgfSwgaS5wcm90b3R5cGUuc3RhdGVJc01hcEtleSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHJldHVybiBlLnR5cGUgPT09IDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiAhMTsKICAgIH0sIGkucHJvdG90eXBlLmRlY29kZUJpbmFyeSA9IGZ1bmN0aW9uKGUsIHQpIHsKICAgICAgICBpZiAoZSA+IHRoaXMubWF4QmluTGVuZ3RoKSB0aHJvdyBuZXcgeCgiTWF4IGxlbmd0aCBleGNlZWRlZDogYmluIGxlbmd0aCAoIi5jb25jYXQoZSwgIikgPiBtYXhCaW5MZW5ndGggKCIpLmNvbmNhdCh0aGlzLm1heEJpbkxlbmd0aCwgIikiKSk7CiAgICAgICAgaWYgKCF0aGlzLmhhc1JlbWFpbmluZyhlICsgdCkpIHRocm93IG5lOwogICAgICAgIHZhciByID0gdGhpcy5wb3MgKyB0LCBzID0gdGhpcy5ieXRlcy5zdWJhcnJheShyLCByICsgZSk7CiAgICAgICAgcmV0dXJuIHRoaXMucG9zICs9IHQgKyBlLCBzOwogICAgfSwgaS5wcm90b3R5cGUuZGVjb2RlRXh0ZW5zaW9uID0gZnVuY3Rpb24oZSwgdCkgewogICAgICAgIGlmIChlID4gdGhpcy5tYXhFeHRMZW5ndGgpIHRocm93IG5ldyB4KCJNYXggbGVuZ3RoIGV4Y2VlZGVkOiBleHQgbGVuZ3RoICgiLmNvbmNhdChlLCAiKSA+IG1heEV4dExlbmd0aCAoIikuY29uY2F0KHRoaXMubWF4RXh0TGVuZ3RoLCAiKSIpKTsKICAgICAgICB2YXIgciA9IHRoaXMudmlldy5nZXRJbnQ4KHRoaXMucG9zICsgdCksIHMgPSB0aGlzLmRlY29kZUJpbmFyeShlLCB0ICsgMSk7CiAgICAgICAgcmV0dXJuIHRoaXMuZXh0ZW5zaW9uQ29kZWMuZGVjb2RlKHMsIHIsIHRoaXMuY29udGV4dCk7CiAgICB9LCBpLnByb3RvdHlwZS5sb29rVTggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy52aWV3LmdldFVpbnQ4KHRoaXMucG9zKTsKICAgIH0sIGkucHJvdG90eXBlLmxvb2tVMTYgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy52aWV3LmdldFVpbnQxNih0aGlzLnBvcyk7CiAgICB9LCBpLnByb3RvdHlwZS5sb29rVTMyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmlldy5nZXRVaW50MzIodGhpcy5wb3MpOwogICAgfSwgaS5wcm90b3R5cGUucmVhZFU4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLnZpZXcuZ2V0VWludDgodGhpcy5wb3MpOwogICAgICAgIHJldHVybiB0aGlzLnBvcysrLCBlOwogICAgfSwgaS5wcm90b3R5cGUucmVhZEk4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLnZpZXcuZ2V0SW50OCh0aGlzLnBvcyk7CiAgICAgICAgcmV0dXJuIHRoaXMucG9zKyssIGU7CiAgICB9LCBpLnByb3RvdHlwZS5yZWFkVTE2ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLnZpZXcuZ2V0VWludDE2KHRoaXMucG9zKTsKICAgICAgICByZXR1cm4gdGhpcy5wb3MgKz0gMiwgZTsKICAgIH0sIGkucHJvdG90eXBlLnJlYWRJMTYgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZSA9IHRoaXMudmlldy5nZXRJbnQxNih0aGlzLnBvcyk7CiAgICAgICAgcmV0dXJuIHRoaXMucG9zICs9IDIsIGU7CiAgICB9LCBpLnByb3RvdHlwZS5yZWFkVTMyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLnZpZXcuZ2V0VWludDMyKHRoaXMucG9zKTsKICAgICAgICByZXR1cm4gdGhpcy5wb3MgKz0gNCwgZTsKICAgIH0sIGkucHJvdG90eXBlLnJlYWRJMzIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZSA9IHRoaXMudmlldy5nZXRJbnQzMih0aGlzLnBvcyk7CiAgICAgICAgcmV0dXJuIHRoaXMucG9zICs9IDQsIGU7CiAgICB9LCBpLnByb3RvdHlwZS5yZWFkVTY0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGUgPSBiKHRoaXMudmlldywgdGhpcy5wb3MpOwogICAgICAgIHJldHVybiB0aGlzLnBvcyArPSA4LCBlOwogICAgfSwgaS5wcm90b3R5cGUucmVhZEk2NCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBlID0gRDEodGhpcy52aWV3LCB0aGlzLnBvcyk7CiAgICAgICAgcmV0dXJuIHRoaXMucG9zICs9IDgsIGU7CiAgICB9LCBpLnByb3RvdHlwZS5yZWFkRjMyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLnZpZXcuZ2V0RmxvYXQzMih0aGlzLnBvcyk7CiAgICAgICAgcmV0dXJuIHRoaXMucG9zICs9IDQsIGU7CiAgICB9LCBpLnByb3RvdHlwZS5yZWFkRjY0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLnZpZXcuZ2V0RmxvYXQ2NCh0aGlzLnBvcyk7CiAgICAgICAgcmV0dXJuIHRoaXMucG9zICs9IDgsIGU7CiAgICB9LCBpOwp9KCk7CnZhciB5MSA9IHt9OwpmdW5jdGlvbiBUZShpLCBlKSB7CiAgICBlID09PSB2b2lkIDAgJiYgKGUgPSB5MSk7CiAgICB2YXIgdCA9IG5ldyB3KGUuZXh0ZW5zaW9uQ29kZWMsIGUuY29udGV4dCwgZS5tYXhTdHJMZW5ndGgsIGUubWF4QmluTGVuZ3RoLCBlLm1heEFycmF5TGVuZ3RoLCBlLm1heE1hcExlbmd0aCwgZS5tYXhFeHRMZW5ndGgpOwogICAgcmV0dXJuIHQuZGVjb2RlKGkpOwp9CnZhciBTID0gZnVuY3Rpb24oaSkgewogICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBTID8gKHRoaXMudiA9IGksIHRoaXMpIDogbmV3IFMoaSk7Cn07CnZhciBNaSA9IDQsIHh0ID0gMCwga3QgPSAxLCBGaSA9IDI7CmZ1bmN0aW9uIF9lKGUpIHsKICAgIGxldCBpID0gZS5sZW5ndGg7CiAgICBmb3IoOyAtLWkgPj0gMDspZVtpXSA9IDA7Cn0KdmFyIEhpID0gMCwgbGkgPSAxLCBCaSA9IDIsIEtpID0gMywgUGkgPSAyNTgsIGR0ID0gMjksIEFlID0gMjU2LCBnZTEgPSBBZSArIDEgKyBkdCwgb2UxID0gMzAsIHN0ID0gMTksIHJpID0gMiAqIGdlMSArIDEsIFEyID0gMTUsIEdlID0gMTYsIFhpID0gNywgY3QgPSAyNTYsIGZpID0gMTYsIG9pID0gMTcsIF9pID0gMTgsIGZ0ID0gbmV3IFVpbnQ4QXJyYXkoWwogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAxLAogICAgMSwKICAgIDEsCiAgICAxLAogICAgMiwKICAgIDIsCiAgICAyLAogICAgMiwKICAgIDMsCiAgICAzLAogICAgMywKICAgIDMsCiAgICA0LAogICAgNCwKICAgIDQsCiAgICA0LAogICAgNSwKICAgIDUsCiAgICA1LAogICAgNSwKICAgIDAKXSksIENlID0gbmV3IFVpbnQ4QXJyYXkoWwogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDEsCiAgICAxLAogICAgMiwKICAgIDIsCiAgICAzLAogICAgMywKICAgIDQsCiAgICA0LAogICAgNSwKICAgIDUsCiAgICA2LAogICAgNiwKICAgIDcsCiAgICA3LAogICAgOCwKICAgIDgsCiAgICA5LAogICAgOSwKICAgIDEwLAogICAgMTAsCiAgICAxMSwKICAgIDExLAogICAgMTIsCiAgICAxMiwKICAgIDEzLAogICAgMTMKXSksIFlpID0gbmV3IFVpbnQ4QXJyYXkoWwogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDIsCiAgICAzLAogICAgNwpdKSwgaGkgPSBuZXcgVWludDhBcnJheShbCiAgICAxNiwKICAgIDE3LAogICAgMTgsCiAgICAwLAogICAgOCwKICAgIDcsCiAgICA5LAogICAgNiwKICAgIDEwLAogICAgNSwKICAgIDExLAogICAgNCwKICAgIDEyLAogICAgMywKICAgIDEzLAogICAgMiwKICAgIDE0LAogICAgMSwKICAgIDE1Cl0pLCBHaSA9IDUxMiwgQjEgPSBuZXcgQXJyYXkoKGdlMSArIDIpICogMik7Cl9lKEIxKTsKdmFyIHVlMSA9IG5ldyBBcnJheShvZTEgKiAyKTsKX2UodWUxKTsKdmFyIHBlMSA9IG5ldyBBcnJheShHaSk7Cl9lKHBlMSk7CnZhciB4ZTEgPSBuZXcgQXJyYXkoUGkgLSBLaSArIDEpOwpfZSh4ZTEpOwp2YXIgdXQgPSBuZXcgQXJyYXkoZHQpOwpfZSh1dCk7CnZhciBIZSA9IG5ldyBBcnJheShvZTEpOwpfZShIZSk7CmZ1bmN0aW9uIGplKGUsIGksIHQsIG4sIGEpIHsKICAgIHRoaXMuc3RhdGljX3RyZWUgPSBlLCB0aGlzLmV4dHJhX2JpdHMgPSBpLCB0aGlzLmV4dHJhX2Jhc2UgPSB0LCB0aGlzLmVsZW1zID0gbiwgdGhpcy5tYXhfbGVuZ3RoID0gYSwgdGhpcy5oYXNfc3RyZWUgPSBlICYmIGUubGVuZ3RoOwp9CnZhciBkaSwgc2ksIGNpOwpmdW5jdGlvbiBXZShlLCBpKSB7CiAgICB0aGlzLmR5bl90cmVlID0gZSwgdGhpcy5tYXhfY29kZSA9IDAsIHRoaXMuc3RhdF9kZXNjID0gaTsKfQp2YXIgdWkgPSAoZSk9PmUgPCAyNTYgPyBwZTFbZV0gOiBwZTFbMjU2ICsgKGUgPj4+IDcpXSwga2UgPSAoZSwgaSk9PnsKICAgIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaSAmIDI1NSwgZS5wZW5kaW5nX2J1ZltlLnBlbmRpbmcrK10gPSBpID4+PiA4ICYgMjU1Owp9LCBOMiA9IChlLCBpLCB0KT0+ewogICAgZS5iaV92YWxpZCA+IEdlIC0gdCA/IChlLmJpX2J1ZiB8PSBpIDw8IGUuYmlfdmFsaWQgJiA2NTUzNSwga2UoZSwgZS5iaV9idWYpLCBlLmJpX2J1ZiA9IGkgPj4gR2UgLSBlLmJpX3ZhbGlkLCBlLmJpX3ZhbGlkICs9IHQgLSBHZSkgOiAoZS5iaV9idWYgfD0gaSA8PCBlLmJpX3ZhbGlkICYgNjU1MzUsIGUuYmlfdmFsaWQgKz0gdCk7Cn0sIE0yID0gKGUsIGksIHQpPT57CiAgICBOMihlLCB0W2kgKiAyXSwgdFtpICogMiArIDFdKTsKfSwgYmkgPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gMDsKICAgIGRvIHQgfD0gZSAmIDEsIGUgPj4+PSAxLCB0IDw8PSAxOwogICAgd2hpbGUgKC0taSA+IDApCiAgICByZXR1cm4gdCA+Pj4gMTsKfSwgamkgPSAoZSk9PnsKICAgIGUuYmlfdmFsaWQgPT09IDE2ID8gKGtlKGUsIGUuYmlfYnVmKSwgZS5iaV9idWYgPSAwLCBlLmJpX3ZhbGlkID0gMCkgOiBlLmJpX3ZhbGlkID49IDggJiYgKGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gZS5iaV9idWYgJiAyNTUsIGUuYmlfYnVmID4+PSA4LCBlLmJpX3ZhbGlkIC09IDgpOwp9LCBXaSA9IChlLCBpKT0+ewogICAgbGV0IHQgPSBpLmR5bl90cmVlLCBuID0gaS5tYXhfY29kZSwgYSA9IGkuc3RhdF9kZXNjLnN0YXRpY190cmVlLCBsID0gaS5zdGF0X2Rlc2MuaGFzX3N0cmVlLCBvID0gaS5zdGF0X2Rlc2MuZXh0cmFfYml0cywgZiA9IGkuc3RhdF9kZXNjLmV4dHJhX2Jhc2UsIGMgPSBpLnN0YXRfZGVzYy5tYXhfbGVuZ3RoLCByLCBfLCBFLCBzLCBoLCB1LCBtID0gMDsKICAgIGZvcihzID0gMDsgcyA8PSBRMjsgcysrKWUuYmxfY291bnRbc10gPSAwOwogICAgZm9yKHRbZS5oZWFwW2UuaGVhcF9tYXhdICogMiArIDFdID0gMCwgciA9IGUuaGVhcF9tYXggKyAxOyByIDwgcmk7IHIrKylfID0gZS5oZWFwW3JdLCBzID0gdFt0W18gKiAyICsgMV0gKiAyICsgMV0gKyAxLCBzID4gYyAmJiAocyA9IGMsIG0rKyksIHRbXyAqIDIgKyAxXSA9IHMsICEoXyA+IG4pICYmIChlLmJsX2NvdW50W3NdKyssIGggPSAwLCBfID49IGYgJiYgKGggPSBvW18gLSBmXSksIHUgPSB0W18gKiAyXSwgZS5vcHRfbGVuICs9IHUgKiAocyArIGgpLCBsICYmIChlLnN0YXRpY19sZW4gKz0gdSAqIChhW18gKiAyICsgMV0gKyBoKSkpOwogICAgaWYgKG0gIT09IDApIHsKICAgICAgICBkbyB7CiAgICAgICAgICAgIGZvcihzID0gYyAtIDE7IGUuYmxfY291bnRbc10gPT09IDA7KXMtLTsKICAgICAgICAgICAgZS5ibF9jb3VudFtzXS0tLCBlLmJsX2NvdW50W3MgKyAxXSArPSAyLCBlLmJsX2NvdW50W2NdLS0sIG0gLT0gMjsKICAgICAgICB9d2hpbGUgKG0gPiAwKQogICAgICAgIGZvcihzID0gYzsgcyAhPT0gMDsgcy0tKWZvcihfID0gZS5ibF9jb3VudFtzXTsgXyAhPT0gMDspRSA9IGUuaGVhcFstLXJdLCAhKEUgPiBuKSAmJiAodFtFICogMiArIDFdICE9PSBzICYmIChlLm9wdF9sZW4gKz0gKHMgLSB0W0UgKiAyICsgMV0pICogdFtFICogMl0sIHRbRSAqIDIgKyAxXSA9IHMpLCBfLS0pOwogICAgfQp9LCB3aSA9IChlLCBpLCB0KT0+ewogICAgbGV0IG4gPSBuZXcgQXJyYXkoUTIgKyAxKSwgYSA9IDAsIGwsIG87CiAgICBmb3IobCA9IDE7IGwgPD0gUTI7IGwrKyluW2xdID0gYSA9IGEgKyB0W2wgLSAxXSA8PCAxOwogICAgZm9yKG8gPSAwOyBvIDw9IGk7IG8rKyl7CiAgICAgICAgbGV0IGYgPSBlW28gKiAyICsgMV07CiAgICAgICAgZiAhPT0gMCAmJiAoZVtvICogMl0gPSBiaShuW2ZdKyssIGYpKTsKICAgIH0KfSwgVmkgPSAoKT0+ewogICAgbGV0IGUsIGksIHQsIG4sIGEsIGwgPSBuZXcgQXJyYXkoUTIgKyAxKTsKICAgIGZvcih0ID0gMCwgbiA9IDA7IG4gPCBkdCAtIDE7IG4rKylmb3IodXRbbl0gPSB0LCBlID0gMDsgZSA8IDEgPDwgZnRbbl07IGUrKyl4ZTFbdCsrXSA9IG47CiAgICBmb3IoeGUxW3QgLSAxXSA9IG4sIGEgPSAwLCBuID0gMDsgbiA8IDE2OyBuKyspZm9yKEhlW25dID0gYSwgZSA9IDA7IGUgPCAxIDw8IENlW25dOyBlKyspcGUxW2ErK10gPSBuOwogICAgZm9yKGEgPj49IDc7IG4gPCBvZTE7IG4rKylmb3IoSGVbbl0gPSBhIDw8IDcsIGUgPSAwOyBlIDwgMSA8PCBDZVtuXSAtIDc7IGUrKylwZTFbMjU2ICsgYSsrXSA9IG47CiAgICBmb3IoaSA9IDA7IGkgPD0gUTI7IGkrKylsW2ldID0gMDsKICAgIGZvcihlID0gMDsgZSA8PSAxNDM7KUIxW2UgKiAyICsgMV0gPSA4LCBlKyssIGxbOF0rKzsKICAgIGZvcig7IGUgPD0gMjU1OylCMVtlICogMiArIDFdID0gOSwgZSsrLCBsWzldKys7CiAgICBmb3IoOyBlIDw9IDI3OTspQjFbZSAqIDIgKyAxXSA9IDcsIGUrKywgbFs3XSsrOwogICAgZm9yKDsgZSA8PSAyODc7KUIxW2UgKiAyICsgMV0gPSA4LCBlKyssIGxbOF0rKzsKICAgIGZvcih3aShCMSwgZ2UxICsgMSwgbCksIGUgPSAwOyBlIDwgb2UxOyBlKyspdWUxW2UgKiAyICsgMV0gPSA1LCB1ZTFbZSAqIDJdID0gYmkoZSwgNSk7CiAgICBkaSA9IG5ldyBqZShCMSwgZnQsIEFlICsgMSwgZ2UxLCBRMiksIHNpID0gbmV3IGplKHVlMSwgQ2UsIDAsIG9lMSwgUTIpLCBjaSA9IG5ldyBqZShuZXcgQXJyYXkoMCksIFlpLCAwLCBzdCwgWGkpOwp9LCBnaSA9IChlKT0+ewogICAgbGV0IGk7CiAgICBmb3IoaSA9IDA7IGkgPCBnZTE7IGkrKyllLmR5bl9sdHJlZVtpICogMl0gPSAwOwogICAgZm9yKGkgPSAwOyBpIDwgb2UxOyBpKyspZS5keW5fZHRyZWVbaSAqIDJdID0gMDsKICAgIGZvcihpID0gMDsgaSA8IHN0OyBpKyspZS5ibF90cmVlW2kgKiAyXSA9IDA7CiAgICBlLmR5bl9sdHJlZVtjdCAqIDJdID0gMSwgZS5vcHRfbGVuID0gZS5zdGF0aWNfbGVuID0gMCwgZS5sYXN0X2xpdCA9IGUubWF0Y2hlcyA9IDA7Cn0sIHBpID0gKGUpPT57CiAgICBlLmJpX3ZhbGlkID4gOCA/IGtlKGUsIGUuYmlfYnVmKSA6IGUuYmlfdmFsaWQgPiAwICYmIChlLnBlbmRpbmdfYnVmW2UucGVuZGluZysrXSA9IGUuYmlfYnVmKSwgZS5iaV9idWYgPSAwLCBlLmJpX3ZhbGlkID0gMDsKfSwgSmkgPSAoZSwgaSwgdCwgbik9PnsKICAgIHBpKGUpLCBuICYmIChrZShlLCB0KSwga2UoZSwgfnQpKSwgZS5wZW5kaW5nX2J1Zi5zZXQoZS53aW5kb3cuc3ViYXJyYXkoaSwgaSArIHQpLCBlLnBlbmRpbmcpLCBlLnBlbmRpbmcgKz0gdDsKfSwgdnQgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhID0gaSAqIDIsIGwgPSB0ICogMjsKICAgIHJldHVybiBlW2FdIDwgZVtsXSB8fCBlW2FdID09PSBlW2xdICYmIG5baV0gPD0gblt0XTsKfSwgVmUgPSAoZSwgaSwgdCk9PnsKICAgIGxldCBuID0gZS5oZWFwW3RdLCBhID0gdCA8PCAxOwogICAgZm9yKDsgYSA8PSBlLmhlYXBfbGVuICYmIChhIDwgZS5oZWFwX2xlbiAmJiB2dChpLCBlLmhlYXBbYSArIDFdLCBlLmhlYXBbYV0sIGUuZGVwdGgpICYmIGErKywgIXZ0KGksIG4sIGUuaGVhcFthXSwgZS5kZXB0aCkpOyllLmhlYXBbdF0gPSBlLmhlYXBbYV0sIHQgPSBhLCBhIDw8PSAxOwogICAgZS5oZWFwW3RdID0gbjsKfSwgRXQgPSAoZSwgaSwgdCk9PnsKICAgIGxldCBuLCBhLCBsID0gMCwgbywgZjsKICAgIGlmIChlLmxhc3RfbGl0ICE9PSAwKSBkbyBuID0gZS5wZW5kaW5nX2J1ZltlLmRfYnVmICsgbCAqIDJdIDw8IDggfCBlLnBlbmRpbmdfYnVmW2UuZF9idWYgKyBsICogMiArIDFdLCBhID0gZS5wZW5kaW5nX2J1ZltlLmxfYnVmICsgbF0sIGwrKywgbiA9PT0gMCA/IE0yKGUsIGEsIGkpIDogKG8gPSB4ZTFbYV0sIE0yKGUsIG8gKyBBZSArIDEsIGkpLCBmID0gZnRbb10sIGYgIT09IDAgJiYgKGEgLT0gdXRbb10sIE4yKGUsIGEsIGYpKSwgbi0tLCBvID0gdWkobiksIE0yKGUsIG8sIHQpLCBmID0gQ2Vbb10sIGYgIT09IDAgJiYgKG4gLT0gSGVbb10sIE4yKGUsIG4sIGYpKSk7CiAgICB3aGlsZSAobCA8IGUubGFzdF9saXQpCiAgICBNMihlLCBjdCwgaSk7Cn0sIG90ID0gKGUsIGkpPT57CiAgICBsZXQgdCA9IGkuZHluX3RyZWUsIG4gPSBpLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSwgYSA9IGkuc3RhdF9kZXNjLmhhc19zdHJlZSwgbCA9IGkuc3RhdF9kZXNjLmVsZW1zLCBvLCBmLCBjID0gLTEsIHI7CiAgICBmb3IoZS5oZWFwX2xlbiA9IDAsIGUuaGVhcF9tYXggPSByaSwgbyA9IDA7IG8gPCBsOyBvKyspdFtvICogMl0gIT09IDAgPyAoZS5oZWFwWysrZS5oZWFwX2xlbl0gPSBjID0gbywgZS5kZXB0aFtvXSA9IDApIDogdFtvICogMiArIDFdID0gMDsKICAgIGZvcig7IGUuaGVhcF9sZW4gPCAyOylyID0gZS5oZWFwWysrZS5oZWFwX2xlbl0gPSBjIDwgMiA/ICsrYyA6IDAsIHRbciAqIDJdID0gMSwgZS5kZXB0aFtyXSA9IDAsIGUub3B0X2xlbi0tLCBhICYmIChlLnN0YXRpY19sZW4gLT0gbltyICogMiArIDFdKTsKICAgIGZvcihpLm1heF9jb2RlID0gYywgbyA9IGUuaGVhcF9sZW4gPj4gMTsgbyA+PSAxOyBvLS0pVmUoZSwgdCwgbyk7CiAgICByID0gbDsKICAgIGRvIG8gPSBlLmhlYXBbMV0sIGUuaGVhcFsxXSA9IGUuaGVhcFtlLmhlYXBfbGVuLS1dLCBWZShlLCB0LCAxKSwgZiA9IGUuaGVhcFsxXSwgZS5oZWFwWy0tZS5oZWFwX21heF0gPSBvLCBlLmhlYXBbLS1lLmhlYXBfbWF4XSA9IGYsIHRbciAqIDJdID0gdFtvICogMl0gKyB0W2YgKiAyXSwgZS5kZXB0aFtyXSA9IChlLmRlcHRoW29dID49IGUuZGVwdGhbZl0gPyBlLmRlcHRoW29dIDogZS5kZXB0aFtmXSkgKyAxLCB0W28gKiAyICsgMV0gPSB0W2YgKiAyICsgMV0gPSByLCBlLmhlYXBbMV0gPSByKyssIFZlKGUsIHQsIDEpOwogICAgd2hpbGUgKGUuaGVhcF9sZW4gPj0gMikKICAgIGUuaGVhcFstLWUuaGVhcF9tYXhdID0gZS5oZWFwWzFdLCBXaShlLCBpKSwgd2kodCwgYywgZS5ibF9jb3VudCk7Cn0sIHl0ID0gKGUsIGksIHQpPT57CiAgICBsZXQgbiwgYSA9IC0xLCBsLCBvID0gaVswICogMiArIDFdLCBmID0gMCwgYyA9IDcsIHIgPSA0OwogICAgZm9yKG8gPT09IDAgJiYgKGMgPSAxMzgsIHIgPSAzKSwgaVsodCArIDEpICogMiArIDFdID0gNjU1MzUsIG4gPSAwOyBuIDw9IHQ7IG4rKylsID0gbywgbyA9IGlbKG4gKyAxKSAqIDIgKyAxXSwgISgrK2YgPCBjICYmIGwgPT09IG8pICYmIChmIDwgciA/IGUuYmxfdHJlZVtsICogMl0gKz0gZiA6IGwgIT09IDAgPyAobCAhPT0gYSAmJiBlLmJsX3RyZWVbbCAqIDJdKyssIGUuYmxfdHJlZVtmaSAqIDJdKyspIDogZiA8PSAxMCA/IGUuYmxfdHJlZVtvaSAqIDJdKysgOiBlLmJsX3RyZWVbX2kgKiAyXSsrLCBmID0gMCwgYSA9IGwsIG8gPT09IDAgPyAoYyA9IDEzOCwgciA9IDMpIDogbCA9PT0gbyA/IChjID0gNiwgciA9IDMpIDogKGMgPSA3LCByID0gNCkpOwp9LCBTdCA9IChlLCBpLCB0KT0+ewogICAgbGV0IG4sIGEgPSAtMSwgbCwgbyA9IGlbMCAqIDIgKyAxXSwgZiA9IDAsIGMgPSA3LCByID0gNDsKICAgIGZvcihvID09PSAwICYmIChjID0gMTM4LCByID0gMyksIG4gPSAwOyBuIDw9IHQ7IG4rKylpZiAobCA9IG8sIG8gPSBpWyhuICsgMSkgKiAyICsgMV0sICEoKytmIDwgYyAmJiBsID09PSBvKSkgewogICAgICAgIGlmIChmIDwgcikgZG8gTTIoZSwgbCwgZS5ibF90cmVlKTsKICAgICAgICB3aGlsZSAoLS1mICE9PSAwKQogICAgICAgIGVsc2UgbCAhPT0gMCA/IChsICE9PSBhICYmIChNMihlLCBsLCBlLmJsX3RyZWUpLCBmLS0pLCBNMihlLCBmaSwgZS5ibF90cmVlKSwgTjIoZSwgZiAtIDMsIDIpKSA6IGYgPD0gMTAgPyAoTTIoZSwgb2ksIGUuYmxfdHJlZSksIE4yKGUsIGYgLSAzLCAzKSkgOiAoTTIoZSwgX2ksIGUuYmxfdHJlZSksIE4yKGUsIGYgLSAxMSwgNykpOwogICAgICAgIGYgPSAwLCBhID0gbCwgbyA9PT0gMCA/IChjID0gMTM4LCByID0gMykgOiBsID09PSBvID8gKGMgPSA2LCByID0gMykgOiAoYyA9IDcsIHIgPSA0KTsKICAgIH0KfSwgUWkgPSAoZSk9PnsKICAgIGxldCBpOwogICAgZm9yKHl0KGUsIGUuZHluX2x0cmVlLCBlLmxfZGVzYy5tYXhfY29kZSksIHl0KGUsIGUuZHluX2R0cmVlLCBlLmRfZGVzYy5tYXhfY29kZSksIG90KGUsIGUuYmxfZGVzYyksIGkgPSBzdCAtIDE7IGkgPj0gMyAmJiBlLmJsX3RyZWVbaGlbaV0gKiAyICsgMV0gPT09IDA7IGktLSk7CiAgICByZXR1cm4gZS5vcHRfbGVuICs9IDMgKiAoaSArIDEpICsgNSArIDUgKyA0LCBpOwp9LCBxaSA9IChlLCBpLCB0LCBuKT0+ewogICAgbGV0IGE7CiAgICBmb3IoTjIoZSwgaSAtIDI1NywgNSksIE4yKGUsIHQgLSAxLCA1KSwgTjIoZSwgbiAtIDQsIDQpLCBhID0gMDsgYSA8IG47IGErKylOMihlLCBlLmJsX3RyZWVbaGlbYV0gKiAyICsgMV0sIDMpOwogICAgU3QoZSwgZS5keW5fbHRyZWUsIGkgLSAxKSwgU3QoZSwgZS5keW5fZHRyZWUsIHQgLSAxKTsKfSwgZWEgPSAoZSk9PnsKICAgIGxldCBpID0gNDA5MzYyNDQ0NywgdDsKICAgIGZvcih0ID0gMDsgdCA8PSAzMTsgdCsrLCBpID4+Pj0gMSlpZiAoaSAmIDEgJiYgZS5keW5fbHRyZWVbdCAqIDJdICE9PSAwKSByZXR1cm4geHQ7CiAgICBpZiAoZS5keW5fbHRyZWVbOSAqIDJdICE9PSAwIHx8IGUuZHluX2x0cmVlWzEwICogMl0gIT09IDAgfHwgZS5keW5fbHRyZWVbMTMgKiAyXSAhPT0gMCkgcmV0dXJuIGt0OwogICAgZm9yKHQgPSAzMjsgdCA8IEFlOyB0KyspaWYgKGUuZHluX2x0cmVlW3QgKiAyXSAhPT0gMCkgcmV0dXJuIGt0OwogICAgcmV0dXJuIHh0Owp9LCBBdCA9ICExLCB0YSA9IChlKT0+ewogICAgQXQgfHwgKFZpKCksIEF0ID0gITApLCBlLmxfZGVzYyA9IG5ldyBXZShlLmR5bl9sdHJlZSwgZGkpLCBlLmRfZGVzYyA9IG5ldyBXZShlLmR5bl9kdHJlZSwgc2kpLCBlLmJsX2Rlc2MgPSBuZXcgV2UoZS5ibF90cmVlLCBjaSksIGUuYmlfYnVmID0gMCwgZS5iaV92YWxpZCA9IDAsIGdpKGUpOwp9LCB4aSA9IChlLCBpLCB0LCBuKT0+ewogICAgTjIoZSwgKEhpIDw8IDEpICsgKG4gPyAxIDogMCksIDMpLCBKaShlLCBpLCB0LCAhMCk7Cn0sIGlhID0gKGUpPT57CiAgICBOMihlLCBsaSA8PCAxLCAzKSwgTTIoZSwgY3QsIEIxKSwgamkoZSk7Cn0sIGFhID0gKGUsIGksIHQsIG4pPT57CiAgICBsZXQgYSwgbCwgbyA9IDA7CiAgICBlLmxldmVsID4gMCA/IChlLnN0cm0uZGF0YV90eXBlID09PSBGaSAmJiAoZS5zdHJtLmRhdGFfdHlwZSA9IGVhKGUpKSwgb3QoZSwgZS5sX2Rlc2MpLCBvdChlLCBlLmRfZGVzYyksIG8gPSBRaShlKSwgYSA9IGUub3B0X2xlbiArIDMgKyA3ID4+PiAzLCBsID0gZS5zdGF0aWNfbGVuICsgMyArIDcgPj4+IDMsIGwgPD0gYSAmJiAoYSA9IGwpKSA6IGEgPSBsID0gdCArIDUsIHQgKyA0IDw9IGEgJiYgaSAhPT0gLTEgPyB4aShlLCBpLCB0LCBuKSA6IGUuc3RyYXRlZ3kgPT09IE1pIHx8IGwgPT09IGEgPyAoTjIoZSwgKGxpIDw8IDEpICsgKG4gPyAxIDogMCksIDMpLCBFdChlLCBCMSwgdWUxKSkgOiAoTjIoZSwgKEJpIDw8IDEpICsgKG4gPyAxIDogMCksIDMpLCBxaShlLCBlLmxfZGVzYy5tYXhfY29kZSArIDEsIGUuZF9kZXNjLm1heF9jb2RlICsgMSwgbyArIDEpLCBFdChlLCBlLmR5bl9sdHJlZSwgZS5keW5fZHRyZWUpKSwgZ2koZSksIG4gJiYgcGkoZSk7Cn0sIG5hID0gKGUsIGksIHQpPT4oZS5wZW5kaW5nX2J1ZltlLmRfYnVmICsgZS5sYXN0X2xpdCAqIDJdID0gaSA+Pj4gOCAmIDI1NSwgZS5wZW5kaW5nX2J1ZltlLmRfYnVmICsgZS5sYXN0X2xpdCAqIDIgKyAxXSA9IGkgJiAyNTUsIGUucGVuZGluZ19idWZbZS5sX2J1ZiArIGUubGFzdF9saXRdID0gdCAmIDI1NSwgZS5sYXN0X2xpdCsrLCBpID09PSAwID8gZS5keW5fbHRyZWVbdCAqIDJdKysgOiAoZS5tYXRjaGVzKyssIGktLSwgZS5keW5fbHRyZWVbKHhlMVt0XSArIEFlICsgMSkgKiAyXSsrLCBlLmR5bl9kdHJlZVt1aShpKSAqIDJdKyspLCBlLmxhc3RfbGl0ID09PSBlLmxpdF9idWZzaXplIC0gMSksIGxhID0gdGEsIHJhID0geGksIGZhID0gYWEsIG9hID0gbmEsIF9hID0gaWEsIGhhID0gewogICAgX3RyX2luaXQ6IGxhLAogICAgX3RyX3N0b3JlZF9ibG9jazogcmEsCiAgICBfdHJfZmx1c2hfYmxvY2s6IGZhLAogICAgX3RyX3RhbGx5OiBvYSwKICAgIF90cl9hbGlnbjogX2EKfSwgZGEgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhID0gZSAmIDY1NTM1IHwgMCwgbCA9IGUgPj4+IDE2ICYgNjU1MzUgfCAwLCBvID0gMDsKICAgIGZvcig7IHQgIT09IDA7KXsKICAgICAgICBvID0gdCA+IDJlMyA/IDJlMyA6IHQsIHQgLT0gbzsKICAgICAgICBkbyBhID0gYSArIGlbbisrXSB8IDAsIGwgPSBsICsgYSB8IDA7CiAgICAgICAgd2hpbGUgKC0tbykKICAgICAgICBhICU9IDY1NTIxLCBsICU9IDY1NTIxOwogICAgfQogICAgcmV0dXJuIGEgfCBsIDw8IDE2IHwgMDsKfSwgdmUxID0gZGEsIHNhID0gKCk9PnsKICAgIGxldCBlLCBpID0gW107CiAgICBmb3IodmFyIHQgPSAwOyB0IDwgMjU2OyB0KyspewogICAgICAgIGUgPSB0OwogICAgICAgIGZvcih2YXIgbiA9IDA7IG4gPCA4OyBuKyspZSA9IGUgJiAxID8gMzk4ODI5MjM4NCBeIGUgPj4+IDEgOiBlID4+PiAxOwogICAgICAgIGlbdF0gPSBlOwogICAgfQogICAgcmV0dXJuIGk7Cn0sIGNhID0gbmV3IFVpbnQzMkFycmF5KHNhKCkpLCB1YSA9IChlLCBpLCB0LCBuKT0+ewogICAgbGV0IGEgPSBjYSwgbCA9IG4gKyB0OwogICAgZSBePSAtMTsKICAgIGZvcihsZXQgbyA9IG47IG8gPCBsOyBvKyspZSA9IGUgPj4+IDggXiBhWyhlIF4gaVtvXSkgJiAyNTVdOwogICAgcmV0dXJuIGUgXiAtMTsKfSwgSTIgPSB1YSwgZWUxID0gewogICAgMjogIm5lZWQgZGljdGlvbmFyeSIsCiAgICAxOiAic3RyZWFtIGVuZCIsCiAgICAwOiAiIiwKICAgICItMSI6ICJmaWxlIGVycm9yIiwKICAgICItMiI6ICJzdHJlYW0gZXJyb3IiLAogICAgIi0zIjogImRhdGEgZXJyb3IiLAogICAgIi00IjogImluc3VmZmljaWVudCBtZW1vcnkiLAogICAgIi01IjogImJ1ZmZlciBlcnJvciIsCiAgICAiLTYiOiAiaW5jb21wYXRpYmxlIHZlcnNpb24iCn0sIG5lMSA9IHsKICAgIFpfTk9fRkxVU0g6IDAsCiAgICBaX1BBUlRJQUxfRkxVU0g6IDEsCiAgICBaX1NZTkNfRkxVU0g6IDIsCiAgICBaX0ZVTExfRkxVU0g6IDMsCiAgICBaX0ZJTklTSDogNCwKICAgIFpfQkxPQ0s6IDUsCiAgICBaX1RSRUVTOiA2LAogICAgWl9PSzogMCwKICAgIFpfU1RSRUFNX0VORDogMSwKICAgIFpfTkVFRF9ESUNUOiAyLAogICAgWl9FUlJOTzogLTEsCiAgICBaX1NUUkVBTV9FUlJPUjogLTIsCiAgICBaX0RBVEFfRVJST1I6IC0zLAogICAgWl9NRU1fRVJST1I6IC00LAogICAgWl9CVUZfRVJST1I6IC01LAogICAgWl9OT19DT01QUkVTU0lPTjogMCwKICAgIFpfQkVTVF9TUEVFRDogMSwKICAgIFpfQkVTVF9DT01QUkVTU0lPTjogOSwKICAgIFpfREVGQVVMVF9DT01QUkVTU0lPTjogLTEsCiAgICBaX0ZJTFRFUkVEOiAxLAogICAgWl9IVUZGTUFOX09OTFk6IDIsCiAgICBaX1JMRTogMywKICAgIFpfRklYRUQ6IDQsCiAgICBaX0RFRkFVTFRfU1RSQVRFR1k6IDAsCiAgICBaX0JJTkFSWTogMCwKICAgIFpfVEVYVDogMSwKICAgIFpfVU5LTk9XTjogMiwKICAgIFpfREVGTEFURUQ6IDgKfSwgeyBfdHJfaW5pdDogYmEgLCBfdHJfc3RvcmVkX2Jsb2NrOiB3YSAsIF90cl9mbHVzaF9ibG9jazogZ2EgLCBfdHJfdGFsbHk6IGoxICwgX3RyX2FsaWduOiBwYSAgfSA9IGhhLCB7IFpfTk9fRkxVU0g6IGxlMSAsIFpfUEFSVElBTF9GTFVTSDogeGEgLCBaX0ZVTExfRkxVU0g6IGthICwgWl9GSU5JU0g6IFcyICwgWl9CTE9DSzogUnQgLCBaX09LOiBGMiAsIFpfU1RSRUFNX0VORDogenQgLCBaX1NUUkVBTV9FUlJPUjogTDEgLCBaX0RBVEFfRVJST1I6IHZhICwgWl9CVUZfRVJST1I6IEplICwgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiBFYSAsIFpfRklMVEVSRUQ6IHlhICwgWl9IVUZGTUFOX09OTFk6IEllICwgWl9STEU6IFNhICwgWl9GSVhFRDogQWEgLCBaX0RFRkFVTFRfU1RSQVRFR1k6IFJhICwgWl9VTktOT1dOOiB6YSAsIFpfREVGTEFURUQ6IFBlICB9ID0gbmUxLCBUYSA9IDksIG1hID0gMTUsIERhID0gOCwgWmEgPSAyOSwgSWEgPSAyNTYsIF90ID0gSWEgKyAxICsgWmEsIE9hID0gMzAsIE5hID0gMTksIExhID0gMiAqIF90ICsgMSwgVWEgPSAxNSwgazEgPSAzLCBZMiA9IDI1OCwgQzEgPSBZMiArIGsxICsgMSwgQ2EgPSAzMiwgWGUgPSA0MiwgaHQgPSA2OSwgJGUgPSA3MywgTWUgPSA5MSwgRmUgPSAxMDMsIHExID0gMTEzLCBzZSA9IDY2NiwgRDIgPSAxLCBSZSA9IDIsIHRlMSA9IDMsIGhlMSA9IDQsICRhID0gMywgRzEgPSAoZSwgaSk9PihlLm1zZyA9IGVlMVtpXSwgaSksIFR0ID0gKGUpPT4oZSA8PCAxKSAtIChlID4gNCA/IDkgOiAwKSwgWDIgPSAoZSk9PnsKICAgIGxldCBpID0gZS5sZW5ndGg7CiAgICBmb3IoOyAtLWkgPj0gMDspZVtpXSA9IDA7Cn0sIE1hID0gKGUsIGksIHQpPT4oaSA8PCBlLmhhc2hfc2hpZnQgXiB0KSAmIGUuaGFzaF9tYXNrLCBWMiA9IE1hLCBQMiA9IChlKT0+ewogICAgbGV0IGkgPSBlLnN0YXRlLCB0ID0gaS5wZW5kaW5nOwogICAgdCA+IGUuYXZhaWxfb3V0ICYmICh0ID0gZS5hdmFpbF9vdXQpLCB0ICE9PSAwICYmIChlLm91dHB1dC5zZXQoaS5wZW5kaW5nX2J1Zi5zdWJhcnJheShpLnBlbmRpbmdfb3V0LCBpLnBlbmRpbmdfb3V0ICsgdCksIGUubmV4dF9vdXQpLCBlLm5leHRfb3V0ICs9IHQsIGkucGVuZGluZ19vdXQgKz0gdCwgZS50b3RhbF9vdXQgKz0gdCwgZS5hdmFpbF9vdXQgLT0gdCwgaS5wZW5kaW5nIC09IHQsIGkucGVuZGluZyA9PT0gMCAmJiAoaS5wZW5kaW5nX291dCA9IDApKTsKfSwgTzEgPSAoZSwgaSk9PnsKICAgIGdhKGUsIGUuYmxvY2tfc3RhcnQgPj0gMCA/IGUuYmxvY2tfc3RhcnQgOiAtMSwgZS5zdHJzdGFydCAtIGUuYmxvY2tfc3RhcnQsIGkpLCBlLmJsb2NrX3N0YXJ0ID0gZS5zdHJzdGFydCwgUDIoZS5zdHJtKTsKfSwgeTIgPSAoZSwgaSk9PnsKICAgIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaTsKfSwgZGUxID0gKGUsIGkpPT57CiAgICBlLnBlbmRpbmdfYnVmW2UucGVuZGluZysrXSA9IGkgPj4+IDggJiAyNTUsIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaSAmIDI1NTsKfSwgRmEgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhID0gZS5hdmFpbF9pbjsKICAgIHJldHVybiBhID4gbiAmJiAoYSA9IG4pLCBhID09PSAwID8gMCA6IChlLmF2YWlsX2luIC09IGEsIGkuc2V0KGUuaW5wdXQuc3ViYXJyYXkoZS5uZXh0X2luLCBlLm5leHRfaW4gKyBhKSwgdCksIGUuc3RhdGUud3JhcCA9PT0gMSA/IGUuYWRsZXIgPSB2ZTEoZS5hZGxlciwgaSwgYSwgdCkgOiBlLnN0YXRlLndyYXAgPT09IDIgJiYgKGUuYWRsZXIgPSBJMihlLmFkbGVyLCBpLCBhLCB0KSksIGUubmV4dF9pbiArPSBhLCBlLnRvdGFsX2luICs9IGEsIGEpOwp9LCBraSA9IChlLCBpKT0+ewogICAgbGV0IHQgPSBlLm1heF9jaGFpbl9sZW5ndGgsIG4gPSBlLnN0cnN0YXJ0LCBhLCBsLCBvID0gZS5wcmV2X2xlbmd0aCwgZiA9IGUubmljZV9tYXRjaCwgYyA9IGUuc3Ryc3RhcnQgPiBlLndfc2l6ZSAtIEMxID8gZS5zdHJzdGFydCAtIChlLndfc2l6ZSAtIEMxKSA6IDAsIHIgPSBlLndpbmRvdywgXyA9IGUud19tYXNrLCBFID0gZS5wcmV2LCBzID0gZS5zdHJzdGFydCArIFkyLCBoID0gcltuICsgbyAtIDFdLCB1ID0gcltuICsgb107CiAgICBlLnByZXZfbGVuZ3RoID49IGUuZ29vZF9tYXRjaCAmJiAodCA+Pj0gMiksIGYgPiBlLmxvb2thaGVhZCAmJiAoZiA9IGUubG9va2FoZWFkKTsKICAgIGRvIGlmIChhID0gaSwgIShyW2EgKyBvXSAhPT0gdSB8fCByW2EgKyBvIC0gMV0gIT09IGggfHwgclthXSAhPT0gcltuXSB8fCByWysrYV0gIT09IHJbbiArIDFdKSkgewogICAgICAgIG4gKz0gMiwgYSsrOwogICAgICAgIGRvIDsKICAgICAgICB3aGlsZSAoclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgbiA8IHMpCiAgICAgICAgaWYgKGwgPSBZMiAtIChzIC0gbiksIG4gPSBzIC0gWTIsIGwgPiBvKSB7CiAgICAgICAgICAgIGlmIChlLm1hdGNoX3N0YXJ0ID0gaSwgbyA9IGwsIGwgPj0gZikgYnJlYWs7CiAgICAgICAgICAgIGggPSByW24gKyBvIC0gMV0sIHUgPSByW24gKyBvXTsKICAgICAgICB9CiAgICB9CiAgICB3aGlsZSAoKGkgPSBFW2kgJiBfXSkgPiBjICYmIC0tdCAhPT0gMCkKICAgIHJldHVybiBvIDw9IGUubG9va2FoZWFkID8gbyA6IGUubG9va2FoZWFkOwp9LCBpZTEgPSAoZSk9PnsKICAgIGxldCBpID0gZS53X3NpemUsIHQsIG4sIGEsIGwsIG87CiAgICBkbyB7CiAgICAgICAgaWYgKGwgPSBlLndpbmRvd19zaXplIC0gZS5sb29rYWhlYWQgLSBlLnN0cnN0YXJ0LCBlLnN0cnN0YXJ0ID49IGkgKyAoaSAtIEMxKSkgewogICAgICAgICAgICBlLndpbmRvdy5zZXQoZS53aW5kb3cuc3ViYXJyYXkoaSwgaSArIGkpLCAwKSwgZS5tYXRjaF9zdGFydCAtPSBpLCBlLnN0cnN0YXJ0IC09IGksIGUuYmxvY2tfc3RhcnQgLT0gaSwgbiA9IGUuaGFzaF9zaXplLCB0ID0gbjsKICAgICAgICAgICAgZG8gYSA9IGUuaGVhZFstLXRdLCBlLmhlYWRbdF0gPSBhID49IGkgPyBhIC0gaSA6IDA7CiAgICAgICAgICAgIHdoaWxlICgtLW4pCiAgICAgICAgICAgIG4gPSBpLCB0ID0gbjsKICAgICAgICAgICAgZG8gYSA9IGUucHJldlstLXRdLCBlLnByZXZbdF0gPSBhID49IGkgPyBhIC0gaSA6IDA7CiAgICAgICAgICAgIHdoaWxlICgtLW4pCiAgICAgICAgICAgIGwgKz0gaTsKICAgICAgICB9CiAgICAgICAgaWYgKGUuc3RybS5hdmFpbF9pbiA9PT0gMCkgYnJlYWs7CiAgICAgICAgaWYgKG4gPSBGYShlLnN0cm0sIGUud2luZG93LCBlLnN0cnN0YXJ0ICsgZS5sb29rYWhlYWQsIGwpLCBlLmxvb2thaGVhZCArPSBuLCBlLmxvb2thaGVhZCArIGUuaW5zZXJ0ID49IGsxKSBmb3IobyA9IGUuc3Ryc3RhcnQgLSBlLmluc2VydCwgZS5pbnNfaCA9IGUud2luZG93W29dLCBlLmluc19oID0gVjIoZSwgZS5pbnNfaCwgZS53aW5kb3dbbyArIDFdKTsgZS5pbnNlcnQgJiYgKGUuaW5zX2ggPSBWMihlLCBlLmluc19oLCBlLndpbmRvd1tvICsgazEgLSAxXSksIGUucHJldltvICYgZS53X21hc2tdID0gZS5oZWFkW2UuaW5zX2hdLCBlLmhlYWRbZS5pbnNfaF0gPSBvLCBvKyssIGUuaW5zZXJ0LS0sICEoZS5sb29rYWhlYWQgKyBlLmluc2VydCA8IGsxKSk7KTsKICAgIH13aGlsZSAoZS5sb29rYWhlYWQgPCBDMSAmJiBlLnN0cm0uYXZhaWxfaW4gIT09IDApCn0sIEhhID0gKGUsIGkpPT57CiAgICBsZXQgdCA9IDY1NTM1OwogICAgZm9yKHQgPiBlLnBlbmRpbmdfYnVmX3NpemUgLSA1ICYmICh0ID0gZS5wZW5kaW5nX2J1Zl9zaXplIC0gNSk7Oyl7CiAgICAgICAgaWYgKGUubG9va2FoZWFkIDw9IDEpIHsKICAgICAgICAgICAgaWYgKGllMShlKSwgZS5sb29rYWhlYWQgPT09IDAgJiYgaSA9PT0gbGUxKSByZXR1cm4gRDI7CiAgICAgICAgICAgIGlmIChlLmxvb2thaGVhZCA9PT0gMCkgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGUuc3Ryc3RhcnQgKz0gZS5sb29rYWhlYWQsIGUubG9va2FoZWFkID0gMDsKICAgICAgICBsZXQgbiA9IGUuYmxvY2tfc3RhcnQgKyB0OwogICAgICAgIGlmICgoZS5zdHJzdGFydCA9PT0gMCB8fCBlLnN0cnN0YXJ0ID49IG4pICYmIChlLmxvb2thaGVhZCA9IGUuc3Ryc3RhcnQgLSBuLCBlLnN0cnN0YXJ0ID0gbiwgTzEoZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB8fCBlLnN0cnN0YXJ0IC0gZS5ibG9ja19zdGFydCA+PSBlLndfc2l6ZSAtIEMxICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gRDI7CiAgICB9CiAgICByZXR1cm4gZS5pbnNlcnQgPSAwLCBpID09PSBXMiA/IChPMShlLCAhMCksIGUuc3RybS5hdmFpbF9vdXQgPT09IDAgPyB0ZTEgOiBoZTEpIDogKGUuc3Ryc3RhcnQgPiBlLmJsb2NrX3N0YXJ0ICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApLCBEMik7Cn0sIFFlID0gKGUsIGkpPT57CiAgICBsZXQgdCwgbjsKICAgIGZvcig7Oyl7CiAgICAgICAgaWYgKGUubG9va2FoZWFkIDwgQzEpIHsKICAgICAgICAgICAgaWYgKGllMShlKSwgZS5sb29rYWhlYWQgPCBDMSAmJiBpID09PSBsZTEpIHJldHVybiBEMjsKICAgICAgICAgICAgaWYgKGUubG9va2FoZWFkID09PSAwKSBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHQgPSAwLCBlLmxvb2thaGVhZCA+PSBrMSAmJiAoZS5pbnNfaCA9IFYyKGUsIGUuaW5zX2gsIGUud2luZG93W2Uuc3Ryc3RhcnQgKyBrMSAtIDFdKSwgdCA9IGUucHJldltlLnN0cnN0YXJ0ICYgZS53X21hc2tdID0gZS5oZWFkW2UuaW5zX2hdLCBlLmhlYWRbZS5pbnNfaF0gPSBlLnN0cnN0YXJ0KSwgdCAhPT0gMCAmJiBlLnN0cnN0YXJ0IC0gdCA8PSBlLndfc2l6ZSAtIEMxICYmIChlLm1hdGNoX2xlbmd0aCA9IGtpKGUsIHQpKSwgZS5tYXRjaF9sZW5ndGggPj0gazEpIGlmIChuID0gajEoZSwgZS5zdHJzdGFydCAtIGUubWF0Y2hfc3RhcnQsIGUubWF0Y2hfbGVuZ3RoIC0gazEpLCBlLmxvb2thaGVhZCAtPSBlLm1hdGNoX2xlbmd0aCwgZS5tYXRjaF9sZW5ndGggPD0gZS5tYXhfbGF6eV9tYXRjaCAmJiBlLmxvb2thaGVhZCA+PSBrMSkgewogICAgICAgICAgICBlLm1hdGNoX2xlbmd0aC0tOwogICAgICAgICAgICBkbyBlLnN0cnN0YXJ0KyssIGUuaW5zX2ggPSBWMihlLCBlLmluc19oLCBlLndpbmRvd1tlLnN0cnN0YXJ0ICsgazEgLSAxXSksIHQgPSBlLnByZXZbZS5zdHJzdGFydCAmIGUud19tYXNrXSA9IGUuaGVhZFtlLmluc19oXSwgZS5oZWFkW2UuaW5zX2hdID0gZS5zdHJzdGFydDsKICAgICAgICAgICAgd2hpbGUgKC0tZS5tYXRjaF9sZW5ndGggIT09IDApCiAgICAgICAgICAgIGUuc3Ryc3RhcnQrKzsKICAgICAgICB9IGVsc2UgZS5zdHJzdGFydCArPSBlLm1hdGNoX2xlbmd0aCwgZS5tYXRjaF9sZW5ndGggPSAwLCBlLmluc19oID0gZS53aW5kb3dbZS5zdHJzdGFydF0sIGUuaW5zX2ggPSBWMihlLCBlLmluc19oLCBlLndpbmRvd1tlLnN0cnN0YXJ0ICsgMV0pOwogICAgICAgIGVsc2UgbiA9IGoxKGUsIDAsIGUud2luZG93W2Uuc3Ryc3RhcnRdKSwgZS5sb29rYWhlYWQtLSwgZS5zdHJzdGFydCsrOwogICAgICAgIGlmIChuICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gRDI7CiAgICB9CiAgICByZXR1cm4gZS5pbnNlcnQgPSBlLnN0cnN0YXJ0IDwgazEgLSAxID8gZS5zdHJzdGFydCA6IGsxIC0gMSwgaSA9PT0gVzIgPyAoTzEoZSwgITApLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwID8gdGUxIDogaGUxKSA6IGUubGFzdF9saXQgJiYgKE8xKGUsICExKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCkgPyBEMiA6IFJlOwp9LCByZTEgPSAoZSwgaSk9PnsKICAgIGxldCB0LCBuLCBhOwogICAgZm9yKDs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPCBDMSkgewogICAgICAgICAgICBpZiAoaWUxKGUpLCBlLmxvb2thaGVhZCA8IEMxICYmIGkgPT09IGxlMSkgcmV0dXJuIEQyOwogICAgICAgICAgICBpZiAoZS5sb29rYWhlYWQgPT09IDApIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAodCA9IDAsIGUubG9va2FoZWFkID49IGsxICYmIChlLmluc19oID0gVjIoZSwgZS5pbnNfaCwgZS53aW5kb3dbZS5zdHJzdGFydCArIGsxIC0gMV0pLCB0ID0gZS5wcmV2W2Uuc3Ryc3RhcnQgJiBlLndfbWFza10gPSBlLmhlYWRbZS5pbnNfaF0sIGUuaGVhZFtlLmluc19oXSA9IGUuc3Ryc3RhcnQpLCBlLnByZXZfbGVuZ3RoID0gZS5tYXRjaF9sZW5ndGgsIGUucHJldl9tYXRjaCA9IGUubWF0Y2hfc3RhcnQsIGUubWF0Y2hfbGVuZ3RoID0gazEgLSAxLCB0ICE9PSAwICYmIGUucHJldl9sZW5ndGggPCBlLm1heF9sYXp5X21hdGNoICYmIGUuc3Ryc3RhcnQgLSB0IDw9IGUud19zaXplIC0gQzEgJiYgKGUubWF0Y2hfbGVuZ3RoID0ga2koZSwgdCksIGUubWF0Y2hfbGVuZ3RoIDw9IDUgJiYgKGUuc3RyYXRlZ3kgPT09IHlhIHx8IGUubWF0Y2hfbGVuZ3RoID09PSBrMSAmJiBlLnN0cnN0YXJ0IC0gZS5tYXRjaF9zdGFydCA+IDQwOTYpICYmIChlLm1hdGNoX2xlbmd0aCA9IGsxIC0gMSkpLCBlLnByZXZfbGVuZ3RoID49IGsxICYmIGUubWF0Y2hfbGVuZ3RoIDw9IGUucHJldl9sZW5ndGgpIHsKICAgICAgICAgICAgYSA9IGUuc3Ryc3RhcnQgKyBlLmxvb2thaGVhZCAtIGsxLCBuID0gajEoZSwgZS5zdHJzdGFydCAtIDEgLSBlLnByZXZfbWF0Y2gsIGUucHJldl9sZW5ndGggLSBrMSksIGUubG9va2FoZWFkIC09IGUucHJldl9sZW5ndGggLSAxLCBlLnByZXZfbGVuZ3RoIC09IDI7CiAgICAgICAgICAgIGRvICsrZS5zdHJzdGFydCA8PSBhICYmIChlLmluc19oID0gVjIoZSwgZS5pbnNfaCwgZS53aW5kb3dbZS5zdHJzdGFydCArIGsxIC0gMV0pLCB0ID0gZS5wcmV2W2Uuc3Ryc3RhcnQgJiBlLndfbWFza10gPSBlLmhlYWRbZS5pbnNfaF0sIGUuaGVhZFtlLmluc19oXSA9IGUuc3Ryc3RhcnQpOwogICAgICAgICAgICB3aGlsZSAoLS1lLnByZXZfbGVuZ3RoICE9PSAwKQogICAgICAgICAgICBpZiAoZS5tYXRjaF9hdmFpbGFibGUgPSAwLCBlLm1hdGNoX2xlbmd0aCA9IGsxIC0gMSwgZS5zdHJzdGFydCsrLCBuICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gRDI7CiAgICAgICAgfSBlbHNlIGlmIChlLm1hdGNoX2F2YWlsYWJsZSkgewogICAgICAgICAgICBpZiAobiA9IGoxKGUsIDAsIGUud2luZG93W2Uuc3Ryc3RhcnQgLSAxXSksIG4gJiYgTzEoZSwgITEpLCBlLnN0cnN0YXJ0KyssIGUubG9va2FoZWFkLS0sIGUuc3RybS5hdmFpbF9vdXQgPT09IDApIHJldHVybiBEMjsKICAgICAgICB9IGVsc2UgZS5tYXRjaF9hdmFpbGFibGUgPSAxLCBlLnN0cnN0YXJ0KyssIGUubG9va2FoZWFkLS07CiAgICB9CiAgICByZXR1cm4gZS5tYXRjaF9hdmFpbGFibGUgJiYgKG4gPSBqMShlLCAwLCBlLndpbmRvd1tlLnN0cnN0YXJ0IC0gMV0pLCBlLm1hdGNoX2F2YWlsYWJsZSA9IDApLCBlLmluc2VydCA9IGUuc3Ryc3RhcnQgPCBrMSAtIDEgPyBlLnN0cnN0YXJ0IDogazEgLSAxLCBpID09PSBXMiA/IChPMShlLCAhMCksIGUuc3RybS5hdmFpbF9vdXQgPT09IDAgPyB0ZTEgOiBoZTEpIDogZS5sYXN0X2xpdCAmJiAoTzEoZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSA/IEQyIDogUmU7Cn0sIEJhID0gKGUsIGkpPT57CiAgICBsZXQgdCwgbiwgYSwgbCwgbyA9IGUud2luZG93OwogICAgZm9yKDs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPD0gWTIpIHsKICAgICAgICAgICAgaWYgKGllMShlKSwgZS5sb29rYWhlYWQgPD0gWTIgJiYgaSA9PT0gbGUxKSByZXR1cm4gRDI7CiAgICAgICAgICAgIGlmIChlLmxvb2thaGVhZCA9PT0gMCkgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChlLm1hdGNoX2xlbmd0aCA9IDAsIGUubG9va2FoZWFkID49IGsxICYmIGUuc3Ryc3RhcnQgPiAwICYmIChhID0gZS5zdHJzdGFydCAtIDEsIG4gPSBvW2FdLCBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSkpIHsKICAgICAgICAgICAgbCA9IGUuc3Ryc3RhcnQgKyBZMjsKICAgICAgICAgICAgZG8gOwogICAgICAgICAgICB3aGlsZSAobiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSAmJiBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSAmJiBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSAmJiBhIDwgbCkKICAgICAgICAgICAgZS5tYXRjaF9sZW5ndGggPSBZMiAtIChsIC0gYSksIGUubWF0Y2hfbGVuZ3RoID4gZS5sb29rYWhlYWQgJiYgKGUubWF0Y2hfbGVuZ3RoID0gZS5sb29rYWhlYWQpOwogICAgICAgIH0KICAgICAgICBpZiAoZS5tYXRjaF9sZW5ndGggPj0gazEgPyAodCA9IGoxKGUsIDEsIGUubWF0Y2hfbGVuZ3RoIC0gazEpLCBlLmxvb2thaGVhZCAtPSBlLm1hdGNoX2xlbmd0aCwgZS5zdHJzdGFydCArPSBlLm1hdGNoX2xlbmd0aCwgZS5tYXRjaF9sZW5ndGggPSAwKSA6ICh0ID0gajEoZSwgMCwgZS53aW5kb3dbZS5zdHJzdGFydF0pLCBlLmxvb2thaGVhZC0tLCBlLnN0cnN0YXJ0KyspLCB0ICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gRDI7CiAgICB9CiAgICByZXR1cm4gZS5pbnNlcnQgPSAwLCBpID09PSBXMiA/IChPMShlLCAhMCksIGUuc3RybS5hdmFpbF9vdXQgPT09IDAgPyB0ZTEgOiBoZTEpIDogZS5sYXN0X2xpdCAmJiAoTzEoZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSA/IEQyIDogUmU7Cn0sIEthID0gKGUsIGkpPT57CiAgICBsZXQgdDsKICAgIGZvcig7Oyl7CiAgICAgICAgaWYgKGUubG9va2FoZWFkID09PSAwICYmIChpZTEoZSksIGUubG9va2FoZWFkID09PSAwKSkgewogICAgICAgICAgICBpZiAoaSA9PT0gbGUxKSByZXR1cm4gRDI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoZS5tYXRjaF9sZW5ndGggPSAwLCB0ID0gajEoZSwgMCwgZS53aW5kb3dbZS5zdHJzdGFydF0pLCBlLmxvb2thaGVhZC0tLCBlLnN0cnN0YXJ0KyssIHQgJiYgKE8xKGUsICExKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCkpIHJldHVybiBEMjsKICAgIH0KICAgIHJldHVybiBlLmluc2VydCA9IDAsIGkgPT09IFcyID8gKE8xKGUsICEwKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCA/IHRlMSA6IGhlMSkgOiBlLmxhc3RfbGl0ICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApID8gRDIgOiBSZTsKfTsKZnVuY3Rpb24gJDIoZSwgaSwgdCwgbiwgYSkgewogICAgdGhpcy5nb29kX2xlbmd0aCA9IGUsIHRoaXMubWF4X2xhenkgPSBpLCB0aGlzLm5pY2VfbGVuZ3RoID0gdCwgdGhpcy5tYXhfY2hhaW4gPSBuLCB0aGlzLmZ1bmMgPSBhOwp9CnZhciBjZTEgPSBbCiAgICBuZXcgJDIoMCwgMCwgMCwgMCwgSGEpLAogICAgbmV3ICQyKDQsIDQsIDgsIDQsIFFlKSwKICAgIG5ldyAkMig0LCA1LCAxNiwgOCwgUWUpLAogICAgbmV3ICQyKDQsIDYsIDMyLCAzMiwgUWUpLAogICAgbmV3ICQyKDQsIDQsIDE2LCAxNiwgcmUxKSwKICAgIG5ldyAkMig4LCAxNiwgMzIsIDMyLCByZTEpLAogICAgbmV3ICQyKDgsIDE2LCAxMjgsIDEyOCwgcmUxKSwKICAgIG5ldyAkMig4LCAzMiwgMTI4LCAyNTYsIHJlMSksCiAgICBuZXcgJDIoMzIsIDEyOCwgMjU4LCAxMDI0LCByZTEpLAogICAgbmV3ICQyKDMyLCAyNTgsIDI1OCwgNDA5NiwgcmUxKQpdLCBQYSA9IChlKT0+ewogICAgZS53aW5kb3dfc2l6ZSA9IDIgKiBlLndfc2l6ZSwgWDIoZS5oZWFkKSwgZS5tYXhfbGF6eV9tYXRjaCA9IGNlMVtlLmxldmVsXS5tYXhfbGF6eSwgZS5nb29kX21hdGNoID0gY2UxW2UubGV2ZWxdLmdvb2RfbGVuZ3RoLCBlLm5pY2VfbWF0Y2ggPSBjZTFbZS5sZXZlbF0ubmljZV9sZW5ndGgsIGUubWF4X2NoYWluX2xlbmd0aCA9IGNlMVtlLmxldmVsXS5tYXhfY2hhaW4sIGUuc3Ryc3RhcnQgPSAwLCBlLmJsb2NrX3N0YXJ0ID0gMCwgZS5sb29rYWhlYWQgPSAwLCBlLmluc2VydCA9IDAsIGUubWF0Y2hfbGVuZ3RoID0gZS5wcmV2X2xlbmd0aCA9IGsxIC0gMSwgZS5tYXRjaF9hdmFpbGFibGUgPSAwLCBlLmluc19oID0gMDsKfTsKZnVuY3Rpb24gWGEoKSB7CiAgICB0aGlzLnN0cm0gPSBudWxsLCB0aGlzLnN0YXR1cyA9IDAsIHRoaXMucGVuZGluZ19idWYgPSBudWxsLCB0aGlzLnBlbmRpbmdfYnVmX3NpemUgPSAwLCB0aGlzLnBlbmRpbmdfb3V0ID0gMCwgdGhpcy5wZW5kaW5nID0gMCwgdGhpcy53cmFwID0gMCwgdGhpcy5nemhlYWQgPSBudWxsLCB0aGlzLmd6aW5kZXggPSAwLCB0aGlzLm1ldGhvZCA9IFBlLCB0aGlzLmxhc3RfZmx1c2ggPSAtMSwgdGhpcy53X3NpemUgPSAwLCB0aGlzLndfYml0cyA9IDAsIHRoaXMud19tYXNrID0gMCwgdGhpcy53aW5kb3cgPSBudWxsLCB0aGlzLndpbmRvd19zaXplID0gMCwgdGhpcy5wcmV2ID0gbnVsbCwgdGhpcy5oZWFkID0gbnVsbCwgdGhpcy5pbnNfaCA9IDAsIHRoaXMuaGFzaF9zaXplID0gMCwgdGhpcy5oYXNoX2JpdHMgPSAwLCB0aGlzLmhhc2hfbWFzayA9IDAsIHRoaXMuaGFzaF9zaGlmdCA9IDAsIHRoaXMuYmxvY2tfc3RhcnQgPSAwLCB0aGlzLm1hdGNoX2xlbmd0aCA9IDAsIHRoaXMucHJldl9tYXRjaCA9IDAsIHRoaXMubWF0Y2hfYXZhaWxhYmxlID0gMCwgdGhpcy5zdHJzdGFydCA9IDAsIHRoaXMubWF0Y2hfc3RhcnQgPSAwLCB0aGlzLmxvb2thaGVhZCA9IDAsIHRoaXMucHJldl9sZW5ndGggPSAwLCB0aGlzLm1heF9jaGFpbl9sZW5ndGggPSAwLCB0aGlzLm1heF9sYXp5X21hdGNoID0gMCwgdGhpcy5sZXZlbCA9IDAsIHRoaXMuc3RyYXRlZ3kgPSAwLCB0aGlzLmdvb2RfbWF0Y2ggPSAwLCB0aGlzLm5pY2VfbWF0Y2ggPSAwLCB0aGlzLmR5bl9sdHJlZSA9IG5ldyBVaW50MTZBcnJheShMYSAqIDIpLCB0aGlzLmR5bl9kdHJlZSA9IG5ldyBVaW50MTZBcnJheSgoMiAqIE9hICsgMSkgKiAyKSwgdGhpcy5ibF90cmVlID0gbmV3IFVpbnQxNkFycmF5KCgyICogTmEgKyAxKSAqIDIpLCBYMih0aGlzLmR5bl9sdHJlZSksIFgyKHRoaXMuZHluX2R0cmVlKSwgWDIodGhpcy5ibF90cmVlKSwgdGhpcy5sX2Rlc2MgPSBudWxsLCB0aGlzLmRfZGVzYyA9IG51bGwsIHRoaXMuYmxfZGVzYyA9IG51bGwsIHRoaXMuYmxfY291bnQgPSBuZXcgVWludDE2QXJyYXkoVWEgKyAxKSwgdGhpcy5oZWFwID0gbmV3IFVpbnQxNkFycmF5KDIgKiBfdCArIDEpLCBYMih0aGlzLmhlYXApLCB0aGlzLmhlYXBfbGVuID0gMCwgdGhpcy5oZWFwX21heCA9IDAsIHRoaXMuZGVwdGggPSBuZXcgVWludDE2QXJyYXkoMiAqIF90ICsgMSksIFgyKHRoaXMuZGVwdGgpLCB0aGlzLmxfYnVmID0gMCwgdGhpcy5saXRfYnVmc2l6ZSA9IDAsIHRoaXMubGFzdF9saXQgPSAwLCB0aGlzLmRfYnVmID0gMCwgdGhpcy5vcHRfbGVuID0gMCwgdGhpcy5zdGF0aWNfbGVuID0gMCwgdGhpcy5tYXRjaGVzID0gMCwgdGhpcy5pbnNlcnQgPSAwLCB0aGlzLmJpX2J1ZiA9IDAsIHRoaXMuYmlfdmFsaWQgPSAwOwp9CnZhciB2aSA9IChlKT0+ewogICAgaWYgKCFlIHx8ICFlLnN0YXRlKSByZXR1cm4gRzEoZSwgTDEpOwogICAgZS50b3RhbF9pbiA9IGUudG90YWxfb3V0ID0gMCwgZS5kYXRhX3R5cGUgPSB6YTsKICAgIGxldCBpID0gZS5zdGF0ZTsKICAgIHJldHVybiBpLnBlbmRpbmcgPSAwLCBpLnBlbmRpbmdfb3V0ID0gMCwgaS53cmFwIDwgMCAmJiAoaS53cmFwID0gLWkud3JhcCksIGkuc3RhdHVzID0gaS53cmFwID8gWGUgOiBxMSwgZS5hZGxlciA9IGkud3JhcCA9PT0gMiA/IDAgOiAxLCBpLmxhc3RfZmx1c2ggPSBsZTEsIGJhKGkpLCBGMjsKfSwgRWkgPSAoZSk9PnsKICAgIGxldCBpID0gdmkoZSk7CiAgICByZXR1cm4gaSA9PT0gRjIgJiYgUGEoZS5zdGF0ZSksIGk7Cn0sIFlhID0gKGUsIGkpPT4hZSB8fCAhZS5zdGF0ZSB8fCBlLnN0YXRlLndyYXAgIT09IDIgPyBMMSA6IChlLnN0YXRlLmd6aGVhZCA9IGksIEYyKSwgeWkgPSAoZSwgaSwgdCwgbiwgYSwgbCk9PnsKICAgIGlmICghZSkgcmV0dXJuIEwxOwogICAgbGV0IG8gPSAxOwogICAgaWYgKGkgPT09IEVhICYmIChpID0gNiksIG4gPCAwID8gKG8gPSAwLCBuID0gLW4pIDogbiA+IDE1ICYmIChvID0gMiwgbiAtPSAxNiksIGEgPCAxIHx8IGEgPiBUYSB8fCB0ICE9PSBQZSB8fCBuIDwgOCB8fCBuID4gMTUgfHwgaSA8IDAgfHwgaSA+IDkgfHwgbCA8IDAgfHwgbCA+IEFhKSByZXR1cm4gRzEoZSwgTDEpOwogICAgbiA9PT0gOCAmJiAobiA9IDkpOwogICAgbGV0IGYgPSBuZXcgWGE7CiAgICByZXR1cm4gZS5zdGF0ZSA9IGYsIGYuc3RybSA9IGUsIGYud3JhcCA9IG8sIGYuZ3poZWFkID0gbnVsbCwgZi53X2JpdHMgPSBuLCBmLndfc2l6ZSA9IDEgPDwgZi53X2JpdHMsIGYud19tYXNrID0gZi53X3NpemUgLSAxLCBmLmhhc2hfYml0cyA9IGEgKyA3LCBmLmhhc2hfc2l6ZSA9IDEgPDwgZi5oYXNoX2JpdHMsIGYuaGFzaF9tYXNrID0gZi5oYXNoX3NpemUgLSAxLCBmLmhhc2hfc2hpZnQgPSB+figoZi5oYXNoX2JpdHMgKyBrMSAtIDEpIC8gazEpLCBmLndpbmRvdyA9IG5ldyBVaW50OEFycmF5KGYud19zaXplICogMiksIGYuaGVhZCA9IG5ldyBVaW50MTZBcnJheShmLmhhc2hfc2l6ZSksIGYucHJldiA9IG5ldyBVaW50MTZBcnJheShmLndfc2l6ZSksIGYubGl0X2J1ZnNpemUgPSAxIDw8IGEgKyA2LCBmLnBlbmRpbmdfYnVmX3NpemUgPSBmLmxpdF9idWZzaXplICogNCwgZi5wZW5kaW5nX2J1ZiA9IG5ldyBVaW50OEFycmF5KGYucGVuZGluZ19idWZfc2l6ZSksIGYuZF9idWYgPSAxICogZi5saXRfYnVmc2l6ZSwgZi5sX2J1ZiA9ICgxICsgMikgKiBmLmxpdF9idWZzaXplLCBmLmxldmVsID0gaSwgZi5zdHJhdGVneSA9IGwsIGYubWV0aG9kID0gdCwgRWkoZSk7Cn0sIEdhID0gKGUsIGkpPT55aShlLCBpLCBQZSwgbWEsIERhLCBSYSksIGphID0gKGUsIGkpPT57CiAgICBsZXQgdCwgbjsKICAgIGlmICghZSB8fCAhZS5zdGF0ZSB8fCBpID4gUnQgfHwgaSA8IDApIHJldHVybiBlID8gRzEoZSwgTDEpIDogTDE7CiAgICBsZXQgYSA9IGUuc3RhdGU7CiAgICBpZiAoIWUub3V0cHV0IHx8ICFlLmlucHV0ICYmIGUuYXZhaWxfaW4gIT09IDAgfHwgYS5zdGF0dXMgPT09IHNlICYmIGkgIT09IFcyKSByZXR1cm4gRzEoZSwgZS5hdmFpbF9vdXQgPT09IDAgPyBKZSA6IEwxKTsKICAgIGEuc3RybSA9IGU7CiAgICBsZXQgbCA9IGEubGFzdF9mbHVzaDsKICAgIGlmIChhLmxhc3RfZmx1c2ggPSBpLCBhLnN0YXR1cyA9PT0gWGUpIGlmIChhLndyYXAgPT09IDIpIGUuYWRsZXIgPSAwLCB5MihhLCAzMSksIHkyKGEsIDEzOSksIHkyKGEsIDgpLCBhLmd6aGVhZCA/ICh5MihhLCAoYS5nemhlYWQudGV4dCA/IDEgOiAwKSArIChhLmd6aGVhZC5oY3JjID8gMiA6IDApICsgKGEuZ3poZWFkLmV4dHJhID8gNCA6IDApICsgKGEuZ3poZWFkLm5hbWUgPyA4IDogMCkgKyAoYS5nemhlYWQuY29tbWVudCA/IDE2IDogMCkpLCB5MihhLCBhLmd6aGVhZC50aW1lICYgMjU1KSwgeTIoYSwgYS5nemhlYWQudGltZSA+PiA4ICYgMjU1KSwgeTIoYSwgYS5nemhlYWQudGltZSA+PiAxNiAmIDI1NSksIHkyKGEsIGEuZ3poZWFkLnRpbWUgPj4gMjQgJiAyNTUpLCB5MihhLCBhLmxldmVsID09PSA5ID8gMiA6IGEuc3RyYXRlZ3kgPj0gSWUgfHwgYS5sZXZlbCA8IDIgPyA0IDogMCksIHkyKGEsIGEuZ3poZWFkLm9zICYgMjU1KSwgYS5nemhlYWQuZXh0cmEgJiYgYS5nemhlYWQuZXh0cmEubGVuZ3RoICYmICh5MihhLCBhLmd6aGVhZC5leHRyYS5sZW5ndGggJiAyNTUpLCB5MihhLCBhLmd6aGVhZC5leHRyYS5sZW5ndGggPj4gOCAmIDI1NSkpLCBhLmd6aGVhZC5oY3JjICYmIChlLmFkbGVyID0gSTIoZS5hZGxlciwgYS5wZW5kaW5nX2J1ZiwgYS5wZW5kaW5nLCAwKSksIGEuZ3ppbmRleCA9IDAsIGEuc3RhdHVzID0gaHQpIDogKHkyKGEsIDApLCB5MihhLCAwKSwgeTIoYSwgMCksIHkyKGEsIDApLCB5MihhLCAwKSwgeTIoYSwgYS5sZXZlbCA9PT0gOSA/IDIgOiBhLnN0cmF0ZWd5ID49IEllIHx8IGEubGV2ZWwgPCAyID8gNCA6IDApLCB5MihhLCAkYSksIGEuc3RhdHVzID0gcTEpOwogICAgZWxzZSB7CiAgICAgICAgbGV0IG8gPSBQZSArIChhLndfYml0cyAtIDggPDwgNCkgPDwgOCwgZiA9IC0xOwogICAgICAgIGEuc3RyYXRlZ3kgPj0gSWUgfHwgYS5sZXZlbCA8IDIgPyBmID0gMCA6IGEubGV2ZWwgPCA2ID8gZiA9IDEgOiBhLmxldmVsID09PSA2ID8gZiA9IDIgOiBmID0gMywgbyB8PSBmIDw8IDYsIGEuc3Ryc3RhcnQgIT09IDAgJiYgKG8gfD0gQ2EpLCBvICs9IDMxIC0gbyAlIDMxLCBhLnN0YXR1cyA9IHExLCBkZTEoYSwgbyksIGEuc3Ryc3RhcnQgIT09IDAgJiYgKGRlMShhLCBlLmFkbGVyID4+PiAxNiksIGRlMShhLCBlLmFkbGVyICYgNjU1MzUpKSwgZS5hZGxlciA9IDE7CiAgICB9CiAgICBpZiAoYS5zdGF0dXMgPT09IGh0KSBpZiAoYS5nemhlYWQuZXh0cmEpIHsKICAgICAgICBmb3IodCA9IGEucGVuZGluZzsgYS5nemluZGV4IDwgKGEuZ3poZWFkLmV4dHJhLmxlbmd0aCAmIDY1NTM1KSAmJiAhKGEucGVuZGluZyA9PT0gYS5wZW5kaW5nX2J1Zl9zaXplICYmIChhLmd6aGVhZC5oY3JjICYmIGEucGVuZGluZyA+IHQgJiYgKGUuYWRsZXIgPSBJMihlLmFkbGVyLCBhLnBlbmRpbmdfYnVmLCBhLnBlbmRpbmcgLSB0LCB0KSksIFAyKGUpLCB0ID0gYS5wZW5kaW5nLCBhLnBlbmRpbmcgPT09IGEucGVuZGluZ19idWZfc2l6ZSkpOyl5MihhLCBhLmd6aGVhZC5leHRyYVthLmd6aW5kZXhdICYgMjU1KSwgYS5nemluZGV4Kys7CiAgICAgICAgYS5nemhlYWQuaGNyYyAmJiBhLnBlbmRpbmcgPiB0ICYmIChlLmFkbGVyID0gSTIoZS5hZGxlciwgYS5wZW5kaW5nX2J1ZiwgYS5wZW5kaW5nIC0gdCwgdCkpLCBhLmd6aW5kZXggPT09IGEuZ3poZWFkLmV4dHJhLmxlbmd0aCAmJiAoYS5nemluZGV4ID0gMCwgYS5zdGF0dXMgPSAkZSk7CiAgICB9IGVsc2UgYS5zdGF0dXMgPSAkZTsKICAgIGlmIChhLnN0YXR1cyA9PT0gJGUpIGlmIChhLmd6aGVhZC5uYW1lKSB7CiAgICAgICAgdCA9IGEucGVuZGluZzsKICAgICAgICBkbyB7CiAgICAgICAgICAgIGlmIChhLnBlbmRpbmcgPT09IGEucGVuZGluZ19idWZfc2l6ZSAmJiAoYS5nemhlYWQuaGNyYyAmJiBhLnBlbmRpbmcgPiB0ICYmIChlLmFkbGVyID0gSTIoZS5hZGxlciwgYS5wZW5kaW5nX2J1ZiwgYS5wZW5kaW5nIC0gdCwgdCkpLCBQMihlKSwgdCA9IGEucGVuZGluZywgYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUpKSB7CiAgICAgICAgICAgICAgICBuID0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGEuZ3ppbmRleCA8IGEuZ3poZWFkLm5hbWUubGVuZ3RoID8gbiA9IGEuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChhLmd6aW5kZXgrKykgJiAyNTUgOiBuID0gMCwgeTIoYSwgbik7CiAgICAgICAgfXdoaWxlIChuICE9PSAwKQogICAgICAgIGEuZ3poZWFkLmhjcmMgJiYgYS5wZW5kaW5nID4gdCAmJiAoZS5hZGxlciA9IEkyKGUuYWRsZXIsIGEucGVuZGluZ19idWYsIGEucGVuZGluZyAtIHQsIHQpKSwgbiA9PT0gMCAmJiAoYS5nemluZGV4ID0gMCwgYS5zdGF0dXMgPSBNZSk7CiAgICB9IGVsc2UgYS5zdGF0dXMgPSBNZTsKICAgIGlmIChhLnN0YXR1cyA9PT0gTWUpIGlmIChhLmd6aGVhZC5jb21tZW50KSB7CiAgICAgICAgdCA9IGEucGVuZGluZzsKICAgICAgICBkbyB7CiAgICAgICAgICAgIGlmIChhLnBlbmRpbmcgPT09IGEucGVuZGluZ19idWZfc2l6ZSAmJiAoYS5nemhlYWQuaGNyYyAmJiBhLnBlbmRpbmcgPiB0ICYmIChlLmFkbGVyID0gSTIoZS5hZGxlciwgYS5wZW5kaW5nX2J1ZiwgYS5wZW5kaW5nIC0gdCwgdCkpLCBQMihlKSwgdCA9IGEucGVuZGluZywgYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUpKSB7CiAgICAgICAgICAgICAgICBuID0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGEuZ3ppbmRleCA8IGEuZ3poZWFkLmNvbW1lbnQubGVuZ3RoID8gbiA9IGEuZ3poZWFkLmNvbW1lbnQuY2hhckNvZGVBdChhLmd6aW5kZXgrKykgJiAyNTUgOiBuID0gMCwgeTIoYSwgbik7CiAgICAgICAgfXdoaWxlIChuICE9PSAwKQogICAgICAgIGEuZ3poZWFkLmhjcmMgJiYgYS5wZW5kaW5nID4gdCAmJiAoZS5hZGxlciA9IEkyKGUuYWRsZXIsIGEucGVuZGluZ19idWYsIGEucGVuZGluZyAtIHQsIHQpKSwgbiA9PT0gMCAmJiAoYS5zdGF0dXMgPSBGZSk7CiAgICB9IGVsc2UgYS5zdGF0dXMgPSBGZTsKICAgIGlmIChhLnN0YXR1cyA9PT0gRmUgJiYgKGEuZ3poZWFkLmhjcmMgPyAoYS5wZW5kaW5nICsgMiA+IGEucGVuZGluZ19idWZfc2l6ZSAmJiBQMihlKSwgYS5wZW5kaW5nICsgMiA8PSBhLnBlbmRpbmdfYnVmX3NpemUgJiYgKHkyKGEsIGUuYWRsZXIgJiAyNTUpLCB5MihhLCBlLmFkbGVyID4+IDggJiAyNTUpLCBlLmFkbGVyID0gMCwgYS5zdGF0dXMgPSBxMSkpIDogYS5zdGF0dXMgPSBxMSksIGEucGVuZGluZyAhPT0gMCkgewogICAgICAgIGlmIChQMihlKSwgZS5hdmFpbF9vdXQgPT09IDApIHJldHVybiBhLmxhc3RfZmx1c2ggPSAtMSwgRjI7CiAgICB9IGVsc2UgaWYgKGUuYXZhaWxfaW4gPT09IDAgJiYgVHQoaSkgPD0gVHQobCkgJiYgaSAhPT0gVzIpIHJldHVybiBHMShlLCBKZSk7CiAgICBpZiAoYS5zdGF0dXMgPT09IHNlICYmIGUuYXZhaWxfaW4gIT09IDApIHJldHVybiBHMShlLCBKZSk7CiAgICBpZiAoZS5hdmFpbF9pbiAhPT0gMCB8fCBhLmxvb2thaGVhZCAhPT0gMCB8fCBpICE9PSBsZTEgJiYgYS5zdGF0dXMgIT09IHNlKSB7CiAgICAgICAgbGV0IG8xID0gYS5zdHJhdGVneSA9PT0gSWUgPyBLYShhLCBpKSA6IGEuc3RyYXRlZ3kgPT09IFNhID8gQmEoYSwgaSkgOiBjZTFbYS5sZXZlbF0uZnVuYyhhLCBpKTsKICAgICAgICBpZiAoKG8xID09PSB0ZTEgfHwgbzEgPT09IGhlMSkgJiYgKGEuc3RhdHVzID0gc2UpLCBvMSA9PT0gRDIgfHwgbzEgPT09IHRlMSkgcmV0dXJuIGUuYXZhaWxfb3V0ID09PSAwICYmIChhLmxhc3RfZmx1c2ggPSAtMSksIEYyOwogICAgICAgIGlmIChvMSA9PT0gUmUgJiYgKGkgPT09IHhhID8gcGEoYSkgOiBpICE9PSBSdCAmJiAod2EoYSwgMCwgMCwgITEpLCBpID09PSBrYSAmJiAoWDIoYS5oZWFkKSwgYS5sb29rYWhlYWQgPT09IDAgJiYgKGEuc3Ryc3RhcnQgPSAwLCBhLmJsb2NrX3N0YXJ0ID0gMCwgYS5pbnNlcnQgPSAwKSkpLCBQMihlKSwgZS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gYS5sYXN0X2ZsdXNoID0gLTEsIEYyOwogICAgfQogICAgcmV0dXJuIGkgIT09IFcyID8gRjIgOiBhLndyYXAgPD0gMCA/IHp0IDogKGEud3JhcCA9PT0gMiA/ICh5MihhLCBlLmFkbGVyICYgMjU1KSwgeTIoYSwgZS5hZGxlciA+PiA4ICYgMjU1KSwgeTIoYSwgZS5hZGxlciA+PiAxNiAmIDI1NSksIHkyKGEsIGUuYWRsZXIgPj4gMjQgJiAyNTUpLCB5MihhLCBlLnRvdGFsX2luICYgMjU1KSwgeTIoYSwgZS50b3RhbF9pbiA+PiA4ICYgMjU1KSwgeTIoYSwgZS50b3RhbF9pbiA+PiAxNiAmIDI1NSksIHkyKGEsIGUudG90YWxfaW4gPj4gMjQgJiAyNTUpKSA6IChkZTEoYSwgZS5hZGxlciA+Pj4gMTYpLCBkZTEoYSwgZS5hZGxlciAmIDY1NTM1KSksIFAyKGUpLCBhLndyYXAgPiAwICYmIChhLndyYXAgPSAtYS53cmFwKSwgYS5wZW5kaW5nICE9PSAwID8gRjIgOiB6dCk7Cn0sIFdhID0gKGUpPT57CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBMMTsKICAgIGxldCBpID0gZS5zdGF0ZS5zdGF0dXM7CiAgICByZXR1cm4gaSAhPT0gWGUgJiYgaSAhPT0gaHQgJiYgaSAhPT0gJGUgJiYgaSAhPT0gTWUgJiYgaSAhPT0gRmUgJiYgaSAhPT0gcTEgJiYgaSAhPT0gc2UgPyBHMShlLCBMMSkgOiAoZS5zdGF0ZSA9IG51bGwsIGkgPT09IHExID8gRzEoZSwgdmEpIDogRjIpOwp9LCBWYSA9IChlLCBpKT0+ewogICAgbGV0IHQgPSBpLmxlbmd0aDsKICAgIGlmICghZSB8fCAhZS5zdGF0ZSkgcmV0dXJuIEwxOwogICAgbGV0IG4gPSBlLnN0YXRlLCBhID0gbi53cmFwOwogICAgaWYgKGEgPT09IDIgfHwgYSA9PT0gMSAmJiBuLnN0YXR1cyAhPT0gWGUgfHwgbi5sb29rYWhlYWQpIHJldHVybiBMMTsKICAgIGlmIChhID09PSAxICYmIChlLmFkbGVyID0gdmUxKGUuYWRsZXIsIGksIHQsIDApKSwgbi53cmFwID0gMCwgdCA+PSBuLndfc2l6ZSkgewogICAgICAgIGEgPT09IDAgJiYgKFgyKG4uaGVhZCksIG4uc3Ryc3RhcnQgPSAwLCBuLmJsb2NrX3N0YXJ0ID0gMCwgbi5pbnNlcnQgPSAwKTsKICAgICAgICBsZXQgYyA9IG5ldyBVaW50OEFycmF5KG4ud19zaXplKTsKICAgICAgICBjLnNldChpLnN1YmFycmF5KHQgLSBuLndfc2l6ZSwgdCksIDApLCBpID0gYywgdCA9IG4ud19zaXplOwogICAgfQogICAgbGV0IGwgPSBlLmF2YWlsX2luLCBvID0gZS5uZXh0X2luLCBmID0gZS5pbnB1dDsKICAgIGZvcihlLmF2YWlsX2luID0gdCwgZS5uZXh0X2luID0gMCwgZS5pbnB1dCA9IGksIGllMShuKTsgbi5sb29rYWhlYWQgPj0gazE7KXsKICAgICAgICBsZXQgYzEgPSBuLnN0cnN0YXJ0LCByID0gbi5sb29rYWhlYWQgLSAoazEgLSAxKTsKICAgICAgICBkbyBuLmluc19oID0gVjIobiwgbi5pbnNfaCwgbi53aW5kb3dbYzEgKyBrMSAtIDFdKSwgbi5wcmV2W2MxICYgbi53X21hc2tdID0gbi5oZWFkW24uaW5zX2hdLCBuLmhlYWRbbi5pbnNfaF0gPSBjMSwgYzErKzsKICAgICAgICB3aGlsZSAoLS1yKQogICAgICAgIG4uc3Ryc3RhcnQgPSBjMSwgbi5sb29rYWhlYWQgPSBrMSAtIDEsIGllMShuKTsKICAgIH0KICAgIHJldHVybiBuLnN0cnN0YXJ0ICs9IG4ubG9va2FoZWFkLCBuLmJsb2NrX3N0YXJ0ID0gbi5zdHJzdGFydCwgbi5pbnNlcnQgPSBuLmxvb2thaGVhZCwgbi5sb29rYWhlYWQgPSAwLCBuLm1hdGNoX2xlbmd0aCA9IG4ucHJldl9sZW5ndGggPSBrMSAtIDEsIG4ubWF0Y2hfYXZhaWxhYmxlID0gMCwgZS5uZXh0X2luID0gbywgZS5pbnB1dCA9IGYsIGUuYXZhaWxfaW4gPSBsLCBuLndyYXAgPSBhLCBGMjsKfSwgSmEgPSBHYSwgUWEgPSB5aSwgcWEgPSBFaSwgZW4gPSB2aSwgdG4gPSBZYSwgYW4gPSBqYSwgbm4gPSBXYSwgbG4gPSBWYSwgcm4gPSAicGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSIsIGJlID0gewogICAgZGVmbGF0ZUluaXQ6IEphLAogICAgZGVmbGF0ZUluaXQyOiBRYSwKICAgIGRlZmxhdGVSZXNldDogcWEsCiAgICBkZWZsYXRlUmVzZXRLZWVwOiBlbiwKICAgIGRlZmxhdGVTZXRIZWFkZXI6IHRuLAogICAgZGVmbGF0ZTogYW4sCiAgICBkZWZsYXRlRW5kOiBubiwKICAgIGRlZmxhdGVTZXREaWN0aW9uYXJ5OiBsbiwKICAgIGRlZmxhdGVJbmZvOiBybgp9LCBmbiA9IChlLCBpKT0+T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIGkpLCBvbiA9IGZ1bmN0aW9uKGUpIHsKICAgIGxldCBpID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIGZvcig7IGkubGVuZ3RoOyl7CiAgICAgICAgbGV0IHQgPSBpLnNoaWZ0KCk7CiAgICAgICAgaWYgKCEhdCkgewogICAgICAgICAgICBpZiAodHlwZW9mIHQgIT0gIm9iamVjdCIpIHRocm93IG5ldyBUeXBlRXJyb3IodCArICJtdXN0IGJlIG5vbi1vYmplY3QiKTsKICAgICAgICAgICAgZm9yKGxldCBuIGluIHQpZm4odCwgbikgJiYgKGVbbl0gPSB0W25dKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZTsKfSwgX24gPSAoZSk9PnsKICAgIGxldCBpID0gMDsKICAgIGZvcihsZXQgbiA9IDAsIGEgPSBlLmxlbmd0aDsgbiA8IGE7IG4rKylpICs9IGVbbl0ubGVuZ3RoOwogICAgbGV0IHQgPSBuZXcgVWludDhBcnJheShpKTsKICAgIGZvcihsZXQgbjEgPSAwLCBhMSA9IDAsIGwgPSBlLmxlbmd0aDsgbjEgPCBsOyBuMSsrKXsKICAgICAgICBsZXQgbyA9IGVbbjFdOwogICAgICAgIHQuc2V0KG8sIGExKSwgYTEgKz0gby5sZW5ndGg7CiAgICB9CiAgICByZXR1cm4gdDsKfSwgWWUgPSB7CiAgICBhc3NpZ246IG9uLAogICAgZmxhdHRlbkNodW5rczogX24KfSwgU2kgPSAhMDsKdHJ5IHsKICAgIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQ4QXJyYXkoMSkpOwp9IGNhdGNoICB7CiAgICBTaSA9ICExOwp9CnZhciBFZTEgPSBuZXcgVWludDhBcnJheSgyNTYpOwpmb3IobGV0IGUgPSAwOyBlIDwgMjU2OyBlKyspRWUxW2VdID0gZSA+PSAyNTIgPyA2IDogZSA+PSAyNDggPyA1IDogZSA+PSAyNDAgPyA0IDogZSA+PSAyMjQgPyAzIDogZSA+PSAxOTIgPyAyIDogMTsKRWUxWzI1NF0gPSBFZTFbMjU0XSA9IDE7CnZhciBobiA9IChlKT0+ewogICAgaWYgKHR5cGVvZiBUZXh0RW5jb2RlciA9PSAiZnVuY3Rpb24iICYmIFRleHRFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGUpIHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoZSk7CiAgICBsZXQgaSwgdCwgbiwgYSwgbCwgbyA9IGUubGVuZ3RoLCBmID0gMDsKICAgIGZvcihhID0gMDsgYSA8IG87IGErKyl0ID0gZS5jaGFyQ29kZUF0KGEpLCAodCAmIDY0NTEyKSA9PT0gNTUyOTYgJiYgYSArIDEgPCBvICYmIChuID0gZS5jaGFyQ29kZUF0KGEgKyAxKSwgKG4gJiA2NDUxMikgPT09IDU2MzIwICYmICh0ID0gNjU1MzYgKyAodCAtIDU1Mjk2IDw8IDEwKSArIChuIC0gNTYzMjApLCBhKyspKSwgZiArPSB0IDwgMTI4ID8gMSA6IHQgPCAyMDQ4ID8gMiA6IHQgPCA2NTUzNiA/IDMgOiA0OwogICAgZm9yKGkgPSBuZXcgVWludDhBcnJheShmKSwgbCA9IDAsIGEgPSAwOyBsIDwgZjsgYSsrKXQgPSBlLmNoYXJDb2RlQXQoYSksICh0ICYgNjQ1MTIpID09PSA1NTI5NiAmJiBhICsgMSA8IG8gJiYgKG4gPSBlLmNoYXJDb2RlQXQoYSArIDEpLCAobiAmIDY0NTEyKSA9PT0gNTYzMjAgJiYgKHQgPSA2NTUzNiArICh0IC0gNTUyOTYgPDwgMTApICsgKG4gLSA1NjMyMCksIGErKykpLCB0IDwgMTI4ID8gaVtsKytdID0gdCA6IHQgPCAyMDQ4ID8gKGlbbCsrXSA9IDE5MiB8IHQgPj4+IDYsIGlbbCsrXSA9IDEyOCB8IHQgJiA2MykgOiB0IDwgNjU1MzYgPyAoaVtsKytdID0gMjI0IHwgdCA+Pj4gMTIsIGlbbCsrXSA9IDEyOCB8IHQgPj4+IDYgJiA2MywgaVtsKytdID0gMTI4IHwgdCAmIDYzKSA6IChpW2wrK10gPSAyNDAgfCB0ID4+PiAxOCwgaVtsKytdID0gMTI4IHwgdCA+Pj4gMTIgJiA2MywgaVtsKytdID0gMTI4IHwgdCA+Pj4gNiAmIDYzLCBpW2wrK10gPSAxMjggfCB0ICYgNjMpOwogICAgcmV0dXJuIGk7Cn0sIGRuID0gKGUsIGkpPT57CiAgICBpZiAoaSA8IDY1NTM0ICYmIGUuc3ViYXJyYXkgJiYgU2kpIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGUubGVuZ3RoID09PSBpID8gZSA6IGUuc3ViYXJyYXkoMCwgaSkpOwogICAgbGV0IHQgPSAiIjsKICAgIGZvcihsZXQgbiA9IDA7IG4gPCBpOyBuKyspdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGVbbl0pOwogICAgcmV0dXJuIHQ7Cn0sIHNuID0gKGUsIGkpPT57CiAgICBsZXQgdCA9IGkgfHwgZS5sZW5ndGg7CiAgICBpZiAodHlwZW9mIFRleHREZWNvZGVyID09ICJmdW5jdGlvbiIgJiYgVGV4dERlY29kZXIucHJvdG90eXBlLmRlY29kZSkgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShlLnN1YmFycmF5KDAsIGkpKTsKICAgIGxldCBuLCBhLCBsID0gbmV3IEFycmF5KHQgKiAyKTsKICAgIGZvcihhID0gMCwgbiA9IDA7IG4gPCB0Oyl7CiAgICAgICAgbGV0IG8gPSBlW24rK107CiAgICAgICAgaWYgKG8gPCAxMjgpIHsKICAgICAgICAgICAgbFthKytdID0gbzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxldCBmID0gRWUxW29dOwogICAgICAgIGlmIChmID4gNCkgewogICAgICAgICAgICBsW2ErK10gPSA2NTUzMywgbiArPSBmIC0gMTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvcihvICY9IGYgPT09IDIgPyAzMSA6IGYgPT09IDMgPyAxNSA6IDc7IGYgPiAxICYmIG4gPCB0OylvID0gbyA8PCA2IHwgZVtuKytdICYgNjMsIGYtLTsKICAgICAgICBpZiAoZiA+IDEpIHsKICAgICAgICAgICAgbFthKytdID0gNjU1MzM7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBvIDwgNjU1MzYgPyBsW2ErK10gPSBvIDogKG8gLT0gNjU1MzYsIGxbYSsrXSA9IDU1Mjk2IHwgbyA+PiAxMCAmIDEwMjMsIGxbYSsrXSA9IDU2MzIwIHwgbyAmIDEwMjMpOwogICAgfQogICAgcmV0dXJuIGRuKGwsIGEpOwp9LCBjbiA9IChlLCBpKT0+ewogICAgaSA9IGkgfHwgZS5sZW5ndGgsIGkgPiBlLmxlbmd0aCAmJiAoaSA9IGUubGVuZ3RoKTsKICAgIGxldCB0ID0gaSAtIDE7CiAgICBmb3IoOyB0ID49IDAgJiYgKGVbdF0gJiAxOTIpID09PSAxMjg7KXQtLTsKICAgIHJldHVybiB0IDwgMCB8fCB0ID09PSAwID8gaSA6IHQgKyBFZTFbZVt0XV0gPiBpID8gdCA6IGk7Cn0sIHllMSA9IHsKICAgIHN0cmluZzJidWY6IGhuLAogICAgYnVmMnN0cmluZzogc24sCiAgICB1dGY4Ym9yZGVyOiBjbgp9OwpmdW5jdGlvbiB1bigpIHsKICAgIHRoaXMuaW5wdXQgPSBudWxsLCB0aGlzLm5leHRfaW4gPSAwLCB0aGlzLmF2YWlsX2luID0gMCwgdGhpcy50b3RhbF9pbiA9IDAsIHRoaXMub3V0cHV0ID0gbnVsbCwgdGhpcy5uZXh0X291dCA9IDAsIHRoaXMuYXZhaWxfb3V0ID0gMCwgdGhpcy50b3RhbF9vdXQgPSAwLCB0aGlzLm1zZyA9ICIiLCB0aGlzLnN0YXRlID0gbnVsbCwgdGhpcy5kYXRhX3R5cGUgPSAyLCB0aGlzLmFkbGVyID0gMDsKfQp2YXIgQWkgPSB1biwgUmkgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLCB7IFpfTk9fRkxVU0g6IGJuICwgWl9TWU5DX0ZMVVNIOiB3biAsIFpfRlVMTF9GTFVTSDogZ24gLCBaX0ZJTklTSDogcG4gLCBaX09LOiBCZSAsIFpfU1RSRUFNX0VORDogeG4gLCBaX0RFRkFVTFRfQ09NUFJFU1NJT046IGtuICwgWl9ERUZBVUxUX1NUUkFURUdZOiB2biAsIFpfREVGTEFURUQ6IEVuICB9ID0gbmUxOwpmdW5jdGlvbiB6ZShlKSB7CiAgICB0aGlzLm9wdGlvbnMgPSBZZS5hc3NpZ24oewogICAgICAgIGxldmVsOiBrbiwKICAgICAgICBtZXRob2Q6IEVuLAogICAgICAgIGNodW5rU2l6ZTogMTYzODQsCiAgICAgICAgd2luZG93Qml0czogMTUsCiAgICAgICAgbWVtTGV2ZWw6IDgsCiAgICAgICAgc3RyYXRlZ3k6IHZuCiAgICB9LCBlIHx8IHt9KTsKICAgIGxldCBpID0gdGhpcy5vcHRpb25zOwogICAgaS5yYXcgJiYgaS53aW5kb3dCaXRzID4gMCA/IGkud2luZG93Qml0cyA9IC1pLndpbmRvd0JpdHMgOiBpLmd6aXAgJiYgaS53aW5kb3dCaXRzID4gMCAmJiBpLndpbmRvd0JpdHMgPCAxNiAmJiAoaS53aW5kb3dCaXRzICs9IDE2KSwgdGhpcy5lcnIgPSAwLCB0aGlzLm1zZyA9ICIiLCB0aGlzLmVuZGVkID0gITEsIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuc3RybSA9IG5ldyBBaSwgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CiAgICBsZXQgdCA9IGJlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sIGkubGV2ZWwsIGkubWV0aG9kLCBpLndpbmRvd0JpdHMsIGkubWVtTGV2ZWwsIGkuc3RyYXRlZ3kpOwogICAgaWYgKHQgIT09IEJlKSB0aHJvdyBuZXcgRXJyb3IoZWUxW3RdKTsKICAgIGlmIChpLmhlYWRlciAmJiBiZS5kZWZsYXRlU2V0SGVhZGVyKHRoaXMuc3RybSwgaS5oZWFkZXIpLCBpLmRpY3Rpb25hcnkpIHsKICAgICAgICBsZXQgbjsKICAgICAgICBpZiAodHlwZW9mIGkuZGljdGlvbmFyeSA9PSAic3RyaW5nIiA/IG4gPSB5ZTEuc3RyaW5nMmJ1ZihpLmRpY3Rpb25hcnkpIDogUmkuY2FsbChpLmRpY3Rpb25hcnkpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID8gbiA9IG5ldyBVaW50OEFycmF5KGkuZGljdGlvbmFyeSkgOiBuID0gaS5kaWN0aW9uYXJ5LCB0ID0gYmUuZGVmbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBuKSwgdCAhPT0gQmUpIHRocm93IG5ldyBFcnJvcihlZTFbdF0pOwogICAgICAgIHRoaXMuX2RpY3Rfc2V0ID0gITA7CiAgICB9Cn0KemUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihlLCBpKSB7CiAgICBsZXQgdCA9IHRoaXMuc3RybSwgbiA9IHRoaXMub3B0aW9ucy5jaHVua1NpemUsIGEsIGw7CiAgICBpZiAodGhpcy5lbmRlZCkgcmV0dXJuICExOwogICAgZm9yKGkgPT09IH5+aSA/IGwgPSBpIDogbCA9IGkgPT09ICEwID8gcG4gOiBibiwgdHlwZW9mIGUgPT0gInN0cmluZyIgPyB0LmlucHV0ID0geWUxLnN0cmluZzJidWYoZSkgOiBSaS5jYWxsKGUpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID8gdC5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGUpIDogdC5pbnB1dCA9IGUsIHQubmV4dF9pbiA9IDAsIHQuYXZhaWxfaW4gPSB0LmlucHV0Lmxlbmd0aDs7KXsKICAgICAgICBpZiAodC5hdmFpbF9vdXQgPT09IDAgJiYgKHQub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobiksIHQubmV4dF9vdXQgPSAwLCB0LmF2YWlsX291dCA9IG4pLCAobCA9PT0gd24gfHwgbCA9PT0gZ24pICYmIHQuYXZhaWxfb3V0IDw9IDYpIHsKICAgICAgICAgICAgdGhpcy5vbkRhdGEodC5vdXRwdXQuc3ViYXJyYXkoMCwgdC5uZXh0X291dCkpLCB0LmF2YWlsX291dCA9IDA7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYSA9IGJlLmRlZmxhdGUodCwgbCksIGEgPT09IHhuKSByZXR1cm4gdC5uZXh0X291dCA+IDAgJiYgdGhpcy5vbkRhdGEodC5vdXRwdXQuc3ViYXJyYXkoMCwgdC5uZXh0X291dCkpLCBhID0gYmUuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLCB0aGlzLm9uRW5kKGEpLCB0aGlzLmVuZGVkID0gITAsIGEgPT09IEJlOwogICAgICAgIGlmICh0LmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICB0aGlzLm9uRGF0YSh0Lm91dHB1dCk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAobCA+IDAgJiYgdC5uZXh0X291dCA+IDApIHsKICAgICAgICAgICAgdGhpcy5vbkRhdGEodC5vdXRwdXQuc3ViYXJyYXkoMCwgdC5uZXh0X291dCkpLCB0LmF2YWlsX291dCA9IDA7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAodC5hdmFpbF9pbiA9PT0gMCkgYnJlYWs7CiAgICB9CiAgICByZXR1cm4gITA7Cn07CnplLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbihlKSB7CiAgICB0aGlzLmNodW5rcy5wdXNoKGUpOwp9Owp6ZS5wcm90b3R5cGUub25FbmQgPSBmdW5jdGlvbihlKSB7CiAgICBlID09PSBCZSAmJiAodGhpcy5yZXN1bHQgPSBZZS5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKSksIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuZXJyID0gZSwgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwp9OwpmdW5jdGlvbiBidChlLCBpKSB7CiAgICBsZXQgdCA9IG5ldyB6ZShpKTsKICAgIGlmICh0LnB1c2goZSwgITApLCB0LmVycikgdGhyb3cgdC5tc2cgfHwgZWUxW3QuZXJyXTsKICAgIHJldHVybiB0LnJlc3VsdDsKfQpmdW5jdGlvbiB5bihlLCBpKSB7CiAgICByZXR1cm4gaSA9IGkgfHwge30sIGkucmF3ID0gITAsIGJ0KGUsIGkpOwp9CmZ1bmN0aW9uIFNuKGUsIGkpIHsKICAgIHJldHVybiBpID0gaSB8fCB7fSwgaS5nemlwID0gITAsIGJ0KGUsIGkpOwp9CnZhciBBbiA9IHplLCBSbiA9IGJ0LCB6biA9IHluLCBUbiA9IFNuLCBtbiA9IG5lMSwgRG4gPSB7CiAgICBEZWZsYXRlOiBBbiwKICAgIGRlZmxhdGU6IFJuLAogICAgZGVmbGF0ZVJhdzogem4sCiAgICBnemlwOiBUbiwKICAgIGNvbnN0YW50czogbW4KfSwgT2UgPSAzMCwgWm4gPSAxMiwgSW4gPSBmdW5jdGlvbihpLCB0KSB7CiAgICBsZXQgbiwgYSwgbCwgbywgZiwgYywgciwgXywgRSwgcywgaCwgdSwgbSwgdiwgdywgQSwgeCwgZCwgUywgWiwgYiwgeiwgUiwgZywgcCA9IGkuc3RhdGU7CiAgICBuID0gaS5uZXh0X2luLCBSID0gaS5pbnB1dCwgYSA9IG4gKyAoaS5hdmFpbF9pbiAtIDUpLCBsID0gaS5uZXh0X291dCwgZyA9IGkub3V0cHV0LCBvID0gbCAtICh0IC0gaS5hdmFpbF9vdXQpLCBmID0gbCArIChpLmF2YWlsX291dCAtIDI1NyksIGMgPSBwLmRtYXgsIHIgPSBwLndzaXplLCBfID0gcC53aGF2ZSwgRSA9IHAud25leHQsIHMgPSBwLndpbmRvdywgaCA9IHAuaG9sZCwgdSA9IHAuYml0cywgbSA9IHAubGVuY29kZSwgdiA9IHAuZGlzdGNvZGUsIHcgPSAoMSA8PCBwLmxlbmJpdHMpIC0gMSwgQSA9ICgxIDw8IHAuZGlzdGJpdHMpIC0gMTsKICAgIGU6IGRvIHsKICAgICAgICB1IDwgMTUgJiYgKGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCwgaCArPSBSW24rK10gPDwgdSwgdSArPSA4KSwgeCA9IG1baCAmIHddOwogICAgICAgIHQ6IGZvcig7Oyl7CiAgICAgICAgICAgIGlmIChkID0geCA+Pj4gMjQsIGggPj4+PSBkLCB1IC09IGQsIGQgPSB4ID4+PiAxNiAmIDI1NSwgZCA9PT0gMCkgZ1tsKytdID0geCAmIDY1NTM1OwogICAgICAgICAgICBlbHNlIGlmIChkICYgMTYpIHsKICAgICAgICAgICAgICAgIFMgPSB4ICYgNjU1MzUsIGQgJj0gMTUsIGQgJiYgKHUgPCBkICYmIChoICs9IFJbbisrXSA8PCB1LCB1ICs9IDgpLCBTICs9IGggJiAoMSA8PCBkKSAtIDEsIGggPj4+PSBkLCB1IC09IGQpLCB1IDwgMTUgJiYgKGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCwgaCArPSBSW24rK10gPDwgdSwgdSArPSA4KSwgeCA9IHZbaCAmIEFdOwogICAgICAgICAgICAgICAgaTogZm9yKDs7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IHggPj4+IDI0LCBoID4+Pj0gZCwgdSAtPSBkLCBkID0geCA+Pj4gMTYgJiAyNTUsIGQgJiAxNikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoWiA9IHggJiA2NTUzNSwgZCAmPSAxNSwgdSA8IGQgJiYgKGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCwgdSA8IGQgJiYgKGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCkpLCBaICs9IGggJiAoMSA8PCBkKSAtIDEsIFogPiBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsIHAubW9kZSA9IE9lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaCA+Pj49IGQsIHUgLT0gZCwgZCA9IGwgLSBvLCBaID4gZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSBaIC0gZCwgZCA+IF8gJiYgcC5zYW5lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLCBwLm1vZGUgPSBPZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgPSAwLCB6ID0gcywgRSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiICs9IHIgLSBkLCBkIDwgUykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTIC09IGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIGdbbCsrXSA9IHNbYisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKC0tZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGwgLSBaLCB6ID0gZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEUgPCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgKz0gciArIEUgLSBkLCBkIC09IEUsIGQgPCBTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgLT0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gZ1tsKytdID0gc1tiKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoLS1kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IDAsIEUgPCBTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gRSwgUyAtPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gZ1tsKytdID0gc1tiKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKC0tZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBsIC0gWiwgeiA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGIgKz0gRSAtIGQsIGQgPCBTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUyAtPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIGdbbCsrXSA9IHNbYisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoLS1kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBsIC0gWiwgeiA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoOyBTID4gMjspZ1tsKytdID0geltiKytdLCBnW2wrK10gPSB6W2IrK10sIGdbbCsrXSA9IHpbYisrXSwgUyAtPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUyAmJiAoZ1tsKytdID0geltiKytdLCBTID4gMSAmJiAoZ1tsKytdID0geltiKytdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gbCAtIFo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyBnW2wrK10gPSBnW2IrK10sIGdbbCsrXSA9IGdbYisrXSwgZ1tsKytdID0gZ1tiKytdLCBTIC09IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoUyA+IDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTICYmIChnW2wrK10gPSBnW2IrK10sIFMgPiAxICYmIChnW2wrK10gPSBnW2IrK10pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKGQgJiA2NCkgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgeCA9IHZbKHggJiA2NTUzNSkgKyAoaCAmICgxIDw8IGQpIC0gMSldOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGkubXNnID0gImludmFsaWQgZGlzdGFuY2UgY29kZSIsIHAubW9kZSA9IE9lOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICgoZCAmIDY0KSA9PT0gMCkgewogICAgICAgICAgICAgICAgeCA9IG1bKHggJiA2NTUzNSkgKyAoaCAmICgxIDw8IGQpIC0gMSldOwogICAgICAgICAgICAgICAgY29udGludWUgdDsKICAgICAgICAgICAgfSBlbHNlIGlmIChkICYgMzIpIHsKICAgICAgICAgICAgICAgIHAubW9kZSA9IFpuOwogICAgICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGkubXNnID0gImludmFsaWQgbGl0ZXJhbC9sZW5ndGggY29kZSIsIHAubW9kZSA9IE9lOwogICAgICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9d2hpbGUgKG4gPCBhICYmIGwgPCBmKQogICAgUyA9IHUgPj4gMywgbiAtPSBTLCB1IC09IFMgPDwgMywgaCAmPSAoMSA8PCB1KSAtIDEsIGkubmV4dF9pbiA9IG4sIGkubmV4dF9vdXQgPSBsLCBpLmF2YWlsX2luID0gbiA8IGEgPyA1ICsgKGEgLSBuKSA6IDUgLSAobiAtIGEpLCBpLmF2YWlsX291dCA9IGwgPCBmID8gMjU3ICsgKGYgLSBsKSA6IDI1NyAtIChsIC0gZiksIHAuaG9sZCA9IGgsIHAuYml0cyA9IHU7Cn0sIGZlMSA9IDE1LCBtdCA9IDg1MiwgRHQgPSA1OTIsIFp0ID0gMCwgcWUgPSAxLCBJdCA9IDIsIE9uID0gbmV3IFVpbnQxNkFycmF5KFsKICAgIDMsCiAgICA0LAogICAgNSwKICAgIDYsCiAgICA3LAogICAgOCwKICAgIDksCiAgICAxMCwKICAgIDExLAogICAgMTMsCiAgICAxNSwKICAgIDE3LAogICAgMTksCiAgICAyMywKICAgIDI3LAogICAgMzEsCiAgICAzNSwKICAgIDQzLAogICAgNTEsCiAgICA1OSwKICAgIDY3LAogICAgODMsCiAgICA5OSwKICAgIDExNSwKICAgIDEzMSwKICAgIDE2MywKICAgIDE5NSwKICAgIDIyNywKICAgIDI1OCwKICAgIDAsCiAgICAwCl0pLCBObiA9IG5ldyBVaW50OEFycmF5KFsKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNywKICAgIDE3LAogICAgMTcsCiAgICAxNywKICAgIDE4LAogICAgMTgsCiAgICAxOCwKICAgIDE4LAogICAgMTksCiAgICAxOSwKICAgIDE5LAogICAgMTksCiAgICAyMCwKICAgIDIwLAogICAgMjAsCiAgICAyMCwKICAgIDIxLAogICAgMjEsCiAgICAyMSwKICAgIDIxLAogICAgMTYsCiAgICA3MiwKICAgIDc4Cl0pLCBMbiA9IG5ldyBVaW50MTZBcnJheShbCiAgICAxLAogICAgMiwKICAgIDMsCiAgICA0LAogICAgNSwKICAgIDcsCiAgICA5LAogICAgMTMsCiAgICAxNywKICAgIDI1LAogICAgMzMsCiAgICA0OSwKICAgIDY1LAogICAgOTcsCiAgICAxMjksCiAgICAxOTMsCiAgICAyNTcsCiAgICAzODUsCiAgICA1MTMsCiAgICA3NjksCiAgICAxMDI1LAogICAgMTUzNywKICAgIDIwNDksCiAgICAzMDczLAogICAgNDA5NywKICAgIDYxNDUsCiAgICA4MTkzLAogICAgMTIyODksCiAgICAxNjM4NSwKICAgIDI0NTc3LAogICAgMCwKICAgIDAKXSksIFVuID0gbmV3IFVpbnQ4QXJyYXkoWwogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNywKICAgIDE3LAogICAgMTgsCiAgICAxOCwKICAgIDE5LAogICAgMTksCiAgICAyMCwKICAgIDIwLAogICAgMjEsCiAgICAyMSwKICAgIDIyLAogICAgMjIsCiAgICAyMywKICAgIDIzLAogICAgMjQsCiAgICAyNCwKICAgIDI1LAogICAgMjUsCiAgICAyNiwKICAgIDI2LAogICAgMjcsCiAgICAyNywKICAgIDI4LAogICAgMjgsCiAgICAyOSwKICAgIDI5LAogICAgNjQsCiAgICA2NApdKSwgQ24gPSAoZSwgaSwgdCwgbiwgYSwgbCwgbywgZik9PnsKICAgIGxldCBjID0gZi5iaXRzLCByID0gMCwgXyA9IDAsIEUgPSAwLCBzID0gMCwgaCA9IDAsIHUgPSAwLCBtID0gMCwgdiA9IDAsIHcgPSAwLCBBID0gMCwgeCwgZCwgUywgWiwgYiwgeiA9IG51bGwsIFIgPSAwLCBnLCBwID0gbmV3IFVpbnQxNkFycmF5KGZlMSArIDEpLCBKID0gbmV3IFVpbnQxNkFycmF5KGZlMSArIDEpLCBtZSA9IG51bGwsIGd0ID0gMCwgcHQsIERlLCBaZTsKICAgIGZvcihyID0gMDsgciA8PSBmZTE7IHIrKylwW3JdID0gMDsKICAgIGZvcihfID0gMDsgXyA8IG47IF8rKylwW2lbdCArIF9dXSsrOwogICAgZm9yKGggPSBjLCBzID0gZmUxOyBzID49IDEgJiYgcFtzXSA9PT0gMDsgcy0tKTsKICAgIGlmIChoID4gcyAmJiAoaCA9IHMpLCBzID09PSAwKSByZXR1cm4gYVtsKytdID0gMSA8PCAyNCB8IDY0IDw8IDE2IHwgMCwgYVtsKytdID0gMSA8PCAyNCB8IDY0IDw8IDE2IHwgMCwgZi5iaXRzID0gMSwgMDsKICAgIGZvcihFID0gMTsgRSA8IHMgJiYgcFtFXSA9PT0gMDsgRSsrKTsKICAgIGZvcihoIDwgRSAmJiAoaCA9IEUpLCB2ID0gMSwgciA9IDE7IHIgPD0gZmUxOyByKyspaWYgKHYgPDw9IDEsIHYgLT0gcFtyXSwgdiA8IDApIHJldHVybiAtMTsKICAgIGlmICh2ID4gMCAmJiAoZSA9PT0gWnQgfHwgcyAhPT0gMSkpIHJldHVybiAtMTsKICAgIGZvcihKWzFdID0gMCwgciA9IDE7IHIgPCBmZTE7IHIrKylKW3IgKyAxXSA9IEpbcl0gKyBwW3JdOwogICAgZm9yKF8gPSAwOyBfIDwgbjsgXysrKWlbdCArIF9dICE9PSAwICYmIChvW0pbaVt0ICsgX11dKytdID0gXyk7CiAgICBpZiAoZSA9PT0gWnQgPyAoeiA9IG1lID0gbywgZyA9IDE5KSA6IGUgPT09IHFlID8gKHogPSBPbiwgUiAtPSAyNTcsIG1lID0gTm4sIGd0IC09IDI1NywgZyA9IDI1NikgOiAoeiA9IExuLCBtZSA9IFVuLCBnID0gLTEpLCBBID0gMCwgXyA9IDAsIHIgPSBFLCBiID0gbCwgdSA9IGgsIG0gPSAwLCBTID0gLTEsIHcgPSAxIDw8IGgsIFogPSB3IC0gMSwgZSA9PT0gcWUgJiYgdyA+IG10IHx8IGUgPT09IEl0ICYmIHcgPiBEdCkgcmV0dXJuIDE7CiAgICBmb3IoOzspewogICAgICAgIHB0ID0gciAtIG0sIG9bX10gPCBnID8gKERlID0gMCwgWmUgPSBvW19dKSA6IG9bX10gPiBnID8gKERlID0gbWVbZ3QgKyBvW19dXSwgWmUgPSB6W1IgKyBvW19dXSkgOiAoRGUgPSAzMiArIDY0LCBaZSA9IDApLCB4ID0gMSA8PCByIC0gbSwgZCA9IDEgPDwgdSwgRSA9IGQ7CiAgICAgICAgZG8gZCAtPSB4LCBhW2IgKyAoQSA+PiBtKSArIGRdID0gcHQgPDwgMjQgfCBEZSA8PCAxNiB8IFplIHwgMDsKICAgICAgICB3aGlsZSAoZCAhPT0gMCkKICAgICAgICBmb3IoeCA9IDEgPDwgciAtIDE7IEEgJiB4Oyl4ID4+PSAxOwogICAgICAgIGlmICh4ICE9PSAwID8gKEEgJj0geCAtIDEsIEEgKz0geCkgOiBBID0gMCwgXysrLCAtLXBbcl0gPT09IDApIHsKICAgICAgICAgICAgaWYgKHIgPT09IHMpIGJyZWFrOwogICAgICAgICAgICByID0gaVt0ICsgb1tfXV07CiAgICAgICAgfQogICAgICAgIGlmIChyID4gaCAmJiAoQSAmIFopICE9PSBTKSB7CiAgICAgICAgICAgIGZvcihtID09PSAwICYmIChtID0gaCksIGIgKz0gRSwgdSA9IHIgLSBtLCB2ID0gMSA8PCB1OyB1ICsgbSA8IHMgJiYgKHYgLT0gcFt1ICsgbV0sICEodiA8PSAwKSk7KXUrKywgdiA8PD0gMTsKICAgICAgICAgICAgaWYgKHcgKz0gMSA8PCB1LCBlID09PSBxZSAmJiB3ID4gbXQgfHwgZSA9PT0gSXQgJiYgdyA+IER0KSByZXR1cm4gMTsKICAgICAgICAgICAgUyA9IEEgJiBaLCBhW1NdID0gaCA8PCAyNCB8IHUgPDwgMTYgfCBiIC0gbCB8IDA7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIEEgIT09IDAgJiYgKGFbYiArIEFdID0gciAtIG0gPDwgMjQgfCA2NCA8PCAxNiB8IDApLCBmLmJpdHMgPSBoLCAwOwp9LCB3ZTEgPSBDbiwgJG4gPSAwLCB6aSA9IDEsIFRpID0gMiwgeyBaX0ZJTklTSDogT3QgLCBaX0JMT0NLOiBNbiAsIFpfVFJFRVM6IE5lICwgWl9PSzogYWUxICwgWl9TVFJFQU1fRU5EOiBGbiAsIFpfTkVFRF9ESUNUOiBIbiAsIFpfU1RSRUFNX0VSUk9SOiBVMSAsIFpfREFUQV9FUlJPUjogbWkgLCBaX01FTV9FUlJPUjogRGkgLCBaX0JVRl9FUlJPUjogQm4gLCBaX0RFRkxBVEVEOiBOdCAgfSA9IG5lMSwgWmkgPSAxLCBMdCA9IDIsIFV0ID0gMywgQ3QgPSA0LCAkdCA9IDUsIE10ID0gNiwgRnQgPSA3LCBIdCA9IDgsIEJ0ID0gOSwgS3QgPSAxMCwgS2UgPSAxMSwgSDEgPSAxMiwgZXQgPSAxMywgUHQgPSAxNCwgdHQgPSAxNSwgWHQgPSAxNiwgWXQgPSAxNywgR3QgPSAxOCwganQgPSAxOSwgTGUgPSAyMCwgVWUxID0gMjEsIFd0ID0gMjIsIFZ0ID0gMjMsIEp0ID0gMjQsIFF0ID0gMjUsIHF0ID0gMjYsIGl0ID0gMjcsIGVpID0gMjgsIHRpID0gMjksIFQyID0gMzAsIElpID0gMzEsIEtuID0gMzIsIFBuID0gODUyLCBYbiA9IDU5MiwgWW4gPSAxNSwgR24gPSBZbiwgaWkgPSAoZSk9PihlID4+PiAyNCAmIDI1NSkgKyAoZSA+Pj4gOCAmIDY1MjgwKSArICgoZSAmIDY1MjgwKSA8PCA4KSArICgoZSAmIDI1NSkgPDwgMjQpOwpmdW5jdGlvbiBqbigpIHsKICAgIHRoaXMubW9kZSA9IDAsIHRoaXMubGFzdCA9ICExLCB0aGlzLndyYXAgPSAwLCB0aGlzLmhhdmVkaWN0ID0gITEsIHRoaXMuZmxhZ3MgPSAwLCB0aGlzLmRtYXggPSAwLCB0aGlzLmNoZWNrID0gMCwgdGhpcy50b3RhbCA9IDAsIHRoaXMuaGVhZCA9IG51bGwsIHRoaXMud2JpdHMgPSAwLCB0aGlzLndzaXplID0gMCwgdGhpcy53aGF2ZSA9IDAsIHRoaXMud25leHQgPSAwLCB0aGlzLndpbmRvdyA9IG51bGwsIHRoaXMuaG9sZCA9IDAsIHRoaXMuYml0cyA9IDAsIHRoaXMubGVuZ3RoID0gMCwgdGhpcy5vZmZzZXQgPSAwLCB0aGlzLmV4dHJhID0gMCwgdGhpcy5sZW5jb2RlID0gbnVsbCwgdGhpcy5kaXN0Y29kZSA9IG51bGwsIHRoaXMubGVuYml0cyA9IDAsIHRoaXMuZGlzdGJpdHMgPSAwLCB0aGlzLm5jb2RlID0gMCwgdGhpcy5ubGVuID0gMCwgdGhpcy5uZGlzdCA9IDAsIHRoaXMuaGF2ZSA9IDAsIHRoaXMubmV4dCA9IG51bGwsIHRoaXMubGVucyA9IG5ldyBVaW50MTZBcnJheSgzMjApLCB0aGlzLndvcmsgPSBuZXcgVWludDE2QXJyYXkoMjg4KSwgdGhpcy5sZW5keW4gPSBudWxsLCB0aGlzLmRpc3RkeW4gPSBudWxsLCB0aGlzLnNhbmUgPSAwLCB0aGlzLmJhY2sgPSAwLCB0aGlzLndhcyA9IDA7Cn0KdmFyIE9pID0gKGUpPT57CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBVMTsKICAgIGxldCBpID0gZS5zdGF0ZTsKICAgIHJldHVybiBlLnRvdGFsX2luID0gZS50b3RhbF9vdXQgPSBpLnRvdGFsID0gMCwgZS5tc2cgPSAiIiwgaS53cmFwICYmIChlLmFkbGVyID0gaS53cmFwICYgMSksIGkubW9kZSA9IFppLCBpLmxhc3QgPSAwLCBpLmhhdmVkaWN0ID0gMCwgaS5kbWF4ID0gMzI3NjgsIGkuaGVhZCA9IG51bGwsIGkuaG9sZCA9IDAsIGkuYml0cyA9IDAsIGkubGVuY29kZSA9IGkubGVuZHluID0gbmV3IEludDMyQXJyYXkoUG4pLCBpLmRpc3Rjb2RlID0gaS5kaXN0ZHluID0gbmV3IEludDMyQXJyYXkoWG4pLCBpLnNhbmUgPSAxLCBpLmJhY2sgPSAtMSwgYWUxOwp9LCBOaSA9IChlKT0+ewogICAgaWYgKCFlIHx8ICFlLnN0YXRlKSByZXR1cm4gVTE7CiAgICBsZXQgaSA9IGUuc3RhdGU7CiAgICByZXR1cm4gaS53c2l6ZSA9IDAsIGkud2hhdmUgPSAwLCBpLnduZXh0ID0gMCwgT2koZSk7Cn0sIExpID0gKGUsIGkpPT57CiAgICBsZXQgdDsKICAgIGlmICghZSB8fCAhZS5zdGF0ZSkgcmV0dXJuIFUxOwogICAgbGV0IG4gPSBlLnN0YXRlOwogICAgcmV0dXJuIGkgPCAwID8gKHQgPSAwLCBpID0gLWkpIDogKHQgPSAoaSA+PiA0KSArIDEsIGkgPCA0OCAmJiAoaSAmPSAxNSkpLCBpICYmIChpIDwgOCB8fCBpID4gMTUpID8gVTEgOiAobi53aW5kb3cgIT09IG51bGwgJiYgbi53Yml0cyAhPT0gaSAmJiAobi53aW5kb3cgPSBudWxsKSwgbi53cmFwID0gdCwgbi53Yml0cyA9IGksIE5pKGUpKTsKfSwgVWkgPSAoZSwgaSk9PnsKICAgIGlmICghZSkgcmV0dXJuIFUxOwogICAgbGV0IHQgPSBuZXcgam47CiAgICBlLnN0YXRlID0gdCwgdC53aW5kb3cgPSBudWxsOwogICAgbGV0IG4gPSBMaShlLCBpKTsKICAgIHJldHVybiBuICE9PSBhZTEgJiYgKGUuc3RhdGUgPSBudWxsKSwgbjsKfSwgV24gPSAoZSk9PlVpKGUsIEduKSwgYWkgPSAhMCwgYXQsIG50LCBWbiA9IChlKT0+ewogICAgaWYgKGFpKSB7CiAgICAgICAgYXQgPSBuZXcgSW50MzJBcnJheSg1MTIpLCBudCA9IG5ldyBJbnQzMkFycmF5KDMyKTsKICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgZm9yKDsgaSA8IDE0NDspZS5sZW5zW2krK10gPSA4OwogICAgICAgIGZvcig7IGkgPCAyNTY7KWUubGVuc1tpKytdID0gOTsKICAgICAgICBmb3IoOyBpIDwgMjgwOyllLmxlbnNbaSsrXSA9IDc7CiAgICAgICAgZm9yKDsgaSA8IDI4ODspZS5sZW5zW2krK10gPSA4OwogICAgICAgIGZvcih3ZTEoemksIGUubGVucywgMCwgMjg4LCBhdCwgMCwgZS53b3JrLCB7CiAgICAgICAgICAgIGJpdHM6IDkKICAgICAgICB9KSwgaSA9IDA7IGkgPCAzMjspZS5sZW5zW2krK10gPSA1OwogICAgICAgIHdlMShUaSwgZS5sZW5zLCAwLCAzMiwgbnQsIDAsIGUud29yaywgewogICAgICAgICAgICBiaXRzOiA1CiAgICAgICAgfSksIGFpID0gITE7CiAgICB9CiAgICBlLmxlbmNvZGUgPSBhdCwgZS5sZW5iaXRzID0gOSwgZS5kaXN0Y29kZSA9IG50LCBlLmRpc3RiaXRzID0gNTsKfSwgQ2kgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhLCBsID0gZS5zdGF0ZTsKICAgIHJldHVybiBsLndpbmRvdyA9PT0gbnVsbCAmJiAobC53c2l6ZSA9IDEgPDwgbC53Yml0cywgbC53bmV4dCA9IDAsIGwud2hhdmUgPSAwLCBsLndpbmRvdyA9IG5ldyBVaW50OEFycmF5KGwud3NpemUpKSwgbiA+PSBsLndzaXplID8gKGwud2luZG93LnNldChpLnN1YmFycmF5KHQgLSBsLndzaXplLCB0KSwgMCksIGwud25leHQgPSAwLCBsLndoYXZlID0gbC53c2l6ZSkgOiAoYSA9IGwud3NpemUgLSBsLnduZXh0LCBhID4gbiAmJiAoYSA9IG4pLCBsLndpbmRvdy5zZXQoaS5zdWJhcnJheSh0IC0gbiwgdCAtIG4gKyBhKSwgbC53bmV4dCksIG4gLT0gYSwgbiA/IChsLndpbmRvdy5zZXQoaS5zdWJhcnJheSh0IC0gbiwgdCksIDApLCBsLnduZXh0ID0gbiwgbC53aGF2ZSA9IGwud3NpemUpIDogKGwud25leHQgKz0gYSwgbC53bmV4dCA9PT0gbC53c2l6ZSAmJiAobC53bmV4dCA9IDApLCBsLndoYXZlIDwgbC53c2l6ZSAmJiAobC53aGF2ZSArPSBhKSkpLCAwOwp9LCBKbiA9IChlLCBpKT0+ewogICAgbGV0IHQsIG4sIGEsIGwsIG8sIGYsIGMsIHIsIF8sIEUsIHMsIGgsIHUsIG0sIHYgPSAwLCB3LCBBLCB4LCBkLCBTLCBaLCBiLCB6LCBSID0gbmV3IFVpbnQ4QXJyYXkoNCksIGcsIHAsIEogPSBuZXcgVWludDhBcnJheShbCiAgICAgICAgMTYsCiAgICAgICAgMTcsCiAgICAgICAgMTgsCiAgICAgICAgMCwKICAgICAgICA4LAogICAgICAgIDcsCiAgICAgICAgOSwKICAgICAgICA2LAogICAgICAgIDEwLAogICAgICAgIDUsCiAgICAgICAgMTEsCiAgICAgICAgNCwKICAgICAgICAxMiwKICAgICAgICAzLAogICAgICAgIDEzLAogICAgICAgIDIsCiAgICAgICAgMTQsCiAgICAgICAgMSwKICAgICAgICAxNQogICAgXSk7CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUgfHwgIWUub3V0cHV0IHx8ICFlLmlucHV0ICYmIGUuYXZhaWxfaW4gIT09IDApIHJldHVybiBVMTsKICAgIHQgPSBlLnN0YXRlLCB0Lm1vZGUgPT09IEgxICYmICh0Lm1vZGUgPSBldCksIG8gPSBlLm5leHRfb3V0LCBhID0gZS5vdXRwdXQsIGMgPSBlLmF2YWlsX291dCwgbCA9IGUubmV4dF9pbiwgbiA9IGUuaW5wdXQsIGYgPSBlLmF2YWlsX2luLCByID0gdC5ob2xkLCBfID0gdC5iaXRzLCBFID0gZiwgcyA9IGMsIHogPSBhZTE7CiAgICBlOiBmb3IoOzspc3dpdGNoKHQubW9kZSl7CiAgICAgICAgY2FzZSBaaToKICAgICAgICAgICAgaWYgKHQud3JhcCA9PT0gMCkgewogICAgICAgICAgICAgICAgdC5tb2RlID0gZXQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IoOyBfIDwgMTY7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQud3JhcCAmIDIgJiYgciA9PT0gMzU2MTUpIHsKICAgICAgICAgICAgICAgIHQuY2hlY2sgPSAwLCBSWzBdID0gciAmIDI1NSwgUlsxXSA9IHIgPj4+IDggJiAyNTUsIHQuY2hlY2sgPSBJMih0LmNoZWNrLCBSLCAyLCAwKSwgciA9IDAsIF8gPSAwLCB0Lm1vZGUgPSBMdDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LmZsYWdzID0gMCwgdC5oZWFkICYmICh0LmhlYWQuZG9uZSA9ICExKSwgISh0LndyYXAgJiAxKSB8fCAoKChyICYgMjU1KSA8PCA4KSArIChyID4+IDgpKSAlIDMxKSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbmNvcnJlY3QgaGVhZGVyIGNoZWNrIiwgdC5tb2RlID0gVDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKHIgJiAxNSkgIT09IE50KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJ1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCIsIHQubW9kZSA9IFQyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHIgPj4+PSA0LCBfIC09IDQsIGIgPSAociAmIDE1KSArIDgsIHQud2JpdHMgPT09IDApIHQud2JpdHMgPSBiOwogICAgICAgICAgICBlbHNlIGlmIChiID4gdC53Yml0cykgewogICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCB3aW5kb3cgc2l6ZSIsIHQubW9kZSA9IFQyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5kbWF4ID0gMSA8PCB0LndiaXRzLCBlLmFkbGVyID0gdC5jaGVjayA9IDEsIHQubW9kZSA9IHIgJiA1MTIgPyBLdCA6IEgxLCByID0gMCwgXyA9IDA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgTHQ6CiAgICAgICAgICAgIGZvcig7IF8gPCAxNjspewogICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5mbGFncyA9IHIsICh0LmZsYWdzICYgMjU1KSAhPT0gTnQpIHsKICAgICAgICAgICAgICAgIGUubXNnID0gInVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIiwgdC5tb2RlID0gVDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5mbGFncyAmIDU3MzQ0KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJ1bmtub3duIGhlYWRlciBmbGFncyBzZXQiLCB0Lm1vZGUgPSBUMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQuaGVhZCAmJiAodC5oZWFkLnRleHQgPSByID4+IDggJiAxKSwgdC5mbGFncyAmIDUxMiAmJiAoUlswXSA9IHIgJiAyNTUsIFJbMV0gPSByID4+PiA4ICYgMjU1LCB0LmNoZWNrID0gSTIodC5jaGVjaywgUiwgMiwgMCkpLCByID0gMCwgXyA9IDAsIHQubW9kZSA9IFV0OwogICAgICAgIGNhc2UgVXQ6CiAgICAgICAgICAgIGZvcig7IF8gPCAzMjspewogICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICB0LmhlYWQgJiYgKHQuaGVhZC50aW1lID0gciksIHQuZmxhZ3MgJiA1MTIgJiYgKFJbMF0gPSByICYgMjU1LCBSWzFdID0gciA+Pj4gOCAmIDI1NSwgUlsyXSA9IHIgPj4+IDE2ICYgMjU1LCBSWzNdID0gciA+Pj4gMjQgJiAyNTUsIHQuY2hlY2sgPSBJMih0LmNoZWNrLCBSLCA0LCAwKSksIHIgPSAwLCBfID0gMCwgdC5tb2RlID0gQ3Q7CiAgICAgICAgY2FzZSBDdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDE2Oyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQuaGVhZCAmJiAodC5oZWFkLnhmbGFncyA9IHIgJiAyNTUsIHQuaGVhZC5vcyA9IHIgPj4gOCksIHQuZmxhZ3MgJiA1MTIgJiYgKFJbMF0gPSByICYgMjU1LCBSWzFdID0gciA+Pj4gOCAmIDI1NSwgdC5jaGVjayA9IEkyKHQuY2hlY2ssIFIsIDIsIDApKSwgciA9IDAsIF8gPSAwLCB0Lm1vZGUgPSAkdDsKICAgICAgICBjYXNlICR0OgogICAgICAgICAgICBpZiAodC5mbGFncyAmIDEwMjQpIHsKICAgICAgICAgICAgICAgIGZvcig7IF8gPCAxNjspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdC5sZW5ndGggPSByLCB0LmhlYWQgJiYgKHQuaGVhZC5leHRyYV9sZW4gPSByKSwgdC5mbGFncyAmIDUxMiAmJiAoUlswXSA9IHIgJiAyNTUsIFJbMV0gPSByID4+PiA4ICYgMjU1LCB0LmNoZWNrID0gSTIodC5jaGVjaywgUiwgMiwgMCkpLCByID0gMCwgXyA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB0LmhlYWQgJiYgKHQuaGVhZC5leHRyYSA9IG51bGwpOwogICAgICAgICAgICB0Lm1vZGUgPSBNdDsKICAgICAgICBjYXNlIE10OgogICAgICAgICAgICBpZiAodC5mbGFncyAmIDEwMjQgJiYgKGggPSB0Lmxlbmd0aCwgaCA+IGYgJiYgKGggPSBmKSwgaCAmJiAodC5oZWFkICYmIChiID0gdC5oZWFkLmV4dHJhX2xlbiAtIHQubGVuZ3RoLCB0LmhlYWQuZXh0cmEgfHwgKHQuaGVhZC5leHRyYSA9IG5ldyBVaW50OEFycmF5KHQuaGVhZC5leHRyYV9sZW4pKSwgdC5oZWFkLmV4dHJhLnNldChuLnN1YmFycmF5KGwsIGwgKyBoKSwgYikpLCB0LmZsYWdzICYgNTEyICYmICh0LmNoZWNrID0gSTIodC5jaGVjaywgbiwgaCwgbCkpLCBmIC09IGgsIGwgKz0gaCwgdC5sZW5ndGggLT0gaCksIHQubGVuZ3RoKSkgYnJlYWsgZTsKICAgICAgICAgICAgdC5sZW5ndGggPSAwLCB0Lm1vZGUgPSBGdDsKICAgICAgICBjYXNlIEZ0OgogICAgICAgICAgICBpZiAodC5mbGFncyAmIDIwNDgpIHsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgaCA9IDA7CiAgICAgICAgICAgICAgICBkbyBiID0gbltsICsgaCsrXSwgdC5oZWFkICYmIGIgJiYgdC5sZW5ndGggPCA2NTUzNiAmJiAodC5oZWFkLm5hbWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShiKSk7CiAgICAgICAgICAgICAgICB3aGlsZSAoYiAmJiBoIDwgZikKICAgICAgICAgICAgICAgIGlmICh0LmZsYWdzICYgNTEyICYmICh0LmNoZWNrID0gSTIodC5jaGVjaywgbiwgaCwgbCkpLCBmIC09IGgsIGwgKz0gaCwgYikgYnJlYWsgZTsKICAgICAgICAgICAgfSBlbHNlIHQuaGVhZCAmJiAodC5oZWFkLm5hbWUgPSBudWxsKTsKICAgICAgICAgICAgdC5sZW5ndGggPSAwLCB0Lm1vZGUgPSBIdDsKICAgICAgICBjYXNlIEh0OgogICAgICAgICAgICBpZiAodC5mbGFncyAmIDQwOTYpIHsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgaCA9IDA7CiAgICAgICAgICAgICAgICBkbyBiID0gbltsICsgaCsrXSwgdC5oZWFkICYmIGIgJiYgdC5sZW5ndGggPCA2NTUzNiAmJiAodC5oZWFkLmNvbW1lbnQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShiKSk7CiAgICAgICAgICAgICAgICB3aGlsZSAoYiAmJiBoIDwgZikKICAgICAgICAgICAgICAgIGlmICh0LmZsYWdzICYgNTEyICYmICh0LmNoZWNrID0gSTIodC5jaGVjaywgbiwgaCwgbCkpLCBmIC09IGgsIGwgKz0gaCwgYikgYnJlYWsgZTsKICAgICAgICAgICAgfSBlbHNlIHQuaGVhZCAmJiAodC5oZWFkLmNvbW1lbnQgPSBudWxsKTsKICAgICAgICAgICAgdC5tb2RlID0gQnQ7CiAgICAgICAgY2FzZSBCdDoKICAgICAgICAgICAgaWYgKHQuZmxhZ3MgJiA1MTIpIHsKICAgICAgICAgICAgICAgIGZvcig7IF8gPCAxNjspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHIgIT09ICh0LmNoZWNrICYgNjU1MzUpKSB7CiAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaGVhZGVyIGNyYyBtaXNtYXRjaCIsIHQubW9kZSA9IFQyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgciA9IDAsIF8gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQuaGVhZCAmJiAodC5oZWFkLmhjcmMgPSB0LmZsYWdzID4+IDkgJiAxLCB0LmhlYWQuZG9uZSA9ICEwKSwgZS5hZGxlciA9IHQuY2hlY2sgPSAwLCB0Lm1vZGUgPSBIMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBLdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDMyOyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUuYWRsZXIgPSB0LmNoZWNrID0gaWkociksIHIgPSAwLCBfID0gMCwgdC5tb2RlID0gS2U7CiAgICAgICAgY2FzZSBLZToKICAgICAgICAgICAgaWYgKHQuaGF2ZWRpY3QgPT09IDApIHJldHVybiBlLm5leHRfb3V0ID0gbywgZS5hdmFpbF9vdXQgPSBjLCBlLm5leHRfaW4gPSBsLCBlLmF2YWlsX2luID0gZiwgdC5ob2xkID0gciwgdC5iaXRzID0gXywgSG47CiAgICAgICAgICAgIGUuYWRsZXIgPSB0LmNoZWNrID0gMSwgdC5tb2RlID0gSDE7CiAgICAgICAgY2FzZSBIMToKICAgICAgICAgICAgaWYgKGkgPT09IE1uIHx8IGkgPT09IE5lKSBicmVhayBlOwogICAgICAgIGNhc2UgZXQ6CiAgICAgICAgICAgIGlmICh0Lmxhc3QpIHsKICAgICAgICAgICAgICAgIHIgPj4+PSBfICYgNywgXyAtPSBfICYgNywgdC5tb2RlID0gaXQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IoOyBfIDwgMzspewogICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBzd2l0Y2godC5sYXN0ID0gciAmIDEsIHIgPj4+PSAxLCBfIC09IDEsIHIgJiAzKXsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICB0Lm1vZGUgPSBQdDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICBpZiAoVm4odCksIHQubW9kZSA9IExlLCBpID09PSBOZSkgewogICAgICAgICAgICAgICAgICAgICAgICByID4+Pj0gMiwgXyAtPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICB0Lm1vZGUgPSBZdDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGJsb2NrIHR5cGUiLCB0Lm1vZGUgPSBUMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByID4+Pj0gMiwgXyAtPSAyOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFB0OgogICAgICAgICAgICBmb3IociA+Pj49IF8gJiA3LCBfIC09IF8gJiA3OyBfIDwgMzI7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChyICYgNjU1MzUpICE9PSAociA+Pj4gMTYgXiA2NTUzNSkpIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgc3RvcmVkIGJsb2NrIGxlbmd0aHMiLCB0Lm1vZGUgPSBUMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0Lmxlbmd0aCA9IHIgJiA2NTUzNSwgciA9IDAsIF8gPSAwLCB0Lm1vZGUgPSB0dCwgaSA9PT0gTmUpIGJyZWFrIGU7CiAgICAgICAgY2FzZSB0dDoKICAgICAgICAgICAgdC5tb2RlID0gWHQ7CiAgICAgICAgY2FzZSBYdDoKICAgICAgICAgICAgaWYgKGggPSB0Lmxlbmd0aCwgaCkgewogICAgICAgICAgICAgICAgaWYgKGggPiBmICYmIChoID0gZiksIGggPiBjICYmIChoID0gYyksIGggPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICBhLnNldChuLnN1YmFycmF5KGwsIGwgKyBoKSwgbyksIGYgLT0gaCwgbCArPSBoLCBjIC09IGgsIG8gKz0gaCwgdC5sZW5ndGggLT0gaDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQubW9kZSA9IEgxOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFl0OgogICAgICAgICAgICBmb3IoOyBfIDwgMTQ7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQubmxlbiA9IChyICYgMzEpICsgMjU3LCByID4+Pj0gNSwgXyAtPSA1LCB0Lm5kaXN0ID0gKHIgJiAzMSkgKyAxLCByID4+Pj0gNSwgXyAtPSA1LCB0Lm5jb2RlID0gKHIgJiAxNSkgKyA0LCByID4+Pj0gNCwgXyAtPSA0LCB0Lm5sZW4gPiAyODYgfHwgdC5uZGlzdCA+IDMwKSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJ0b28gbWFueSBsZW5ndGggb3IgZGlzdGFuY2Ugc3ltYm9scyIsIHQubW9kZSA9IFQyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5oYXZlID0gMCwgdC5tb2RlID0gR3Q7CiAgICAgICAgY2FzZSBHdDoKICAgICAgICAgICAgZm9yKDsgdC5oYXZlIDwgdC5uY29kZTspewogICAgICAgICAgICAgICAgZm9yKDsgXyA8IDM7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHQubGVuc1tKW3QuaGF2ZSsrXV0gPSByICYgNywgciA+Pj49IDMsIF8gLT0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IoOyB0LmhhdmUgPCAxOTspdC5sZW5zW0pbdC5oYXZlKytdXSA9IDA7CiAgICAgICAgICAgIGlmICh0LmxlbmNvZGUgPSB0LmxlbmR5biwgdC5sZW5iaXRzID0gNywgZyA9IHsKICAgICAgICAgICAgICAgIGJpdHM6IHQubGVuYml0cwogICAgICAgICAgICB9LCB6ID0gd2UxKCRuLCB0LmxlbnMsIDAsIDE5LCB0LmxlbmNvZGUsIDAsIHQud29yaywgZyksIHQubGVuYml0cyA9IGcuYml0cywgeikgewogICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBjb2RlIGxlbmd0aHMgc2V0IiwgdC5tb2RlID0gVDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB0LmhhdmUgPSAwLCB0Lm1vZGUgPSBqdDsKICAgICAgICBjYXNlIGp0OgogICAgICAgICAgICBmb3IoOyB0LmhhdmUgPCB0Lm5sZW4gKyB0Lm5kaXN0Oyl7CiAgICAgICAgICAgICAgICBmb3IoOyB2ID0gdC5sZW5jb2RlW3IgJiAoMSA8PCB0LmxlbmJpdHMpIC0gMV0sIHcgPSB2ID4+PiAyNCwgQSA9IHYgPj4+IDE2ICYgMjU1LCB4ID0gdiAmIDY1NTM1LCAhKHcgPD0gXyk7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh4IDwgMTYpIHIgPj4+PSB3LCBfIC09IHcsIHQubGVuc1t0LmhhdmUrK10gPSB4OwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHggPT09IDE2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihwID0gdyArIDI7IF8gPCBwOyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyID4+Pj0gdywgXyAtPSB3LCB0LmhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgYml0IGxlbmd0aCByZXBlYXQiLCB0Lm1vZGUgPSBUMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSB0LmxlbnNbdC5oYXZlIC0gMV0sIGggPSAzICsgKHIgJiAzKSwgciA+Pj49IDIsIF8gLT0gMjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHggPT09IDE3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihwID0gdyArIDM7IF8gPCBwOyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHIgPj4+PSB3LCBfIC09IHcsIGIgPSAwLCBoID0gMyArIChyICYgNyksIHIgPj4+PSAzLCBfIC09IDM7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHAgPSB3ICsgNzsgXyA8IHA7KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgciA+Pj49IHcsIF8gLT0gdywgYiA9IDAsIGggPSAxMSArIChyICYgMTI3KSwgciA+Pj49IDcsIF8gLT0gNzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHQuaGF2ZSArIGggPiB0Lm5sZW4gKyB0Lm5kaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgYml0IGxlbmd0aCByZXBlYXQiLCB0Lm1vZGUgPSBUMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZvcig7IGgtLTspdC5sZW5zW3QuaGF2ZSsrXSA9IGI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQubW9kZSA9PT0gVDIpIGJyZWFrOwogICAgICAgICAgICBpZiAodC5sZW5zWzI1Nl0gPT09IDApIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgY29kZSAtLSBtaXNzaW5nIGVuZC1vZi1ibG9jayIsIHQubW9kZSA9IFQyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQubGVuYml0cyA9IDksIGcgPSB7CiAgICAgICAgICAgICAgICBiaXRzOiB0LmxlbmJpdHMKICAgICAgICAgICAgfSwgeiA9IHdlMSh6aSwgdC5sZW5zLCAwLCB0Lm5sZW4sIHQubGVuY29kZSwgMCwgdC53b3JrLCBnKSwgdC5sZW5iaXRzID0gZy5iaXRzLCB6KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RocyBzZXQiLCB0Lm1vZGUgPSBUMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LmRpc3RiaXRzID0gNiwgdC5kaXN0Y29kZSA9IHQuZGlzdGR5biwgZyA9IHsKICAgICAgICAgICAgICAgIGJpdHM6IHQuZGlzdGJpdHMKICAgICAgICAgICAgfSwgeiA9IHdlMShUaSwgdC5sZW5zLCB0Lm5sZW4sIHQubmRpc3QsIHQuZGlzdGNvZGUsIDAsIHQud29yaywgZyksIHQuZGlzdGJpdHMgPSBnLmJpdHMsIHopIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgZGlzdGFuY2VzIHNldCIsIHQubW9kZSA9IFQyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQubW9kZSA9IExlLCBpID09PSBOZSkgYnJlYWsgZTsKICAgICAgICBjYXNlIExlOgogICAgICAgICAgICB0Lm1vZGUgPSBVZTE7CiAgICAgICAgY2FzZSBVZTE6CiAgICAgICAgICAgIGlmIChmID49IDYgJiYgYyA+PSAyNTgpIHsKICAgICAgICAgICAgICAgIGUubmV4dF9vdXQgPSBvLCBlLmF2YWlsX291dCA9IGMsIGUubmV4dF9pbiA9IGwsIGUuYXZhaWxfaW4gPSBmLCB0LmhvbGQgPSByLCB0LmJpdHMgPSBfLCBJbihlLCBzKSwgbyA9IGUubmV4dF9vdXQsIGEgPSBlLm91dHB1dCwgYyA9IGUuYXZhaWxfb3V0LCBsID0gZS5uZXh0X2luLCBuID0gZS5pbnB1dCwgZiA9IGUuYXZhaWxfaW4sIHIgPSB0LmhvbGQsIF8gPSB0LmJpdHMsIHQubW9kZSA9PT0gSDEgJiYgKHQuYmFjayA9IC0xKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvcih0LmJhY2sgPSAwOyB2ID0gdC5sZW5jb2RlW3IgJiAoMSA8PCB0LmxlbmJpdHMpIC0gMV0sIHcgPSB2ID4+PiAyNCwgQSA9IHYgPj4+IDE2ICYgMjU1LCB4ID0gdiAmIDY1NTM1LCAhKHcgPD0gXyk7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEEgJiYgKEEgJiAyNDApID09PSAwKSB7CiAgICAgICAgICAgICAgICBmb3IoZCA9IHcsIFMgPSBBLCBaID0geDsgdiA9IHQubGVuY29kZVtaICsgKChyICYgKDEgPDwgZCArIFMpIC0gMSkgPj4gZCldLCB3ID0gdiA+Pj4gMjQsIEEgPSB2ID4+PiAxNiAmIDI1NSwgeCA9IHYgJiA2NTUzNSwgIShkICsgdyA8PSBfKTspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgciA+Pj49IGQsIF8gLT0gZCwgdC5iYWNrICs9IGQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHIgPj4+PSB3LCBfIC09IHcsIHQuYmFjayArPSB3LCB0Lmxlbmd0aCA9IHgsIEEgPT09IDApIHsKICAgICAgICAgICAgICAgIHQubW9kZSA9IHF0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEEgJiAzMikgewogICAgICAgICAgICAgICAgdC5iYWNrID0gLTEsIHQubW9kZSA9IEgxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEEgJiA2NCkgewogICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIiwgdC5tb2RlID0gVDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB0LmV4dHJhID0gQSAmIDE1LCB0Lm1vZGUgPSBXdDsKICAgICAgICBjYXNlIFd0OgogICAgICAgICAgICBpZiAodC5leHRyYSkgewogICAgICAgICAgICAgICAgZm9yKHAgPSB0LmV4dHJhOyBfIDwgcDspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdC5sZW5ndGggKz0gciAmICgxIDw8IHQuZXh0cmEpIC0gMSwgciA+Pj49IHQuZXh0cmEsIF8gLT0gdC5leHRyYSwgdC5iYWNrICs9IHQuZXh0cmE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC53YXMgPSB0Lmxlbmd0aCwgdC5tb2RlID0gVnQ7CiAgICAgICAgY2FzZSBWdDoKICAgICAgICAgICAgZm9yKDsgdiA9IHQuZGlzdGNvZGVbciAmICgxIDw8IHQuZGlzdGJpdHMpIC0gMV0sIHcgPSB2ID4+PiAyNCwgQSA9IHYgPj4+IDE2ICYgMjU1LCB4ID0gdiAmIDY1NTM1LCAhKHcgPD0gXyk7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChBICYgMjQwKSA9PT0gMCkgewogICAgICAgICAgICAgICAgZm9yKGQgPSB3LCBTID0gQSwgWiA9IHg7IHYgPSB0LmRpc3Rjb2RlW1ogKyAoKHIgJiAoMSA8PCBkICsgUykgLSAxKSA+PiBkKV0sIHcgPSB2ID4+PiAyNCwgQSA9IHYgPj4+IDE2ICYgMjU1LCB4ID0gdiAmIDY1NTM1LCAhKGQgKyB3IDw9IF8pOyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByID4+Pj0gZCwgXyAtPSBkLCB0LmJhY2sgKz0gZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAociA+Pj49IHcsIF8gLT0gdywgdC5iYWNrICs9IHcsIEEgJiA2NCkgewogICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSBjb2RlIiwgdC5tb2RlID0gVDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB0Lm9mZnNldCA9IHgsIHQuZXh0cmEgPSBBICYgMTUsIHQubW9kZSA9IEp0OwogICAgICAgIGNhc2UgSnQ6CiAgICAgICAgICAgIGlmICh0LmV4dHJhKSB7CiAgICAgICAgICAgICAgICBmb3IocCA9IHQuZXh0cmE7IF8gPCBwOyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0Lm9mZnNldCArPSByICYgKDEgPDwgdC5leHRyYSkgLSAxLCByID4+Pj0gdC5leHRyYSwgXyAtPSB0LmV4dHJhLCB0LmJhY2sgKz0gdC5leHRyYTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5vZmZzZXQgPiB0LmRtYXgpIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIiwgdC5tb2RlID0gVDI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB0Lm1vZGUgPSBRdDsKICAgICAgICBjYXNlIFF0OgogICAgICAgICAgICBpZiAoYyA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgaWYgKGggPSBzIC0gYywgdC5vZmZzZXQgPiBoKSB7CiAgICAgICAgICAgICAgICBpZiAoaCA9IHQub2Zmc2V0IC0gaCwgaCA+IHQud2hhdmUgJiYgdC5zYW5lKSB7CiAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLCB0Lm1vZGUgPSBUMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGggPiB0LnduZXh0ID8gKGggLT0gdC53bmV4dCwgdSA9IHQud3NpemUgLSBoKSA6IHUgPSB0LnduZXh0IC0gaCwgaCA+IHQubGVuZ3RoICYmIChoID0gdC5sZW5ndGgpLCBtID0gdC53aW5kb3c7CiAgICAgICAgICAgIH0gZWxzZSBtID0gYSwgdSA9IG8gLSB0Lm9mZnNldCwgaCA9IHQubGVuZ3RoOwogICAgICAgICAgICBoID4gYyAmJiAoaCA9IGMpLCBjIC09IGgsIHQubGVuZ3RoIC09IGg7CiAgICAgICAgICAgIGRvIGFbbysrXSA9IG1bdSsrXTsKICAgICAgICAgICAgd2hpbGUgKC0taCkKICAgICAgICAgICAgdC5sZW5ndGggPT09IDAgJiYgKHQubW9kZSA9IFVlMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgcXQ6CiAgICAgICAgICAgIGlmIChjID09PSAwKSBicmVhayBlOwogICAgICAgICAgICBhW28rK10gPSB0Lmxlbmd0aCwgYy0tLCB0Lm1vZGUgPSBVZTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgaXQ6CiAgICAgICAgICAgIGlmICh0LndyYXApIHsKICAgICAgICAgICAgICAgIGZvcig7IF8gPCAzMjspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciB8PSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHMgLT0gYywgZS50b3RhbF9vdXQgKz0gcywgdC50b3RhbCArPSBzLCBzICYmIChlLmFkbGVyID0gdC5jaGVjayA9IHQuZmxhZ3MgPyBJMih0LmNoZWNrLCBhLCBzLCBvIC0gcykgOiB2ZTEodC5jaGVjaywgYSwgcywgbyAtIHMpKSwgcyA9IGMsICh0LmZsYWdzID8gciA6IGlpKHIpKSAhPT0gdC5jaGVjaykgewogICAgICAgICAgICAgICAgICAgIGUubXNnID0gImluY29ycmVjdCBkYXRhIGNoZWNrIiwgdC5tb2RlID0gVDI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByID0gMCwgXyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5tb2RlID0gZWk7CiAgICAgICAgY2FzZSBlaToKICAgICAgICAgICAgaWYgKHQud3JhcCAmJiB0LmZsYWdzKSB7CiAgICAgICAgICAgICAgICBmb3IoOyBfIDwgMzI7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyICE9PSAodC50b3RhbCAmIDQyOTQ5NjcyOTUpKSB7CiAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW5jb3JyZWN0IGxlbmd0aCBjaGVjayIsIHQubW9kZSA9IFQyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgciA9IDAsIF8gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQubW9kZSA9IHRpOwogICAgICAgIGNhc2UgdGk6CiAgICAgICAgICAgIHogPSBGbjsKICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICBjYXNlIFQyOgogICAgICAgICAgICB6ID0gbWk7CiAgICAgICAgICAgIGJyZWFrIGU7CiAgICAgICAgY2FzZSBJaToKICAgICAgICAgICAgcmV0dXJuIERpOwogICAgICAgIGNhc2UgS246CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIFUxOwogICAgfQogICAgcmV0dXJuIGUubmV4dF9vdXQgPSBvLCBlLmF2YWlsX291dCA9IGMsIGUubmV4dF9pbiA9IGwsIGUuYXZhaWxfaW4gPSBmLCB0LmhvbGQgPSByLCB0LmJpdHMgPSBfLCAodC53c2l6ZSB8fCBzICE9PSBlLmF2YWlsX291dCAmJiB0Lm1vZGUgPCBUMiAmJiAodC5tb2RlIDwgaXQgfHwgaSAhPT0gT3QpKSAmJiBDaShlLCBlLm91dHB1dCwgZS5uZXh0X291dCwgcyAtIGUuYXZhaWxfb3V0KSwgRSAtPSBlLmF2YWlsX2luLCBzIC09IGUuYXZhaWxfb3V0LCBlLnRvdGFsX2luICs9IEUsIGUudG90YWxfb3V0ICs9IHMsIHQudG90YWwgKz0gcywgdC53cmFwICYmIHMgJiYgKGUuYWRsZXIgPSB0LmNoZWNrID0gdC5mbGFncyA/IEkyKHQuY2hlY2ssIGEsIHMsIGUubmV4dF9vdXQgLSBzKSA6IHZlMSh0LmNoZWNrLCBhLCBzLCBlLm5leHRfb3V0IC0gcykpLCBlLmRhdGFfdHlwZSA9IHQuYml0cyArICh0Lmxhc3QgPyA2NCA6IDApICsgKHQubW9kZSA9PT0gSDEgPyAxMjggOiAwKSArICh0Lm1vZGUgPT09IExlIHx8IHQubW9kZSA9PT0gdHQgPyAyNTYgOiAwKSwgKEUgPT09IDAgJiYgcyA9PT0gMCB8fCBpID09PSBPdCkgJiYgeiA9PT0gYWUxICYmICh6ID0gQm4pLCB6Owp9LCBRbiA9IChlKT0+ewogICAgaWYgKCFlIHx8ICFlLnN0YXRlKSByZXR1cm4gVTE7CiAgICBsZXQgaSA9IGUuc3RhdGU7CiAgICByZXR1cm4gaS53aW5kb3cgJiYgKGkud2luZG93ID0gbnVsbCksIGUuc3RhdGUgPSBudWxsLCBhZTE7Cn0sIHFuID0gKGUsIGkpPT57CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBVMTsKICAgIGxldCB0ID0gZS5zdGF0ZTsKICAgIHJldHVybiAodC53cmFwICYgMikgPT09IDAgPyBVMSA6ICh0LmhlYWQgPSBpLCBpLmRvbmUgPSAhMSwgYWUxKTsKfSwgZWwgPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gaS5sZW5ndGgsIG4sIGEsIGw7CiAgICByZXR1cm4gIWUgfHwgIWUuc3RhdGUgfHwgKG4gPSBlLnN0YXRlLCBuLndyYXAgIT09IDAgJiYgbi5tb2RlICE9PSBLZSkgPyBVMSA6IG4ubW9kZSA9PT0gS2UgJiYgKGEgPSAxLCBhID0gdmUxKGEsIGksIHQsIDApLCBhICE9PSBuLmNoZWNrKSA/IG1pIDogKGwgPSBDaShlLCBpLCB0LCB0KSwgbCA/IChuLm1vZGUgPSBJaSwgRGkpIDogKG4uaGF2ZWRpY3QgPSAxLCBhZTEpKTsKfSwgdGwgPSBOaSwgaWwgPSBMaSwgYWwgPSBPaSwgbmwgPSBXbiwgbGwgPSBVaSwgcmwgPSBKbiwgZmwgPSBRbiwgb2wgPSBxbiwgX2wgPSBlbCwgaGwgPSAicGFrbyBpbmZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSIsIEsyID0gewogICAgaW5mbGF0ZVJlc2V0OiB0bCwKICAgIGluZmxhdGVSZXNldDI6IGlsLAogICAgaW5mbGF0ZVJlc2V0S2VlcDogYWwsCiAgICBpbmZsYXRlSW5pdDogbmwsCiAgICBpbmZsYXRlSW5pdDI6IGxsLAogICAgaW5mbGF0ZTogcmwsCiAgICBpbmZsYXRlRW5kOiBmbCwKICAgIGluZmxhdGVHZXRIZWFkZXI6IG9sLAogICAgaW5mbGF0ZVNldERpY3Rpb25hcnk6IF9sLAogICAgaW5mbGF0ZUluZm86IGhsCn07CmZ1bmN0aW9uIGRsKCkgewogICAgdGhpcy50ZXh0ID0gMCwgdGhpcy50aW1lID0gMCwgdGhpcy54ZmxhZ3MgPSAwLCB0aGlzLm9zID0gMCwgdGhpcy5leHRyYSA9IG51bGwsIHRoaXMuZXh0cmFfbGVuID0gMCwgdGhpcy5uYW1lID0gIiIsIHRoaXMuY29tbWVudCA9ICIiLCB0aGlzLmhjcmMgPSAwLCB0aGlzLmRvbmUgPSAhMTsKfQp2YXIgc2wgPSBkbCwgJGkgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLCB7IFpfTk9fRkxVU0g6IGNsICwgWl9GSU5JU0g6IHVsICwgWl9PSzogU2UxICwgWl9TVFJFQU1fRU5EOiBsdCAsIFpfTkVFRF9ESUNUOiBydCAsIFpfU1RSRUFNX0VSUk9SOiBibCAsIFpfREFUQV9FUlJPUjogbmkgLCBaX01FTV9FUlJPUjogd2wgIH0gPSBuZTE7CmZ1bmN0aW9uIFRlMShlKSB7CiAgICB0aGlzLm9wdGlvbnMgPSBZZS5hc3NpZ24oewogICAgICAgIGNodW5rU2l6ZTogMTAyNCAqIDY0LAogICAgICAgIHdpbmRvd0JpdHM6IDE1LAogICAgICAgIHRvOiAiIgogICAgfSwgZSB8fCB7fSk7CiAgICBsZXQgaSA9IHRoaXMub3B0aW9uczsKICAgIGkucmF3ICYmIGkud2luZG93Qml0cyA+PSAwICYmIGkud2luZG93Qml0cyA8IDE2ICYmIChpLndpbmRvd0JpdHMgPSAtaS53aW5kb3dCaXRzLCBpLndpbmRvd0JpdHMgPT09IDAgJiYgKGkud2luZG93Qml0cyA9IC0xNSkpLCBpLndpbmRvd0JpdHMgPj0gMCAmJiBpLndpbmRvd0JpdHMgPCAxNiAmJiAhKGUgJiYgZS53aW5kb3dCaXRzKSAmJiAoaS53aW5kb3dCaXRzICs9IDMyKSwgaS53aW5kb3dCaXRzID4gMTUgJiYgaS53aW5kb3dCaXRzIDwgNDggJiYgKGkud2luZG93Qml0cyAmIDE1KSA9PT0gMCAmJiAoaS53aW5kb3dCaXRzIHw9IDE1KSwgdGhpcy5lcnIgPSAwLCB0aGlzLm1zZyA9ICIiLCB0aGlzLmVuZGVkID0gITEsIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuc3RybSA9IG5ldyBBaSwgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CiAgICBsZXQgdCA9IEsyLmluZmxhdGVJbml0Mih0aGlzLnN0cm0sIGkud2luZG93Qml0cyk7CiAgICBpZiAodCAhPT0gU2UxKSB0aHJvdyBuZXcgRXJyb3IoZWUxW3RdKTsKICAgIGlmICh0aGlzLmhlYWRlciA9IG5ldyBzbCwgSzIuaW5mbGF0ZUdldEhlYWRlcih0aGlzLnN0cm0sIHRoaXMuaGVhZGVyKSwgaS5kaWN0aW9uYXJ5ICYmICh0eXBlb2YgaS5kaWN0aW9uYXJ5ID09ICJzdHJpbmciID8gaS5kaWN0aW9uYXJ5ID0geWUxLnN0cmluZzJidWYoaS5kaWN0aW9uYXJ5KSA6ICRpLmNhbGwoaS5kaWN0aW9uYXJ5KSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIiAmJiAoaS5kaWN0aW9uYXJ5ID0gbmV3IFVpbnQ4QXJyYXkoaS5kaWN0aW9uYXJ5KSksIGkucmF3ICYmICh0ID0gSzIuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBpLmRpY3Rpb25hcnkpLCB0ICE9PSBTZTEpKSkgdGhyb3cgbmV3IEVycm9yKGVlMVt0XSk7Cn0KVGUxLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oZSwgaSkgewogICAgbGV0IHQgPSB0aGlzLnN0cm0sIG4gPSB0aGlzLm9wdGlvbnMuY2h1bmtTaXplLCBhID0gdGhpcy5vcHRpb25zLmRpY3Rpb25hcnksIGwsIG8sIGY7CiAgICBpZiAodGhpcy5lbmRlZCkgcmV0dXJuICExOwogICAgZm9yKGkgPT09IH5+aSA/IG8gPSBpIDogbyA9IGkgPT09ICEwID8gdWwgOiBjbCwgJGkuY2FsbChlKSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIiA/IHQuaW5wdXQgPSBuZXcgVWludDhBcnJheShlKSA6IHQuaW5wdXQgPSBlLCB0Lm5leHRfaW4gPSAwLCB0LmF2YWlsX2luID0gdC5pbnB1dC5sZW5ndGg7Oyl7CiAgICAgICAgZm9yKHQuYXZhaWxfb3V0ID09PSAwICYmICh0Lm91dHB1dCA9IG5ldyBVaW50OEFycmF5KG4pLCB0Lm5leHRfb3V0ID0gMCwgdC5hdmFpbF9vdXQgPSBuKSwgbCA9IEsyLmluZmxhdGUodCwgbyksIGwgPT09IHJ0ICYmIGEgJiYgKGwgPSBLMi5pbmZsYXRlU2V0RGljdGlvbmFyeSh0LCBhKSwgbCA9PT0gU2UxID8gbCA9IEsyLmluZmxhdGUodCwgbykgOiBsID09PSBuaSAmJiAobCA9IHJ0KSk7IHQuYXZhaWxfaW4gPiAwICYmIGwgPT09IGx0ICYmIHQuc3RhdGUud3JhcCA+IDAgJiYgZVt0Lm5leHRfaW5dICE9PSAwOylLMi5pbmZsYXRlUmVzZXQodCksIGwgPSBLMi5pbmZsYXRlKHQsIG8pOwogICAgICAgIHN3aXRjaChsKXsKICAgICAgICAgICAgY2FzZSBibDoKICAgICAgICAgICAgY2FzZSBuaToKICAgICAgICAgICAgY2FzZSBydDoKICAgICAgICAgICAgY2FzZSB3bDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm9uRW5kKGwpLCB0aGlzLmVuZGVkID0gITAsICExOwogICAgICAgIH0KICAgICAgICBpZiAoZiA9IHQuYXZhaWxfb3V0LCB0Lm5leHRfb3V0ICYmICh0LmF2YWlsX291dCA9PT0gMCB8fCBsID09PSBsdCkpIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGxldCBjID0geWUxLnV0Zjhib3JkZXIodC5vdXRwdXQsIHQubmV4dF9vdXQpLCByID0gdC5uZXh0X291dCAtIGMsIF8gPSB5ZTEuYnVmMnN0cmluZyh0Lm91dHB1dCwgYyk7CiAgICAgICAgICAgIHQubmV4dF9vdXQgPSByLCB0LmF2YWlsX291dCA9IG4gLSByLCByICYmIHQub3V0cHV0LnNldCh0Lm91dHB1dC5zdWJhcnJheShjLCBjICsgciksIDApLCB0aGlzLm9uRGF0YShfKTsKICAgICAgICB9IGVsc2UgdGhpcy5vbkRhdGEodC5vdXRwdXQubGVuZ3RoID09PSB0Lm5leHRfb3V0ID8gdC5vdXRwdXQgOiB0Lm91dHB1dC5zdWJhcnJheSgwLCB0Lm5leHRfb3V0KSk7CiAgICAgICAgaWYgKCEobCA9PT0gU2UxICYmIGYgPT09IDApKSB7CiAgICAgICAgICAgIGlmIChsID09PSBsdCkgcmV0dXJuIGwgPSBLMi5pbmZsYXRlRW5kKHRoaXMuc3RybSksIHRoaXMub25FbmQobCksIHRoaXMuZW5kZWQgPSAhMCwgITA7CiAgICAgICAgICAgIGlmICh0LmF2YWlsX2luID09PSAwKSBicmVhazsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gITA7Cn07ClRlMS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24oZSkgewogICAgdGhpcy5jaHVua3MucHVzaChlKTsKfTsKVGUxLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uKGUpIHsKICAgIGUgPT09IFNlMSAmJiAodGhpcy5vcHRpb25zLnRvID09PSAic3RyaW5nIiA/IHRoaXMucmVzdWx0ID0gdGhpcy5jaHVua3Muam9pbigiIikgOiB0aGlzLnJlc3VsdCA9IFllLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSwgdGhpcy5jaHVua3MgPSBbXSwgdGhpcy5lcnIgPSBlLCB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7Cn07CmZ1bmN0aW9uIHd0KGUsIGkpIHsKICAgIGxldCB0ID0gbmV3IFRlMShpKTsKICAgIGlmICh0LnB1c2goZSksIHQuZXJyKSB0aHJvdyB0Lm1zZyB8fCBlZTFbdC5lcnJdOwogICAgcmV0dXJuIHQucmVzdWx0Owp9CmZ1bmN0aW9uIGdsKGUsIGkpIHsKICAgIHJldHVybiBpID0gaSB8fCB7fSwgaS5yYXcgPSAhMCwgd3QoZSwgaSk7Cn0KdmFyIHBsID0gVGUxLCB4bCA9IHd0LCBrbCA9IGdsLCB2bCA9IHd0LCBFbCA9IG5lMSwgeWwgPSB7CiAgICBJbmZsYXRlOiBwbCwKICAgIGluZmxhdGU6IHhsLAogICAgaW5mbGF0ZVJhdzoga2wsCiAgICB1bmd6aXA6IHZsLAogICAgY29uc3RhbnRzOiBFbAp9LCB7IERlZmxhdGU6IFNsICwgZGVmbGF0ZTogQWwgLCBkZWZsYXRlUmF3OiBSbCAsIGd6aXA6IHpsICB9ID0gRG4sIHsgSW5mbGF0ZTogVGwgLCBpbmZsYXRlOiBtbCAsIGluZmxhdGVSYXc6IERsICwgdW5nemlwOiBabCAgfSA9IHlsLCBPbCA9IEFsLCBDbCA9IG1sOwpjb25zdCBVcGRhdGVPYnNlcnZhYmxlID0gIjAiOwpjbGFzcyBSZXRhaW4gewogICAgY29uc3RydWN0b3IodmFsdWUpewogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KfQpjb25zdCBPbmpzQ2FsbGJhY2sgPSAiMSI7CmNvbnN0IEV2YWxKYXZhc2NyaXB0ID0gIjIiOwpjb25zdCBKYXZhc2NyaXB0RXJyb3IgPSAiMyI7CmNvbnN0IEphdmFzY3JpcHRXYXJuaW5nID0gIjQiOwpjb25zdCBSZWdpc3Rlck9ic2VydmFibGUgPSAiNSI7CmNvbnN0IEpTRG9uZUxvYWRpbmcgPSAiOCI7CmNvbnN0IEZ1c2VkTWVzc2FnZSA9ICI5IjsKY29uc3QgQ2xvc2VTZXNzaW9uID0gIjEwIjsKY29uc3QgUGluZ1BvbmcgPSAiMTEiOwpjb25zdCBDT05ORUNUSU9OID0gewogICAgc2VuZF9tZXNzYWdlOiB1bmRlZmluZWQsCiAgICBjb25uZWN0aW9uX29wZW5fY2FsbGJhY2s6IHVuZGVmaW5lZCwKICAgIHF1ZXVlOiBbXSwKICAgIHN0YXR1czogImNsb3NlZCIKfTsKZnVuY3Rpb24gcmVnaXN0ZXJfb25fY29ubmVjdGlvbl9vcGVuKGNhbGxiYWNrLCBzZXNzaW9uX2lkKSB7CiAgICBDT05ORUNUSU9OLmNvbm5lY3Rpb25fb3Blbl9jYWxsYmFjayA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoY2FsbGJhY2soKSk7CiAgICAgICAgcHJvbWlzZS50aGVuKCgpPT5zZW5kX2RvbmVfbG9hZGluZyhzZXNzaW9uX2lkKSk7CiAgICB9Owp9CmZ1bmN0aW9uIG9uX2Nvbm5lY3Rpb25fb3BlbihzZW5kX21lc3NhZ2VfY2FsbGJhY2spIHsKICAgIENPTk5FQ1RJT04uc2VuZF9tZXNzYWdlID0gc2VuZF9tZXNzYWdlX2NhbGxiYWNrOwogICAgQ09OTkVDVElPTi5zdGF0dXMgPSAib3BlbiI7CiAgICBDT05ORUNUSU9OLnF1ZXVlLmZvckVhY2goKG1lc3NhZ2UpPT5zZW5kX3RvX2p1bGlhKG1lc3NhZ2UpKTsKICAgIENPTk5FQ1RJT04uY29ubmVjdGlvbl9vcGVuX2NhbGxiYWNrKCk7Cn0KZnVuY3Rpb24gb25fY29ubmVjdGlvbl9jbG9zZSgpIHsKICAgIENPTk5FQ1RJT04uc3RhdHVzID0gImNsb3NlZCI7Cn0KY29uc3QgRVhURU5TSU9OX0NPREVDID0gbmV3IEkxKCk7CndpbmRvdy5FWFRFTlNJT05fQ09ERUMgPSBFWFRFTlNJT05fQ09ERUM7CmZ1bmN0aW9uIHVucGFjayh1aW50OGFycmF5KSB7CiAgICByZXR1cm4gVGUodWludDhhcnJheSwgewogICAgICAgIGV4dGVuc2lvbkNvZGVjOiBFWFRFTlNJT05fQ09ERUMKICAgIH0pOwp9CmZ1bmN0aW9uIHBhY2sob2JqZWN0KSB7CiAgICByZXR1cm4gdmUob2JqZWN0LCB7CiAgICAgICAgZXh0ZW5zaW9uQ29kZWM6IEVYVEVOU0lPTl9DT0RFQwogICAgfSk7Cn0KZnVuY3Rpb24gcmVpbnRlcnByZXRfYXJyYXkoQXJyYXlUeXBlLCB1aW50OGFycmF5KSB7CiAgICBpZiAoQXJyYXlUeXBlID09PSBVaW50OEFycmF5KSB7CiAgICAgICAgcmV0dXJuIHVpbnQ4YXJyYXk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGJvID0gdWludDhhcnJheS5ieXRlT2Zmc2V0OwogICAgICAgIGNvbnN0IGJwZSA9IEFycmF5VHlwZS5CWVRFU19QRVJfRUxFTUVOVDsKICAgICAgICBjb25zdCBuZXdfYXJyYXlfbGVuZ3RoID0gdWludDhhcnJheS5ieXRlTGVuZ3RoIC8gYnBlOwogICAgICAgIGNvbnN0IGJ1ZmZlciA9IHVpbnQ4YXJyYXkuYnVmZmVyLnNsaWNlKGJvLCBibyArIHVpbnQ4YXJyYXkuYnl0ZUxlbmd0aCk7CiAgICAgICAgcmV0dXJuIG5ldyBBcnJheVR5cGUoYnVmZmVyLCAwLCBuZXdfYXJyYXlfbGVuZ3RoKTsKICAgIH0KfQpmdW5jdGlvbiByZWdpc3Rlcl9leHRfYXJyYXkodHlwZV90YWcsIGFycmF5X3R5cGUpIHsKICAgIEVYVEVOU0lPTl9DT0RFQy5yZWdpc3Rlcih7CiAgICAgICAgdHlwZTogdHlwZV90YWcsCiAgICAgICAgZGVjb2RlOiAodWludDhhcnJheSk9PnJlaW50ZXJwcmV0X2FycmF5KGFycmF5X3R5cGUsIHVpbnQ4YXJyYXkpLAogICAgICAgIGVuY29kZTogKG9iamVjdCk9PnsKICAgICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIGFycmF5X3R5cGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShvYmplY3QuYnVmZmVyLCBvYmplY3QuYnl0ZU9mZnNldCwgb2JqZWN0LmJ5dGVMZW5ndGgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKfQpyZWdpc3Rlcl9leHRfYXJyYXkoMHgxMSwgSW50OEFycmF5KTsKcmVnaXN0ZXJfZXh0X2FycmF5KDB4MTIsIFVpbnQ4QXJyYXkpOwpyZWdpc3Rlcl9leHRfYXJyYXkoMHgxMywgSW50MTZBcnJheSk7CnJlZ2lzdGVyX2V4dF9hcnJheSgweDE0LCBVaW50MTZBcnJheSk7CnJlZ2lzdGVyX2V4dF9hcnJheSgweDE1LCBJbnQzMkFycmF5KTsKcmVnaXN0ZXJfZXh0X2FycmF5KDB4MTYsIFVpbnQzMkFycmF5KTsKcmVnaXN0ZXJfZXh0X2FycmF5KDB4MTcsIEZsb2F0MzJBcnJheSk7CnJlZ2lzdGVyX2V4dF9hcnJheSgweDE4LCBGbG9hdDY0QXJyYXkpOwpmdW5jdGlvbiByZWdpc3Rlcl9leHQodHlwZV90YWcsIGRlY29kZSwgZW5jb2RlKSB7CiAgICBFWFRFTlNJT05fQ09ERUMucmVnaXN0ZXIoewogICAgICAgIHR5cGU6IHR5cGVfdGFnLAogICAgICAgIGRlY29kZSwKICAgICAgICBlbmNvZGUKICAgIH0pOwp9CmNsYXNzIEpMQXJyYXkgewogICAgY29uc3RydWN0b3Ioc2l6ZSwgYXJyYXkpewogICAgICAgIHRoaXMuc2l6ZSA9IHNpemU7CiAgICAgICAgdGhpcy5hcnJheSA9IGFycmF5OwogICAgfQp9CnJlZ2lzdGVyX2V4dCg5OSwgKHVpbnRfOF9hcnJheSk9PnsKICAgIGNvbnN0IFtzaXplLCBhcnJheV0gPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIHJldHVybiBuZXcgSkxBcnJheShzaXplLCBhcnJheSk7Cn0sIChvYmplY3QpPT57CiAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgSkxBcnJheSkgewogICAgICAgIHJldHVybiBwYWNrKFsKICAgICAgICAgICAgb2JqZWN0LnNpemUsCiAgICAgICAgICAgIG9iamVjdC5hcnJheQogICAgICAgIF0pOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KfSk7CmZ1bmN0aW9uIHNlbmRfZXJyb3IobWVzc2FnZSwgZXhjZXB0aW9uKSB7CiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOwogICAgY29uc29sZS5lcnJvcihleGNlcHRpb24pOwogICAgc2VuZF90b19qdWxpYSh7CiAgICAgICAgbXNnX3R5cGU6IEphdmFzY3JpcHRFcnJvciwKICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLAogICAgICAgIGV4Y2VwdGlvbjogU3RyaW5nKGV4Y2VwdGlvbiksCiAgICAgICAgc3RhY2t0cmFjZTogZXhjZXB0aW9uID09IG51bGwgPyAiIiA6IGV4Y2VwdGlvbi5zdGFjawogICAgfSk7Cn0KY29uc3QgU0VTU0lPTlMgPSB7fTsKY29uc3QgR0xPQkFMX09CSkVDVF9DQUNIRSA9IHt9Owpjb25zdCBGUkVFX0pPQlNfUVVFVUUgPSBbXTsKbGV0IEFMTE9XX0ZSRUVJTkdfT0JKRUNUUyA9IHRydWU7CmZ1bmN0aW9uIHdoaWxlX2xvY2tpbmdfZnJlZShmLCBpZCkgewogICAgQUxMT1dfRlJFRUlOR19PQkpFQ1RTID0gZmFsc2U7CiAgICBmdW5jdGlvbiBjbGVhbnVwKCkgewogICAgICAgIEFMTE9XX0ZSRUVJTkdfT0JKRUNUUyA9IHRydWU7CiAgICAgICAgd2hpbGUoRlJFRV9KT0JTX1FVRVVFLmxlbmd0aCA+IDApewogICAgICAgICAgICBjb25zdCBqb2IgPSBGUkVFX0pPQlNfUVVFVUUucG9wKCk7CiAgICAgICAgICAgIGpvYigpOwogICAgICAgIH0KICAgIH0KICAgIGNvbnN0IHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoZigpKTsKICAgIHByb21pc2UudGhlbigoeCk9PnsKICAgICAgICBjbGVhbnVwKCk7CiAgICB9KTsKfQpmdW5jdGlvbiBsb29rdXBfZ2xvYmFsX29iamVjdChrZXkpIHsKICAgIGNvbnN0IG9iamVjdCA9IEdMT0JBTF9PQkpFQ1RfQ0FDSEVba2V5XTsKICAgIGlmIChvYmplY3QpIHsKICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgUmV0YWluKSB7CiAgICAgICAgICAgIHJldHVybiBvYmplY3QudmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgICB9CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoYEtleSAke2tleX0gbm90IGZvdW5kISAke29iamVjdH1gKTsKfQpmdW5jdGlvbiBpc19zdGlsbF9yZWZlcmVuY2VkKGlkKSB7CiAgICBmb3IoY29uc3Qgc2Vzc2lvbl9pZCBpbiBTRVNTSU9OUyl7CiAgICAgICAgY29uc3QgW3RyYWNrZWRfb2JqZWN0cywgYWxsb3dfZGVsZXRlXSA9IFNFU1NJT05TW3Nlc3Npb25faWRdOwogICAgICAgIGlmIChhbGxvd19kZWxldGUgJiYgdHJhY2tlZF9vYmplY3RzLmhhcyhpZCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIHNlbmRfcGluZ3BvbmcoKSB7CiAgICBzZW5kX3RvX2p1bGlhKHsKICAgICAgICBtc2dfdHlwZTogUGluZ1BvbmcKICAgIH0pOwp9CmZ1bmN0aW9uIHNlbmRfd2FybmluZyhtZXNzYWdlKSB7CiAgICBjb25zb2xlLndhcm4obWVzc2FnZSk7CiAgICBzZW5kX3RvX2p1bGlhKHsKICAgICAgICBtc2dfdHlwZTogSmF2YXNjcmlwdFdhcm5pbmcsCiAgICAgICAgbWVzc2FnZTogbWVzc2FnZQogICAgfSk7Cn0KZnVuY3Rpb24gZW5jb2RlX2JpbmFyeShkYXRhKSB7CiAgICByZXR1cm4gT2wocGFjayhkYXRhKSk7Cn0KZnVuY3Rpb24gc2VuZF90b19qdWxpYShtZXNzYWdlKSB7CiAgICBjb25zdCB7IHNlbmRfbWVzc2FnZSAsIHN0YXR1cyAgfSA9IENPTk5FQ1RJT047CiAgICBpZiAoc2VuZF9tZXNzYWdlICYmIHN0YXR1cyA9PT0gIm9wZW4iKSB7CiAgICAgICAgc2VuZF9tZXNzYWdlKGVuY29kZV9iaW5hcnkobWVzc2FnZSkpOwogICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICJjbG9zZWQiKSB7CiAgICAgICAgQ09OTkVDVElPTi5xdWV1ZS5wdXNoKG1lc3NhZ2UpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygiVHJ5aW5nIHRvIHNlbmQgbWVzc2FnZXMgd2hpbGUgY29ubmVjdGlvbiBpcyBvZmZsaW5lIik7CiAgICB9Cn0KY2xhc3MgT2JzZXJ2YWJsZSB7CiAgICAjY2FsbGJhY2tzID0gW107CiAgICBjb25zdHJ1Y3RvcihpZCwgdmFsdWUpewogICAgICAgIHRoaXMuaWQgPSBpZDsKICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICB9CiAgICBub3RpZnkodmFsdWUsIGRvbnRfbm90aWZ5X2p1bGlhKSB7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgIHRoaXMuI2NhbGxiYWNrcy5mb3JFYWNoKChjYWxsYmFjayk9PnsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGRlcmVnaXN0ZXIgPSBjYWxsYmFjayh2YWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZGVyZWdpc3RlciA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuI2NhbGxiYWNrcy5zcGxpY2UodGhpcy4jY2FsbGJhY2tzLmluZGV4T2YoY2FsbGJhY2spLCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBzZW5kX2Vycm9yKCJFcnJvciBkdXJpbmcgcnVubmluZyBvbmpzIGNhbGxiYWNrXG4iICsgIkNhbGxiYWNrOlxuIiArIGNhbGxiYWNrLnRvU3RyaW5nKCksIGV4Y2VwdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBpZiAoIWRvbnRfbm90aWZ5X2p1bGlhKSB7CiAgICAgICAgICAgIHNlbmRfdG9fanVsaWEoewogICAgICAgICAgICAgICAgbXNnX3R5cGU6IFVwZGF0ZU9ic2VydmFibGUsCiAgICAgICAgICAgICAgICBpZDogdGhpcy5pZCwKICAgICAgICAgICAgICAgIHBheWxvYWQ6IHZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIG9uKGNhbGxiYWNrKSB7CiAgICAgICAgdGhpcy4jY2FsbGJhY2tzLnB1c2goY2FsbGJhY2spOwogICAgfQp9CnJlZ2lzdGVyX2V4dCgxMDAsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbaWQsIHZhbHVlXSA9IHVucGFjayh1aW50XzhfYXJyYXkpOwogICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKGlkLCB2YWx1ZSk7Cn0pOwpyZWdpc3Rlcl9leHQoMTAxLCAodWludF84X2FycmF5KT0+ewogICAgY29uc3QgW2VzNm1vZHVsZSwgdXJsXSA9IHVucGFjayh1aW50XzhfYXJyYXkpOwogICAgaWYgKGVzNm1vZHVsZSkgewogICAgICAgIHJldHVybiBpbXBvcnQodXJsKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZldGNoKHVybCk7CiAgICB9Cn0pOwpyZWdpc3Rlcl9leHQoMTAyLCAodWludF84X2FycmF5KT0+ewogICAgY29uc3QgW2ludGVycG9sYXRlZF9vYmplY3RzLCBzb3VyY2UsIGp1bGlhX2ZpbGVdID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICBjb25zdCBsb29rdXBfaW50ZXJwb2xhdGVkID0gKGlkKT0+aW50ZXJwb2xhdGVkX29iamVjdHNbaWRdOwogICAgdHJ5IHsKICAgICAgICBjb25zdCBldmFsX2Z1bmMgPSBuZXcgRnVuY3Rpb24oIl9fbG9va3VwX2ludGVycG9sYXRlZCIsICJKU1NlcnZlIiwgc291cmNlKTsKICAgICAgICByZXR1cm4gKCk9PnsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBldmFsX2Z1bmMobG9va3VwX2ludGVycG9sYXRlZCwgSlNTZXJ2ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYGVycm9yIGluIGNsb3N1cmUgZnJvbTogJHtqdWxpYV9maWxlfWApOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFNvdXJjZTpgKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHNvdXJjZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgY29uc29sZS5sb2coYGVycm9yIGluIGNsb3N1cmUgZnJvbTogJHtqdWxpYV9maWxlfWApOwogICAgICAgIGNvbnNvbGUubG9nKGBTb3VyY2U6YCk7CiAgICAgICAgY29uc29sZS5sb2coc291cmNlKTsKICAgICAgICB0aHJvdyBlcnI7CiAgICB9Cn0pOwpyZWdpc3Rlcl9leHQoMTAzLCAodWludF84X2FycmF5KT0+ewogICAgY29uc3QgcmVhbF92YWx1ZSA9IHVucGFjayh1aW50XzhfYXJyYXkpOwogICAgcmV0dXJuIG5ldyBSZXRhaW4ocmVhbF92YWx1ZSk7Cn0pOwpyZWdpc3Rlcl9leHQoMTA0LCAodWludF84X2FycmF5KT0+ewogICAgY29uc3Qga2V5ID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICByZXR1cm4gbG9va3VwX2dsb2JhbF9vYmplY3Qoa2V5KTsKfSk7CnJlZ2lzdGVyX2V4dCgxMDUsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbdGFnLCBjaGlsZHJlbiwgYXR0cmlidXRlc10gPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIGNvbnN0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7CiAgICBPYmplY3Qua2V5cyhhdHRyaWJ1dGVzKS5mb3JFYWNoKChrZXkpPT57CiAgICAgICAgaWYgKGtleSA9PSAiY2xhc3MiKSB7CiAgICAgICAgICAgIG5vZGUuY2xhc3NOYW1lID0gYXR0cmlidXRlc1trZXldOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKGtleSwgYXR0cmlidXRlc1trZXldKTsKICAgICAgICB9CiAgICB9KTsKICAgIGNoaWxkcmVuLmZvckVhY2goKGNoaWxkKT0+bm9kZS5hcHBlbmQoY2hpbGQpKTsKICAgIHJldHVybiBub2RlOwp9KTsKZnVuY3Rpb24gZGVzZXJpYWxpemVfY2FjaGVkKG1lc3NhZ2UpIHsKICAgIGlmIChtZXNzYWdlLm1zZ190eXBlKSB7CiAgICAgICAgcmV0dXJuIG1lc3NhZ2U7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IFtzZXNzaW9uX2lkLCBkYXRhXSA9IG1lc3NhZ2U7CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9Cn0KZnVuY3Rpb24gZnJlZV9vYmplY3QoaWQpIHsKICAgIGNvbnN0IGRhdGEgPSBHTE9CQUxfT0JKRUNUX0NBQ0hFW2lkXTsKICAgIGlmIChkYXRhKSB7CiAgICAgICAgaWYgKGRhdGEuY29uc3RydWN0b3IgPT0gUHJvbWlzZSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgUmV0YWluKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCFpc19zdGlsbF9yZWZlcmVuY2VkKGlkKSkgewogICAgICAgICAgICBkZWxldGUgR0xPQkFMX09CSkVDVF9DQUNIRVtpZF07CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgIH0gZWxzZSB7CiAgICAgICAgc2VuZF93YXJuaW5nKGBUcnlpbmcgdG8gZGVsZXRlIG9iamVjdCAke2lkfSwgd2hpY2ggaXMgbm90IGluIGdsb2JhbCBzZXNzaW9uIGNhY2hlLmApOwogICAgfQogICAgcmV0dXJuOwp9CmxldCBERUxFVEVfT0JTRVJWRVIgPSB1bmRlZmluZWQ7CmZ1bmN0aW9uIHRyYWNrX2RlbGV0ZWRfc2Vzc2lvbnMoKSB7CiAgICBpZiAoIURFTEVURV9PQlNFUlZFUikgewogICAgICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24obXV0YXRpb25zKSB7CiAgICAgICAgICAgIGxldCByZW1vdmFsX29jY3VyZWQgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgdG9fZGVsZXRlID0gbmV3IFNldCgpOwogICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaCgobXV0YXRpb24pPT57CiAgICAgICAgICAgICAgICBtdXRhdGlvbi5yZW1vdmVkTm9kZXMuZm9yRWFjaCgoeCk9PnsKICAgICAgICAgICAgICAgICAgICBpZiAoeC5pZCBpbiBTRVNTSU9OUykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBTRVNTSU9OU1t4LmlkXVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gImRlbGV0ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvX2RlbGV0ZS5hZGQoeC5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZW1vdmFsX29jY3VyZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKHJlbW92YWxfb2NjdXJlZCkgewogICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoU0VTU0lPTlMpLmZvckVhY2goKGlkKT0+ewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IFNFU1NJT05TW2lkXVsxXTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAiZGVsZXRlIikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZyhgYWRkaW5nIHNlc3Npb24gdG8gZGVsZXRlIGNhbmRpZGF0ZXM6ICR7aWR9YCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b19kZWxldGUuYWRkKGlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvX2RlbGV0ZS5mb3JFYWNoKChpZCk9PnsKICAgICAgICAgICAgICAgIGNsb3NlX3Nlc3Npb24oaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LCB7CiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGZhbHNlLAogICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICAgIGNoYXJhY3RlckRhdGE6IGZhbHNlLAogICAgICAgICAgICBzdWJ0cmVlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgREVMRVRFX09CU0VSVkVSID0gb2JzZXJ2ZXI7CiAgICB9Cn0KZnVuY3Rpb24gc2VuZF9kb25lX2xvYWRpbmcoc2Vzc2lvbikgewogICAgc2VuZF90b19qdWxpYSh7CiAgICAgICAgbXNnX3R5cGU6IEpTRG9uZUxvYWRpbmcsCiAgICAgICAgc2Vzc2lvbiwKICAgICAgICBleGNlcHRpb246ICJudWxsIgogICAgfSk7Cn0KZnVuY3Rpb24gaW5pdF9zZXNzaW9uKHNlc3Npb25faWQsIG9uX2Nvbm5lY3Rpb25fb3Blbiwgc2Vzc2lvbl9zdGF0dXMpIHsKICAgIHdoaWxlX2xvY2tpbmdfZnJlZSgoKT0+ewogICAgICAgIGNvbnNvbGUubG9nKGBpbml0IHNlc3Npb246ICR7c2Vzc2lvbl9pZH0sICR7c2Vzc2lvbl9zdGF0dXN9YCk7CiAgICAgICAgdHJhY2tfZGVsZXRlZF9zZXNzaW9ucygpOwogICAgICAgIGNvbnN0IHRyYWNrZWRfaXRlbXMgPSBuZXcgU2V0KCk7CiAgICAgICAgU0VTU0lPTlNbc2Vzc2lvbl9pZF0gPSBbCiAgICAgICAgICAgIHRyYWNrZWRfaXRlbXMsCiAgICAgICAgICAgIHNlc3Npb25fc3RhdHVzCiAgICAgICAgXTsKICAgICAgICBpZiAoc2Vzc2lvbl9zdGF0dXMgPT0gInJvb3QiKSB7CiAgICAgICAgICAgIHJldHVybiByZWdpc3Rlcl9vbl9jb25uZWN0aW9uX29wZW4ob25fY29ubmVjdGlvbl9vcGVuLCBzZXNzaW9uX2lkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBtYXliZV9wcm9taXNlID0gb25fY29ubmVjdGlvbl9vcGVuKCk7CiAgICAgICAgICAgIGNvbnN0IHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUobWF5YmVfcHJvbWlzZSk7CiAgICAgICAgICAgIHJldHVybiBwcm9taXNlLnRoZW4oKHgpPT57CiAgICAgICAgICAgICAgICBzZW5kX2RvbmVfbG9hZGluZyhzZXNzaW9uX2lkKTsKICAgICAgICAgICAgICAgIFNFU1NJT05TW3Nlc3Npb25faWRdID0gWwogICAgICAgICAgICAgICAgICAgIHRyYWNrZWRfaXRlbXMsCiAgICAgICAgICAgICAgICAgICAgImRlbGV0ZSIKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgc2Vzc2lvbiAke3Nlc3Npb25faWR9IGZ1bGx5IGluaXRpYWxpemVkYCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0sIHNlc3Npb25faWQpOwp9CmZ1bmN0aW9uIHNlbmRfY2xvc2Vfc2Vzc2lvbihzZXNzaW9uLCBzdWJzZXNzaW9uKSB7CiAgICBjb25zb2xlLmxvZyhgY2xvc2luZyAke3Nlc3Npb259YCk7CiAgICBzZW5kX3RvX2p1bGlhKHsKICAgICAgICBtc2dfdHlwZTogQ2xvc2VTZXNzaW9uLAogICAgICAgIHNlc3Npb24sCiAgICAgICAgc3Vic2Vzc2lvbgogICAgfSk7Cn0KZnVuY3Rpb24gY2xvc2Vfc2Vzc2lvbihzZXNzaW9uX2lkKSB7CiAgICBjb25zdCBbc2Vzc2lvbl9vYmplY3RzLCBzdGF0dXNdID0gU0VTU0lPTlNbc2Vzc2lvbl9pZF07CiAgICBjb25zdCByb290X25vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZXNzaW9uX2lkKTsKICAgIGlmIChyb290X25vZGUpIHsKICAgICAgICByb290X25vZGUuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICByb290X25vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb290X25vZGUpOwogICAgfQogICAgaWYgKHN0YXR1cyA9PT0gImRlbGV0ZSIpIHsKICAgICAgICBzZW5kX2Nsb3NlX3Nlc3Npb24oc2Vzc2lvbl9pZCwgc3RhdHVzKTsKICAgICAgICBTRVNTSU9OU1tzZXNzaW9uX2lkXSA9IFsKICAgICAgICAgICAgc2Vzc2lvbl9vYmplY3RzLAogICAgICAgICAgICBmYWxzZQogICAgICAgIF07CiAgICB9CiAgICByZXR1cm47Cn0KZnVuY3Rpb24gZnJlZV9zZXNzaW9uKHNlc3Npb25faWQpIHsKICAgIGZ1bmN0aW9uIGZyZWVfb2JqZWN0cygpIHsKICAgICAgICBjb25zb2xlLmxvZyhgYWN0dWFsbHkgZnJlZWluZyBzZXNzaW9uICR7c2Vzc2lvbl9pZH1gKTsKICAgICAgICBjb25zdCBbdHJhY2tlZF9vYmplY3RzLCBzdWJzZXNzaW9uXSA9IFNFU1NJT05TW3Nlc3Npb25faWRdOwogICAgICAgIHRyYWNrZWRfb2JqZWN0cy5mb3JFYWNoKChrZXkpPT57CiAgICAgICAgICAgIGZyZWVfb2JqZWN0KGtleSk7CiAgICAgICAgfSk7CiAgICAgICAgdHJhY2tlZF9vYmplY3RzLmNsZWFyKCk7CiAgICAgICAgZGVsZXRlIFNFU1NJT05TW3Nlc3Npb25faWRdOwogICAgfQogICAgaWYgKEFMTE9XX0ZSRUVJTkdfT0JKRUNUUykgewogICAgICAgIGZyZWVfb2JqZWN0cygpOwogICAgfSBlbHNlIHsKICAgICAgICBGUkVFX0pPQlNfUVVFVUUucHVzaChmcmVlX29iamVjdHMpOwogICAgfQp9CmZ1bmN0aW9uIG9uX25vZGVfYXZhaWxhYmxlKHF1ZXJ5X3NlbGVjdG9yLCB0aW1lb3V0KSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpPT57CiAgICAgICAgZnVuY3Rpb24gdGVzdF9ub2RlKHRpbWVvdXQpIHsKICAgICAgICAgICAgbGV0IG5vZGU7CiAgICAgICAgICAgIGlmIChxdWVyeV9zZWxlY3Rvci5ieV9pZCkgewogICAgICAgICAgICAgICAgbm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHF1ZXJ5X3NlbGVjdG9yLmJ5X2lkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5vZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHF1ZXJ5X3NlbGVjdG9yLnF1ZXJ5X3NlbGVjdG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobm9kZSkgewogICAgICAgICAgICAgICAgcmVzb2x2ZShub2RlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld190aW1lb3V0ID0gMiAqIHRpbWVvdXQ7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhuZXdfdGltZW91dCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHRlc3Rfbm9kZSwgbmV3X3RpbWVvdXQsIG5ld190aW1lb3V0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0ZXN0X25vZGUodGltZW91dCk7CiAgICB9KTsKfQpmdW5jdGlvbiB1cGRhdGVfb3JfcmVwbGFjZShub2RlLCBuZXdfaHRtbCwgcmVwbGFjZSkgewogICAgaWYgKHJlcGxhY2UpIHsKICAgICAgICBub2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld19odG1sLCBub2RlKTsKICAgIH0gZWxzZSB7CiAgICAgICAgd2hpbGUobm9kZS5jaGlsZEVsZW1lbnRDb3VudCA+IDApewogICAgICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuZmlyc3RDaGlsZCk7CiAgICAgICAgfQogICAgICAgIG5vZGUuYXBwZW5kKG5ld19odG1sKTsKICAgIH0KfQpmdW5jdGlvbiB1cGRhdGVfc2Vzc2lvbl9kb20obWVzc2FnZSkgewogICAgY29uc3QgeyBzZXNzaW9uX2lkICwgbWVzc2FnZXMgLCBodG1sICwgZG9tX25vZGVfc2VsZWN0b3IgLCByZXBsYWNlICB9ID0gbWVzc2FnZTsKICAgIG9uX25vZGVfYXZhaWxhYmxlKGRvbV9ub2RlX3NlbGVjdG9yLCAxKS50aGVuKChkb20pPT57CiAgICAgICAgdXBkYXRlX29yX3JlcGxhY2UoZG9tLCBodG1sLCByZXBsYWNlKTsKICAgICAgICBwcm9jZXNzX21lc3NhZ2UobWVzc2FnZXMpOwogICAgICAgIGNvbnNvbGUubG9nKCJvYnMgc2Vzc2lvbiBkb25lOiAiICsgc2Vzc2lvbl9pZCk7CiAgICB9KTsKICAgIHJldHVybjsKfQpmdW5jdGlvbiB1cGRhdGVfc2Vzc2lvbl9jYWNoZShzZXNzaW9uX2lkLCBuZXdfamxfb2JqZWN0cykgewogICAgZnVuY3Rpb24gdXBkYXRlX2NhY2hlKHRyYWNrZWRfb2JqZWN0cykgewogICAgICAgIGZvcihjb25zdCBrZXkgaW4gbmV3X2psX29iamVjdHMpewogICAgICAgICAgICB0cmFja2VkX29iamVjdHMuYWRkKGtleSk7CiAgICAgICAgICAgIGNvbnN0IG5ld19vYmplY3QgPSBuZXdfamxfb2JqZWN0c1trZXldOwogICAgICAgICAgICBpZiAobmV3X29iamVjdCA9PSAidHJhY2tpbmctb25seSIpIHsKICAgICAgICAgICAgICAgIGlmICghKGtleSBpbiBHTE9CQUxfT0JKRUNUX0NBQ0hFKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgS2V5ICR7a2V5fSBvbmx5IHNlbmQgZm9yIHRyYWNraW5nLCBidXQgbm90IGFscmVhZHkgdHJhY2tlZCEhIWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCEoa2V5IGluIEdMT0JBTF9PQkpFQ1RfQ0FDSEUpKSB7CiAgICAgICAgICAgICAgICAgICAgR0xPQkFMX09CSkVDVF9DQUNIRVtrZXldID0gbmV3X29iamVjdDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGAke2tleX0gaW4gc2Vzc2lvbiBjYWNoZSBhbmQgc2VuZCBhZ2FpbiEhYCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBjb25zdCBzZXNzaW9uID0gU0VTU0lPTlNbc2Vzc2lvbl9pZF07CiAgICBpZiAoc2Vzc2lvbikgewogICAgICAgIHVwZGF0ZV9jYWNoZShzZXNzaW9uWzBdKTsKICAgIH0gZWxzZSB7CiAgICAgICAgaW5pdF9zZXNzaW9uKHNlc3Npb25faWQsICgpPT51cGRhdGVfY2FjaGUoU0VTU0lPTlNbc2Vzc2lvbl9pZF1bMF0pLCAidXBkYXRlLXNlc3Npb24tZG9tIik7CiAgICB9Cn0KY29uc3QgbW9kID0gewogICAgU0VTU0lPTlM6IFNFU1NJT05TLAogICAgR0xPQkFMX09CSkVDVF9DQUNIRTogR0xPQkFMX09CSkVDVF9DQUNIRSwKICAgIGxvb2t1cF9nbG9iYWxfb2JqZWN0OiBsb29rdXBfZ2xvYmFsX29iamVjdCwKICAgIGRlc2VyaWFsaXplX2NhY2hlZDogZGVzZXJpYWxpemVfY2FjaGVkLAogICAgdHJhY2tfZGVsZXRlZF9zZXNzaW9uczogdHJhY2tfZGVsZXRlZF9zZXNzaW9ucywKICAgIGluaXRfc2Vzc2lvbjogaW5pdF9zZXNzaW9uLAogICAgY2xvc2Vfc2Vzc2lvbjogY2xvc2Vfc2Vzc2lvbiwKICAgIGZyZWVfc2Vzc2lvbjogZnJlZV9zZXNzaW9uLAogICAgb25fbm9kZV9hdmFpbGFibGU6IG9uX25vZGVfYXZhaWxhYmxlLAogICAgdXBkYXRlX29yX3JlcGxhY2U6IHVwZGF0ZV9vcl9yZXBsYWNlLAogICAgdXBkYXRlX3Nlc3Npb25fZG9tOiB1cGRhdGVfc2Vzc2lvbl9kb20sCiAgICB1cGRhdGVfc2Vzc2lvbl9jYWNoZTogdXBkYXRlX3Nlc3Npb25fY2FjaGUKfTsKcmVnaXN0ZXJfZXh0KDEwNiwgKHVpbnRfOF9hcnJheSk9PnsKICAgIGNvbnN0IFtzZXNzaW9uX2lkLCBvYmplY3RzXSA9IHVucGFjayh1aW50XzhfYXJyYXkpOwogICAgdXBkYXRlX3Nlc3Npb25fY2FjaGUoc2Vzc2lvbl9pZCwgb2JqZWN0cyk7CiAgICByZXR1cm4gc2Vzc2lvbl9pZDsKfSk7CnJlZ2lzdGVyX2V4dCgxMDcsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbc2Vzc2lvbl9pZCwgbWVzc2FnZV0gPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIHJldHVybiBtZXNzYWdlOwp9KTsKZnVuY3Rpb24gYmFzZTY0ZW5jb2RlKGRhdGFfYXNfdWludDhhcnJheSkgewogICAgY29uc3QgYmFzZTY0X3Byb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSk9PnsKICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBsZW4gPSAzNzsKICAgICAgICAgICAgY29uc3QgYmFzZTY0dXJsID0gcmVhZGVyLnJlc3VsdDsKICAgICAgICAgICAgcmVzb2x2ZShiYXNlNjR1cmwuc2xpY2UobGVuLCBiYXNlNjR1cmwubGVuZ3RoKSk7CiAgICAgICAgfTsKICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChuZXcgQmxvYihbCiAgICAgICAgICAgIGRhdGFfYXNfdWludDhhcnJheQogICAgICAgIF0pKTsKICAgIH0pOwogICAgcmV0dXJuIGJhc2U2NF9wcm9taXNlOwp9CmZ1bmN0aW9uIGJhc2U2NGRlY29kZShiYXNlNjRfc3RyKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpPT57CiAgICAgICAgZmV0Y2goImRhdGE6YXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO2Jhc2U2NCwiICsgYmFzZTY0X3N0cikudGhlbigocmVzcG9uc2UpPT57CiAgICAgICAgICAgIHJlc3BvbnNlLmFycmF5QnVmZmVyKCkudGhlbigoYXJyYXkpPT57CiAgICAgICAgICAgICAgICByZXNvbHZlKG5ldyBVaW50OEFycmF5KGFycmF5KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSk7Cn0KZnVuY3Rpb24gZGVjb2RlX2JpbmFyeV9tZXNzYWdlKGJpbmFyeSkgewogICAgcmV0dXJuIGRlc2VyaWFsaXplX2NhY2hlZChkZWNvZGVfYmluYXJ5KGJpbmFyeSkpOwp9CmZ1bmN0aW9uIGRlY29kZV9iYXNlNjRfbWVzc2FnZShiYXNlNjRfc3RyaW5nKSB7CiAgICByZXR1cm4gYmFzZTY0ZGVjb2RlKGJhc2U2NF9zdHJpbmcpLnRoZW4oZGVjb2RlX2JpbmFyeV9tZXNzYWdlKTsKfQpmdW5jdGlvbiBkZWNvZGVfYmluYXJ5KGJpbmFyeSkgewogICAgY29uc3QgbXNnX2JpbmFyeSA9IENsKGJpbmFyeSk7CiAgICByZXR1cm4gdW5wYWNrKG1zZ19iaW5hcnkpOwp9CmNvbnN0IG1vZDEgPSB7CiAgICBSZXRhaW46IFJldGFpbiwKICAgIGJhc2U2NGVuY29kZTogYmFzZTY0ZW5jb2RlLAogICAgYmFzZTY0ZGVjb2RlOiBiYXNlNjRkZWNvZGUsCiAgICBkZWNvZGVfYmluYXJ5X21lc3NhZ2U6IGRlY29kZV9iaW5hcnlfbWVzc2FnZSwKICAgIGRlY29kZV9iYXNlNjRfbWVzc2FnZTogZGVjb2RlX2Jhc2U2NF9tZXNzYWdlLAogICAgZGVjb2RlX2JpbmFyeTogZGVjb2RlX2JpbmFyeSwKICAgIGVuY29kZV9iaW5hcnk6IGVuY29kZV9iaW5hcnkKfTsKZnVuY3Rpb24gcHJvY2Vzc19tZXNzYWdlKGRhdGEpIHsKICAgIGlmICghZGF0YSkgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIHRyeSB7CiAgICAgICAgc3dpdGNoKGRhdGEubXNnX3R5cGUpewogICAgICAgICAgICBjYXNlIFVwZGF0ZU9ic2VydmFibGU6CiAgICAgICAgICAgICAgICBjb25zdCBvYnNlcnZhYmxlID0gbG9va3VwX2dsb2JhbF9vYmplY3QoZGF0YS5pZCk7CiAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLm5vdGlmeShkYXRhLnBheWxvYWQsIHRydWUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgT25qc0NhbGxiYWNrOgogICAgICAgICAgICAgICAgZGF0YS5vYnMub24oZGF0YS5wYXlsb2FkKCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgRXZhbEphdmFzY3JpcHQ6CiAgICAgICAgICAgICAgICBkYXRhLnBheWxvYWQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIEZ1c2VkTWVzc2FnZToKICAgICAgICAgICAgICAgIGRhdGEucGF5bG9hZC5mb3JFYWNoKHByb2Nlc3NfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBQaW5nUG9uZzoKICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoInBpbmciKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJVcGRhdGVTZXNzaW9uIjoKICAgICAgICAgICAgICAgIHVwZGF0ZV9zZXNzaW9uX2RvbShkYXRhKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbnJlY29nbml6ZWQgbWVzc2FnZSB0eXBlOiAiICsgZGF0YS5tc2dfdHlwZSArICIuIik7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIHNlbmRfZXJyb3IoYEVycm9yIHdoaWxlIHByb2Nlc3NpbmcgbWVzc2FnZSAke0pTT04uc3RyaW5naWZ5KGRhdGEpfWAsIGUpOwogICAgfQp9CmNvbnN0IG1vZDIgPSB7CiAgICBVcGRhdGVPYnNlcnZhYmxlOiBVcGRhdGVPYnNlcnZhYmxlLAogICAgT25qc0NhbGxiYWNrOiBPbmpzQ2FsbGJhY2ssCiAgICBFdmFsSmF2YXNjcmlwdDogRXZhbEphdmFzY3JpcHQsCiAgICBKYXZhc2NyaXB0RXJyb3I6IEphdmFzY3JpcHRFcnJvciwKICAgIEphdmFzY3JpcHRXYXJuaW5nOiBKYXZhc2NyaXB0V2FybmluZywKICAgIFJlZ2lzdGVyT2JzZXJ2YWJsZTogUmVnaXN0ZXJPYnNlcnZhYmxlLAogICAgSlNEb25lTG9hZGluZzogSlNEb25lTG9hZGluZywKICAgIEZ1c2VkTWVzc2FnZTogRnVzZWRNZXNzYWdlLAogICAgcmVnaXN0ZXJfb25fY29ubmVjdGlvbl9vcGVuOiByZWdpc3Rlcl9vbl9jb25uZWN0aW9uX29wZW4sCiAgICBvbl9jb25uZWN0aW9uX29wZW46IG9uX2Nvbm5lY3Rpb25fb3BlbiwKICAgIG9uX2Nvbm5lY3Rpb25fY2xvc2U6IG9uX2Nvbm5lY3Rpb25fY2xvc2UsCiAgICBzZW5kX3RvX2p1bGlhOiBzZW5kX3RvX2p1bGlhLAogICAgc2VuZF9waW5ncG9uZzogc2VuZF9waW5ncG9uZywKICAgIHNlbmRfZXJyb3I6IHNlbmRfZXJyb3IsCiAgICBzZW5kX3dhcm5pbmc6IHNlbmRfd2FybmluZywKICAgIHNlbmRfZG9uZV9sb2FkaW5nOiBzZW5kX2RvbmVfbG9hZGluZywKICAgIHNlbmRfY2xvc2Vfc2Vzc2lvbjogc2VuZF9jbG9zZV9zZXNzaW9uLAogICAgcHJvY2Vzc19tZXNzYWdlOiBwcm9jZXNzX21lc3NhZ2UKfTsKY29uc3QgeyBzZW5kX2Vycm9yOiBzZW5kX2Vycm9yMSAsIHNlbmRfd2FybmluZzogc2VuZF93YXJuaW5nMSAsIHByb2Nlc3NfbWVzc2FnZTogcHJvY2Vzc19tZXNzYWdlMSAsIG9uX2Nvbm5lY3Rpb25fb3Blbjogb25fY29ubmVjdGlvbl9vcGVuMSAsIG9uX2Nvbm5lY3Rpb25fY2xvc2U6IG9uX2Nvbm5lY3Rpb25fY2xvc2UxICwgc2VuZF9jbG9zZV9zZXNzaW9uOiBzZW5kX2Nsb3NlX3Nlc3Npb24xICwgcmVnaXN0ZXJfb25fY29ubmVjdGlvbl9vcGVuOiByZWdpc3Rlcl9vbl9jb25uZWN0aW9uX29wZW4xICwgc2VuZF9waW5ncG9uZzogc2VuZF9waW5ncG9uZzEgIH0gPSBtb2QyOwpjb25zdCB7IGJhc2U2NGRlY29kZTogYmFzZTY0ZGVjb2RlMSAsIGJhc2U2NGVuY29kZTogYmFzZTY0ZW5jb2RlMSAsIGRlY29kZV9iaW5hcnk6IGRlY29kZV9iaW5hcnkxICwgZW5jb2RlX2JpbmFyeTogZW5jb2RlX2JpbmFyeTEgLCBkZWNvZGVfYmluYXJ5X21lc3NhZ2U6IGRlY29kZV9iaW5hcnlfbWVzc2FnZTEgLCBkZWNvZGVfYmFzZTY0X21lc3NhZ2U6IGRlY29kZV9iYXNlNjRfbWVzc2FnZTEgIH0gPSBtb2QxOwpjb25zdCB7IGluaXRfc2Vzc2lvbjogaW5pdF9zZXNzaW9uMSAsIGRlc2VyaWFsaXplX2NhY2hlZDogZGVzZXJpYWxpemVfY2FjaGVkMSAsIGZyZWVfc2Vzc2lvbjogZnJlZV9zZXNzaW9uMSAsIGxvb2t1cF9nbG9iYWxfb2JqZWN0OiBsb29rdXBfZ2xvYmFsX29iamVjdDEgLCB1cGRhdGVfb3JfcmVwbGFjZTogdXBkYXRlX29yX3JlcGxhY2UxICB9ID0gbW9kOwpmdW5jdGlvbiB1cGRhdGVfbm9kZV9hdHRyaWJ1dGUobm9kZSwgYXR0cmlidXRlLCB2YWx1ZSkgewogICAgaWYgKG5vZGUpIHsKICAgICAgICBpZiAobm9kZVthdHRyaWJ1dGVdICE9IHZhbHVlKSB7CiAgICAgICAgICAgIG5vZGVbYXR0cmlidXRlXSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CmZ1bmN0aW9uIHVwZGF0ZV9kb21fbm9kZShkb20sIGh0bWwpIHsKICAgIGlmIChkb20pIHsKICAgICAgICBkb20uaW5uZXJIVE1MID0gaHRtbDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQp9CmNvbnN0IEpTU2VydmUxID0gewogICAgUHJvdG9jb2w6IG1vZDEsCiAgICBiYXNlNjRkZWNvZGU6IGJhc2U2NGRlY29kZTEsCiAgICBiYXNlNjRlbmNvZGU6IGJhc2U2NGVuY29kZTEsCiAgICBkZWNvZGVfYmluYXJ5OiBkZWNvZGVfYmluYXJ5MSwKICAgIGVuY29kZV9iaW5hcnk6IGVuY29kZV9iaW5hcnkxLAogICAgZGVjb2RlX2JpbmFyeV9tZXNzYWdlOiBkZWNvZGVfYmluYXJ5X21lc3NhZ2UxLAogICAgZGVjb2RlX2Jhc2U2NF9tZXNzYWdlOiBkZWNvZGVfYmFzZTY0X21lc3NhZ2UxLAogICAgQ29ubmVjdGlvbjogbW9kMiwKICAgIHNlbmRfZXJyb3I6IHNlbmRfZXJyb3IxLAogICAgc2VuZF93YXJuaW5nOiBzZW5kX3dhcm5pbmcxLAogICAgcHJvY2Vzc19tZXNzYWdlOiBwcm9jZXNzX21lc3NhZ2UxLAogICAgb25fY29ubmVjdGlvbl9vcGVuOiBvbl9jb25uZWN0aW9uX29wZW4xLAogICAgb25fY29ubmVjdGlvbl9jbG9zZTogb25fY29ubmVjdGlvbl9jbG9zZTEsCiAgICBzZW5kX2Nsb3NlX3Nlc3Npb246IHNlbmRfY2xvc2Vfc2Vzc2lvbjEsCiAgICByZWdpc3Rlcl9vbl9jb25uZWN0aW9uX29wZW46IHJlZ2lzdGVyX29uX2Nvbm5lY3Rpb25fb3BlbjEsCiAgICBzZW5kX3Bpbmdwb25nOiBzZW5kX3Bpbmdwb25nMSwKICAgIFNlc3Npb25zOiBtb2QsCiAgICBkZXNlcmlhbGl6ZV9jYWNoZWQ6IGRlc2VyaWFsaXplX2NhY2hlZDEsCiAgICBpbml0X3Nlc3Npb246IGluaXRfc2Vzc2lvbjEsCiAgICBmcmVlX3Nlc3Npb246IGZyZWVfc2Vzc2lvbjEsCiAgICB1cGRhdGVfbm9kZV9hdHRyaWJ1dGUsCiAgICB1cGRhdGVfZG9tX25vZGUsCiAgICBsb29rdXBfZ2xvYmFsX29iamVjdDogbG9va3VwX2dsb2JhbF9vYmplY3QxLAogICAgdXBkYXRlX29yX3JlcGxhY2U6IHVwZGF0ZV9vcl9yZXBsYWNlMQp9Owp3aW5kb3cuSlNTZXJ2ZSA9IEpTU2VydmUxOwpleHBvcnQgeyBtb2QxIGFzIFByb3RvY29sLCBiYXNlNjRkZWNvZGUxIGFzIGJhc2U2NGRlY29kZSwgYmFzZTY0ZW5jb2RlMSBhcyBiYXNlNjRlbmNvZGUsIGRlY29kZV9iaW5hcnkxIGFzIGRlY29kZV9iaW5hcnksIGVuY29kZV9iaW5hcnkxIGFzIGVuY29kZV9iaW5hcnksIG1vZDIgYXMgQ29ubmVjdGlvbiwgc2VuZF9lcnJvcjEgYXMgc2VuZF9lcnJvciwgc2VuZF93YXJuaW5nMSBhcyBzZW5kX3dhcm5pbmcsIHByb2Nlc3NfbWVzc2FnZTEgYXMgcHJvY2Vzc19tZXNzYWdlLCBvbl9jb25uZWN0aW9uX29wZW4xIGFzIG9uX2Nvbm5lY3Rpb25fb3Blbiwgb25fY29ubmVjdGlvbl9jbG9zZTEgYXMgb25fY29ubmVjdGlvbl9jbG9zZSwgcmVnaXN0ZXJfb25fY29ubmVjdGlvbl9vcGVuMSBhcyByZWdpc3Rlcl9vbl9jb25uZWN0aW9uX29wZW4sIG1vZCBhcyBTZXNzaW9ucywgZGVzZXJpYWxpemVfY2FjaGVkMSBhcyBkZXNlcmlhbGl6ZV9jYWNoZWQsIGluaXRfc2Vzc2lvbjEgYXMgaW5pdF9zZXNzaW9uLCBmcmVlX3Nlc3Npb24xIGFzIGZyZWVfc2Vzc2lvbiB9OwoK" type="module"></script>
      <script data-jscall-id="18" src="data:application/javascript;base64,ICAgIGZ1bmN0aW9uIGluaXRfbWVzc2FnZXMoKSB7CiAgICAKfQoKICAgIEpTU2VydmUuaW5pdF9zZXNzaW9uKCdkMWExNjgyZi01NmY2LTQwMjQtYTQzOS1lNmQ5M2RlNWE5ODgnLCBpbml0X21lc3NhZ2VzLCAncm9vdCcpOwo=" type="module"></script>
      <script data-jscall-id="19" src="data:application/javascript;base64,ICAgIEpTU2VydmUub25fY29ubmVjdGlvbl9vcGVuKCh3KT0+IG51bGwpCiAgICBjb25zdCBzZXNzaW9uX21lc3NhZ2VzID0gJ0g0c0lBQUFBQUFBQUE1dDBYQ05yMGsyVkZNTkVRek1Mb3pSZFU3TTBNMTBUQXlNVDNVUVRZMHZkVkxNVVMrT1VWTk5FU3d1TGhxYmxCWW1WT2ZtSktSTlc1QmFueDVkVUZxUXV0QVFBM3Jydk8wRUFBQUE9JwogICAgSlNTZXJ2ZS5kZWNvZGVfYmFzZTY0X21lc3NhZ2Uoc2Vzc2lvbl9tZXNzYWdlcykudGhlbihKU1NlcnZlLnByb2Nlc3NfbWVzc2FnZSkK" type="module"></script>
    </span>
  </div>
  <div id="bbc1eaaf-8706-4d38-b740-05567127284f" data-jscall-id="jsserver-application-dom">
    <div data-jscall-id="23">
      <script data-jscall-id="30" src="data:application/javascript;base64,ICAgIGZ1bmN0aW9uIGluaXRfbWVzc2FnZXMoKSB7CiAgICAKfQoKICAgIEpTU2VydmUuaW5pdF9zZXNzaW9uKCdiYmMxZWFhZi04NzA2LTRkMzgtYjc0MC0wNTU2NzEyNzI4NGYnLCBpbml0X21lc3NhZ2VzLCAnc3ViJyk7Cg==" type="module"></script>
      <script data-jscall-id="31" src="data:application/javascript;base64,ICAgIEpTU2VydmUub25fY29ubmVjdGlvbl9vcGVuKCh3KT0+IG51bGwpCiAgICBjb25zdCBzZXNzaW9uX21lc3NhZ2VzID0gJ0g0c0lBQUFBQUFBQUE2MVd6VzhiUlJSWGc3amt4QUhFRFZZVzZ1NnE5bnEvUHhLbEVrMURDK29IcWtNQlZaVTEzaDNibTR4M3pPNDR4bFNXbXZiRWtWVDhBWlFLS2lGYVFWckV1VGtrZndMdGhUT0gvZ0hjZUxNZnppWjIyZ1oxSmR2cm1UZnZ2Zm05My92TmJPMUthMXRQUDJpMWZBMGoxSzY1am1yWHpNQndheTNIVkd1cVpkbU9wanU2YTdadjN2cTVqMGFFb3VEN3ZUZVgxN2YyNXY1KzFhVzN0ajFMVjAzRFVrMWJjd3pYVXczVjJadnJCMXV6SnA3TmZTRkpzckIwV3JneEw4RGoweWhoZ28raURaUUlTMEpBL1VFUFIwenhZNHdZWGlHWS81TXFtVUZGWGl3dm9oSERYek5ZbGMwcUhjeVdzekZKMUFQeGdQRXdERmdYVEMxVkxZMTJjZGpwY2c5bU1aeDVLcXpUMzhYeXpHUkY5bElPMFlsUkVFSzJQS0Vzalh3WFYyQWNrWFA1dEtTcmFsVkl2NHJmNGl2UHVIQ2tvQ0JZcG9UR0RVYjdVa1d0VklWS0QzVmdCbFZlYktyb0ZqZHVrUUYrbWFXVnV1M0VHRWN2TTNWU3B5Tk1DQjIreEZaVFVyY3hEa28xU3lGcGg0UTAySWhnZ0tsWVBHMXhCZnRNeWhCS2ExRE44YzZkeFpnTjRpaXZ5ZUw4V0paZzRwR202NlpxT0xiamVwN2h1SVp0R3Q3dXU4SFd6SWtudDMra3JXVDNuZTdNMmFJYjl1Wk90ZTlzYnV1bXA5dUdxcW11YVhtcXA2cWV1ZnQyZHlhL1R6elBrMnNQSXArRk5CSWtuNFQrdWx6bSsxclNUR0lmRUdnMkNhWHJnMzR6aEwzSGZVcUFMZ0d3ZHpxZVdCWEV5NjBFeHh1b1JmQ05Cb3ZEcURNV1pXVURRWlhMUEl4eE1pQ2NoUkVlQ2gvbFdVaVZQSzJLY0VxUXN2Z3l3SmF1STVoQjUvVXlKMkZia05pb2oybDc0bWxwU1JCcGF3MXFJZ29uVCtiRFNrUURmQW4xc0p5M01uL0FDd1RPRE5MQnNZQkpna3NXV1k1SkgwVXZhSGMrWFpFbmEvaGZKWXdpSEs5bURaOEZXRHdVbHB0bFFkUHZUeG9OUUFzcmczNEF2cHMwYnNhNFQ1Q1BwVW5ZcndZNEhqVXdnWjNSV0JLdmdTR3FyU1UrSXFRV0Jrc1ZYYTljRitVcTkxOFYyZ2gyY29DQTgrUDVYNEdlb0R1SjBnc1dEUGQrTCtrME9YZy9hQk5CM1h2ajMvYWRXOGVnME8rbVpvR3RaZWlPcVJ1R3F4bjZ0NCtITWVxZndWMjBFZEpCbkt4RW5BVEJ6c09rUzRjWHdnaGZHdlJhT0U2ZS9ESkljSU8yMlNwcUpUdjMrS0pQZjhPcDhVVUFMRXpTcmU0ODdPRzRneitMQW5vV0U0YVNueEFab2xGeXZ3MGQyQWkvd1cvOTRkUCs2UE9RZFZkNmZaWURCQ1RhK1JNTkdHMzRNU1ZrSlFnQnM0OGpScStHZUxqemJPNHZpUU96ejNxY0ZWTStYSHFjTG9SeVFTVVUvcWV3ckpaWXdwOGU4R3RCRU1Hc3psL3Jhd2lhM1kvRFBoTW5kbU41OFlCN1NyQkNhR2NTZkRLWlJWVVN6RmE3TUNXbGJobC9yZnZkbVBhd1dQS1VHd1BMQUF5cE5GR3ZDd0N3QUY0dTkva3VFNkdIV1pjR0FxTjhFRDRiT0VaRW9Qa3NZZ0tOZkR3amkzeTlkSVFBVEZPQTkvL1owR2Q1NTFlRkQ2UFJHTVFSemlsUGdLM0dJVTVFR1hLZERwWWtFRW9CRFJEOUxvbzZHRndWWlpJQ1RnRDVFUEt2UVpVaXlzTDJTTXB6Z0E2NXltVktra3RnanFjUkwzSk5DdnZYcFk5NXFQRzhmSXptVjNuenk0dFBGK3BkSUVnOUhuQUZxZzlwdkY0dnRHV05sRjlCVSt1RkhxeVJCVjAzOWdWQjN4ZUVFKy94TThWV1ZkdHliTU4xRGRYUVFBQWM5YWpUNk9ramFiK3Z1T3dXQmVQdjEwU2dHRDloeE92UVZFREFpTUh0NmdqZ1pnUTlCTndaU2ttcGdDeE93UnNmQnpjN3g4MzluN2haSmRSMnYxemZ5cTZ4Z1lZMDI5WGJOY3R1dzExVTFjMGFBbXhxMkE0OEk4QVc4bHozNXUwQzVDZDN3MkFtbHZ1KzFiMjVHK0I4NDFXZGIyNXJ0bWNadHVQWW1tNnJucXRybHJycndEMTMxdmo3NFoxNy9FRDY3aDRHQm00K09JalNYZDB0OGVHZjlJQ3dEQTl5aEw3M1ZBZmNlWTYzK1NERnVwbmtZRCtleHRxcFhOKzJURXMzTmM4MmJWM3pRREk4dytWSHk0eXNucDFZTHArTWphemRFdENHSnFkU0V4UTJKSndHUnpiZWRKSlR3cFMzWHFaTldxcE5JMzZJYXJJQ2dndVN3dy9yMDFOWGdpN3JrYU52UkRQMmVJaTQ1NkdtY1hZK0tKZGdNd2NHenE5ZXZOQzRlbTQ4RVlSSjhCZmRFdURRNTFrVlIzOG1JZkw4OFFTaDBEUWdOdUJXb3ZiK3EvY2ZORytkVTZvTkFBQT0nCiAgICBKU1NlcnZlLmRlY29kZV9iYXNlNjRfbWVzc2FnZShzZXNzaW9uX21lc3NhZ2VzKS50aGVuKEpTU2VydmUucHJvY2Vzc19tZXNzYWdlKQo=" type="module"></script>
      <div data-jscall-id="25">
        <script data-jscall-id="24" src="https://cdn.jsdelivr.net/gh/ajaxorg/ace-builds/src-min/ace.js"></script>
        <div style="    position: &#34;absolute&#34;;&#10;    top: 0;&#10;    right: 0;&#10;    bottom: 0;&#10;    left: 0;&#10;    width: 800px;&#10;    height: 300px;&#10;" data-jscall-id="20"></div>
      </div>
      <button onclick="" data-jscall-id="26">
        <span data-jscall-id="27"></span>
      </button>
      <div data-jscall-id="22">
        <span data-jscall-id="21"></span>
      </div>
    </div>
  </div>
</div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../extending/">« Extending JSServe</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 2 January 2023 17:19">Monday 2 January 2023</span>. Using Julia version 1.8.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
